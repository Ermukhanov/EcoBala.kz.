<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EcoBala Kids - –ü—Ä–æ—Ñ–∏–ª—å</title>
    <link rel="icon" href="iconca.jpg" type="image/jpeg" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />

    <style>
        :root {
            --kids: #4AA3DF;
            --kids-dark: #2C5282;
            --bg1: #E3F2FD;
            --bg2: #F0F9FF;
            --text: #0B2540;
            --muted: rgba(11, 37, 64, 0.72);
            --card: rgba(255, 255, 255, 0.68);
            --border: rgba(255, 255, 255, 0.55);
            --shadow: 0 12px 34px rgba(74, 163, 223, 0.18);
            --radius: 22px;
            --transition: all 0.25s ease;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            color: var(--text);
            background: radial-gradient(900px 400px at 20% 10%, rgba(74,163,223,0.28), transparent 60%),
                        radial-gradient(900px 500px at 80% 0%, rgba(44,82,130,0.22), transparent 55%),
                        linear-gradient(135deg, var(--bg1) 0%, var(--bg2) 100%);
            min-height: 100vh;
        }

        h1, h2, h3 { font-family: 'Montserrat', sans-serif; }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 0 18px;
        }

        header {
            position: sticky;
            top: 0;
            z-index: 20;
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255,255,255,0.6);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            padding: 14px 0;
        }

        .left {
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 800;
            color: var(--kids-dark);
            text-decoration: none;
            white-space: nowrap;
        }

        .logo-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            overflow: hidden;
            flex-shrink: 0;
            box-shadow: 0 10px 20px rgba(74, 163, 223, 0.25);
        }

        .logo-icon img { width: 100%; height: 100%; object-fit: cover; }

        .nav-links {
            display: flex;
            gap: 14px;
            align-items: center;
            flex-wrap: wrap;
        }

        .link {
            color: var(--kids-dark);
            text-decoration: none;
            font-weight: 700;
            opacity: 0.85;
            transition: var(--transition);
        }

        .link:hover { opacity: 1; }

        .actions {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: flex-end;
        }

        .language-switcher {
            display: flex;
            background: rgba(74, 163, 223, 0.12);
            border-radius: 999px;
            padding: 3px;
            position: relative;
            flex-shrink: 0;
        }

        .lang-indicator {
            position: absolute;
            top: 3px;
            left: 3px;
            width: calc(50% - 3px);
            height: calc(100% - 6px);
            background: var(--kids);
            border-radius: 999px;
            transition: transform 0.25s ease;
            z-index: 1;
        }

        .lang-indicator.kazakh { transform: translateX(calc(100% - 6px)); }

        .lang-btn {
            padding: 8px 14px;
            border: none;
            background: transparent;
            border-radius: 999px;
            cursor: pointer;
            font-weight: 800;
            color: var(--kids-dark);
            position: relative;
            z-index: 2;
            transition: var(--transition);
        }

        .lang-btn.active { color: #fff; }

        .btn {
            border: none;
            cursor: pointer;
            padding: 10px 14px;
            border-radius: 14px;
            font-weight: 800;
            transition: var(--transition);
            text-decoration: none;
            display: inline-block;
            text-align: center;
            white-space: nowrap;
        }

        .btn-outline {
            background: rgba(255,255,255,0.6);
            color: var(--kids-dark);
            border: 2px solid rgba(74, 163, 223, 0.35);
        }

        .btn-outline:hover { transform: translateY(-1px); border-color: rgba(74, 163, 223, 0.7); }

        .btn-primary {
            background: var(--kids);
            color: white;
            box-shadow: 0 10px 22px rgba(74, 163, 223, 0.28);
        }

        .btn-primary:hover { transform: translateY(-1px); background: #3c96d4; }

        .feedback {
            margin-top: 10px;
            padding: 10px 12px;
            border-radius: 14px;
            font-weight: 900;
            display: none;
        }

        .feedback.success {
            display: block;
            background: rgba(46, 204, 113, 0.14);
            color: #1f6a3a;
            border: 1px solid rgba(46, 204, 113, 0.35);
        }

        .feedback.error {
            display: block;
            background: rgba(231, 76, 60, 0.12);
            color: #7a1f15;
            border: 1px solid rgba(231, 76, 60, 0.3);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        .lesson-note {
            padding: 14px;
            border-radius: 16px;
            background: rgba(255,255,255,0.62);
            border: 1px solid rgba(255,255,255,0.6);
            box-shadow: 0 10px 22px rgba(74, 163, 223, 0.14);
        }

        .lesson-note h3 {
            font-size: 15px;
            color: var(--kids-dark);
            margin-bottom: 8px;
        }

        .lesson-note p { color: var(--muted); font-weight: 700; }

        .dashboard {
            margin-top: 14px;
            display: grid;
            grid-template-columns: 1.2fr 1fr;
            gap: 14px;
            align-items: stretch;
        }

        .dash-title {
            font-size: 16px;
            color: var(--kids-dark);
            margin-bottom: 10px;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 10px;
        }

        .qa {
            padding: 12px;
            border-radius: 18px;
            background: rgba(255,255,255,0.62);
            border: 1px solid rgba(255,255,255,0.6);
            box-shadow: 0 10px 22px rgba(74, 163, 223, 0.14);
            text-align: left;
        }

        .qa .top {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 8px;
        }

        .qa .icon {
            width: 36px;
            height: 36px;
            border-radius: 14px;
            display: grid;
            place-items: center;
            background: rgba(74, 163, 223, 0.14);
            box-shadow: 0 10px 20px rgba(74, 163, 223, 0.18);
            flex-shrink: 0;
            font-size: 18px;
        }

        .qa .desc {
            color: var(--muted);
            font-weight: 700;
            font-size: 13px;
            line-height: 1.35;
            margin-bottom: 10px;
        }

        .progress {
            display: grid;
            gap: 10px;
        }

        .bar {
            height: 12px;
            border-radius: 999px;
            background: rgba(74, 163, 223, 0.14);
            border: 1px solid rgba(74, 163, 223, 0.18);
            overflow: hidden;
        }

        .bar > div {
            height: 100%;
            width: 0%;
            border-radius: 999px;
            background: linear-gradient(90deg, #4AA3DF 0%, #2C5282 100%);
            transition: width 0.35s ease;
        }

        .progress-row {
            display: flex;
            justify-content: space-between;
            gap: 12px;
            color: var(--muted);
            font-weight: 800;
            font-size: 13px;
        }

        @media (max-width: 980px) {
            .dashboard { grid-template-columns: 1fr; }
            .quick-actions { grid-template-columns: 1fr; }
        }

        .q {
            background: rgba(255,255,255,0.6);
            border: 1px solid rgba(255,255,255,0.65);
            border-radius: 16px;
            padding: 12px;
            display: grid;
            gap: 10px;
        }

        .q label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 800;
            color: rgba(11, 37, 64, 0.9);
        }

        .q .q-feedback {
            font-weight: 900;
            padding: 8px 10px;
            border-radius: 12px;
            display: none;
        }

        .q .q-feedback.success {
            display: block;
            background: rgba(46, 204, 113, 0.14);
            color: #1f6a3a;
            border: 1px solid rgba(46, 204, 113, 0.35);
        }

        .q .q-feedback.error {
            display: block;
            background: rgba(231, 76, 60, 0.12);
            color: #7a1f15;
            border: 1px solid rgba(231, 76, 60, 0.3);
        }

        .bot-topics {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 10px;
        }

        .topic-btn {
            border: 1px solid rgba(74, 163, 223, 0.3);
            background: rgba(255,255,255,0.6);
            color: var(--kids-dark);
            padding: 8px 10px;
            border-radius: 999px;
            font-weight: 900;
            cursor: pointer;
            transition: var(--transition);
        }

        .topic-btn:hover { transform: translateY(-1px); border-color: rgba(74, 163, 223, 0.6); }

        main { padding: 28px 0 70px; }

        .app {
            display: grid;
            grid-template-columns: 290px 1fr;
            gap: 18px;
            align-items: start;
        }

        .sidebar {
            padding: 16px;
        }

        .sidebar h2 {
            font-size: 16px;
            color: var(--kids-dark);
            margin-bottom: 10px;
        }

        .menu {
            display: grid;
            gap: 10px;
        }

        .menu-btn {
            width: 100%;
            text-align: left;
            padding: 12px 12px;
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.55);
            background: rgba(255,255,255,0.55);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 900;
            color: var(--kids-dark);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        .menu-btn:hover {
            transform: translateY(-1px);
            border-color: rgba(74, 163, 223, 0.7);
        }

        .menu-btn.active {
            background: rgba(74, 163, 223, 0.12);
            border-color: rgba(74, 163, 223, 0.7);
        }

        .menu-badge {
            font-size: 12px;
            font-weight: 900;
            padding: 6px 10px;
            border-radius: 999px;
            background: rgba(74, 163, 223, 0.14);
            color: var(--kids-dark);
        }

        .content {
            display: grid;
            gap: 18px;
        }

        .panel {
            padding: 18px;
            display: none;
        }

        .panel.active {
            display: block;
        }

        .panel h2 {
            font-size: 18px;
            color: var(--kids-dark);
            margin-bottom: 12px;
        }

        .cards {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 12px;
        }

        .mini-card {
            background: rgba(255,255,255,0.55);
            border: 1px solid rgba(255,255,255,0.55);
            border-radius: 18px;
            padding: 14px;
            display: grid;
            gap: 10px;
        }

        .mini-card h3 {
            font-size: 16px;
            color: var(--kids-dark);
        }

        .mini-card p {
            color: var(--muted);
            font-weight: 700;
            font-size: 13px;
        }

        .mini-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
        }

        .mini-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .hint {
            color: var(--muted);
            font-weight: 800;
            font-size: 12px;
        }

        .notice {
            padding: 12px;
            border-radius: 18px;
            background: rgba(74, 163, 223, 0.12);
            border: 1px solid rgba(74, 163, 223, 0.25);
            color: var(--kids-dark);
            font-weight: 900;
            margin-bottom: 12px;
        }

        .quiz {
            margin-top: 10px;
            display: grid;
            gap: 12px;
        }

        .q {
            background: rgba(255,255,255,0.55);
            border: 1px solid rgba(255,255,255,0.55);
            border-radius: 18px;
            padding: 12px;
        }

        .q strong {
            color: var(--kids-dark);
        }

        .q label {
            display: block;
            margin-top: 8px;
            color: var(--muted);
            font-weight: 800;
            cursor: pointer;
        }

        .chat {
            display: grid;
            gap: 12px;
        }

        .chat-box {
            background: rgba(255,255,255,0.55);
            border: 1px solid rgba(255,255,255,0.55);
            border-radius: 18px;
            padding: 12px;
            min-height: 240px;
            max-height: 360px;
            overflow: auto;
            display: grid;
            gap: 10px;
        }

        .msg {
            max-width: 85%;
            padding: 10px 12px;
            border-radius: 16px;
            font-weight: 800;
            line-height: 1.35;
        }

        .msg.user {
            justify-self: end;
            background: rgba(74, 163, 223, 0.16);
            border: 1px solid rgba(74, 163, 223, 0.3);
            color: var(--kids-dark);
        }

        .msg.bot {
            justify-self: start;
            background: rgba(255,255,255,0.7);
            border: 1px solid rgba(255,255,255,0.65);
            color: var(--kids-dark);
        }

        .chat-form {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 10px;
            align-items: center;
        }

        .input {
            width: 100%;
            padding: 12px 12px;
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.7);
            background: rgba(255,255,255,0.72);
            font-weight: 800;
            color: var(--kids-dark);
            outline: none;
        }

        .hero {
            display: grid;
            grid-template-columns: 1.25fr 0.75fr;
            gap: 18px;
            align-items: stretch;
        }

        .card {
            background: var(--card);
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            border-radius: var(--radius);
            backdrop-filter: blur(14px);
        }

        .profile {
            padding: 20px;
            display: grid;
            grid-template-columns: 84px 1fr;
            gap: 14px;
            position: relative;
            overflow: hidden;
        }

        .role-ring {
            position: absolute;
            inset: 0;
            border-radius: var(--radius);
            border: 2px solid rgba(74, 163, 223, 0.55);
            pointer-events: none;
        }

        .avatar {
            width: 84px;
            height: 84px;
            border-radius: 22px;
            background: linear-gradient(135deg, rgba(74,163,223,0.25), rgba(44,82,130,0.18));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 42px;
        }

        .meta h1 {
            font-size: 24px;
            line-height: 1.15;
            margin-top: 2px;
            margin-bottom: 8px;
        }

        .meta p {
            color: var(--muted);
            font-weight: 700;
        }

        .meta .row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .pill {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 10px;
            border-radius: 999px;
            background: rgba(255,255,255,0.55);
            border: 1px solid rgba(255,255,255,0.55);
            font-weight: 800;
            color: var(--kids-dark);
        }

        .stats {
            padding: 18px;
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        .stats h2 { font-size: 18px; color: var(--kids-dark); }

        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .stat {
            background: rgba(255,255,255,0.55);
            border: 1px solid rgba(255,255,255,0.55);
            border-radius: 18px;
            padding: 12px;
            text-align: center;
        }

        .stat .num {
            font-family: 'Montserrat', sans-serif;
            font-weight: 900;
            color: var(--kids-dark);
            font-size: 22px;
            line-height: 1.1;
        }

        .stat .label {
            color: var(--muted);
            font-weight: 800;
            margin-top: 6px;
            font-size: 12px;
        }

        .sections {
            margin-top: 18px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 18px;
        }

        .section {
            padding: 18px;
        }

        .section h2 {
            font-size: 18px;
            color: var(--kids-dark);
            margin-bottom: 12px;
        }

        .badges {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .badge {
            background: rgba(255,255,255,0.55);
            border: 1px solid rgba(255,255,255,0.55);
            border-radius: 18px;
            padding: 10px 12px;
            font-weight: 900;
            color: var(--kids-dark);
            display: inline-flex;
            align-items: center;
            gap: 10px;
            min-width: 140px;
        }

        .badge span { font-size: 18px; }

        .list {
            display: grid;
            gap: 10px;
        }

        .item {
            background: rgba(255,255,255,0.55);
            border: 1px solid rgba(255,255,255,0.55);
            border-radius: 18px;
            padding: 12px;
        }

        .item .top {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            flex-wrap: wrap;
        }

        .item .top strong { color: var(--kids-dark); }
        .item .top small { color: var(--muted); font-weight: 800; }
        .item p { margin-top: 8px; color: var(--muted); font-weight: 700; }

        @media (max-width: 980px) {
            .hero { grid-template-columns: 1fr; }
            .grid { grid-template-columns: repeat(3, 1fr); }
            .sections { grid-template-columns: 1fr; }
            .app { grid-template-columns: 1fr; }
        }

        @media (max-width: 560px) {
            .container { padding: 0 14px; }
            .profile { grid-template-columns: 70px 1fr; }
            .avatar { width: 70px; height: 70px; border-radius: 18px; font-size: 36px; }
            .meta h1 { font-size: 20px; }
            .grid { grid-template-columns: 1fr 1fr; }
            .btn { width: 100%; }
            .actions { width: 100%; }
            .nav-links { display: none; }
            .cards { grid-template-columns: 1fr; }
            .chat-form { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="left">
                    <a class="logo" href="index.html">
                        <span class="logo-icon"><img src="iconca.jpg" alt="EcoBala Logo" /></span>
                        EcoBala Kids
                    </a>
                    <div class="nav-links">
                        <a class="link" href="index.html" data-lang-text="nav_home">–ì–ª–∞–≤–Ω–∞—è</a>
                        <a class="link" href="register.html" data-lang-text="nav_switch">–°–º–µ–Ω–∏—Ç—å –ø–ª–∞—Ç—Ñ–æ—Ä–º—É</a>
                    </div>
                </div>

                <div class="actions">
                    <div class="language-switcher">
                        <div class="lang-indicator"></div>
                        <button class="lang-btn active" data-lang="ru">–†–£–°</button>
                        <button class="lang-btn" data-lang="kz">“ö–ê–ó</button>
                    </div>
                    <button class="btn btn-outline" id="logoutBtn" data-lang-text="logout">–í—ã–π—Ç–∏</button>
                </div>
            </div>
        </div>
    </header>

    <main>
        <div class="container">
            <div class="hero">
                <div class="card profile">
                    <div class="role-ring"></div>
                    <div class="avatar" aria-hidden="true">üë∂</div>
                    <div class="meta">
                        <h1 id="fullName">‚Äî</h1>
                        <p id="schoolClass">‚Äî</p>
                        <div class="row">
                            <div class="pill"><span aria-hidden="true">‚≠ê</span><span data-lang-text="points">–ë–∞–ª–ª—ã</span>: <span id="points">0</span></div>
                            <div class="pill"><span aria-hidden="true">üìà</span><span data-lang-text="level">–£—Ä–æ–≤–µ–Ω—å</span>: <span id="level">1</span></div>
                            <div class="pill"><span aria-hidden="true">üéÆ</span><span data-lang-text="games">–ò–≥—Ä—ã</span>: <span id="gamesTotal">0</span></div>
                            <div class="pill"><span aria-hidden="true">üìö</span><span data-lang-text="lessons">–£—Ä–æ–∫–∏</span>: <span id="lessonsTotal">0</span></div>
                        </div>
                    </div>
                </div>

                <div class="card stats">
                    <h2 data-lang-text="stats_title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                    <div class="grid">
                        <div class="stat">
                            <div class="num" id="rank">‚Äî</div>
                            <div class="label" data-lang-text="rank">–ú–µ—Å—Ç–æ –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ</div>
                        </div>
                        <div class="stat">
                            <div class="num" id="badgesCount">0</div>
                            <div class="label" data-lang-text="badges">–ó–Ω–∞—á–∫–∏</div>
                        </div>
                        <div class="stat">
                            <div class="num" id="age">‚Äî</div>
                            <div class="label" data-lang-text="age">–í–æ–∑—Ä–∞—Å—Ç</div>
                        </div>
                    </div>
                    <div class="hint" data-lang-text="kids_rules">Kids: —Ç–æ–ª—å–∫–æ –∏–≥—Ä—ã, —É—Ä–æ–∫–∏ –∏ –æ–Ω–ª–∞–π–Ω-–∫–≤–µ—Å—Ç—ã. –†–µ–∞–ª—å–Ω—ã–µ –≥–æ—Ä–æ–¥—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã.</div>
                </div>
            </div>

            <div class="dashboard">
                <div class="card">
                    <h2 class="dash-title" data-lang-text="dash_quick">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>
                    <div class="quick-actions">
                        <div class="qa">
                            <div class="top">
                                <div class="icon" aria-hidden="true">üéÆ</div>
                                <div style="font-weight:900;" data-lang-text="dash_games">–ò–≥—Ä—ã</div>
                            </div>
                            <div class="desc" data-lang-text="dash_games_desc">–°—ã–≥—Ä–∞–π—Ç–µ 3 –º–∏–Ω—É—Ç—ã –∏ –ø–æ–ª—É—á–∏—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –±–∞–ª–ª—ã.</div>
                            <button class="btn btn-primary" type="button" id="qaKidsGamesBtn" data-lang-text="dash_open">–û—Ç–∫—Ä—ã—Ç—å</button>
                        </div>
                        <div class="qa">
                            <div class="top">
                                <div class="icon" aria-hidden="true">üìö</div>
                                <div style="font-weight:900;" data-lang-text="dash_lessons">–£—Ä–æ–∫–∏</div>
                            </div>
                            <div class="desc" data-lang-text="dash_lessons_desc">–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ –∫–æ–Ω—Å–ø–µ–∫—Ç –∏ –ø—Ä–æ–π–¥–∏—Ç–µ –º–∏–Ω–∏‚Äë—Ç–µ—Å—Ç.</div>
                            <button class="btn btn-primary" type="button" id="qaKidsLessonsBtn" data-lang-text="dash_open">–û—Ç–∫—Ä—ã—Ç—å</button>
                        </div>
                        <div class="qa">
                            <div class="top">
                                <div class="icon" aria-hidden="true">üß©</div>
                                <div style="font-weight:900;" data-lang-text="dash_quests">–û–Ω–ª–∞–π–Ω‚Äë–∫–≤–µ—Å—Ç—ã</div>
                            </div>
                            <div class="desc" data-lang-text="dash_quests_desc">–ú–∏–Ω–∏‚Äë–∫–≤–µ—Å—Ç—ã –ø—Ä–æ —ç–∫–æ–ª–æ–≥–∏—é: —à–∞–≥–∏ –∏ –≤—ã–±–æ—Ä.</div>
                            <button class="btn btn-primary" type="button" id="qaKidsQuestsBtn" data-lang-text="dash_open">–û—Ç–∫—Ä—ã—Ç—å</button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2 class="dash-title" data-lang-text="dash_progress">–ü—Ä–æ–≥—Ä–µ—Å—Å</h2>
                    <div class="progress">
                        <div class="progress-row">
                            <span data-lang-text="dash_level">–£—Ä–æ–≤–µ–Ω—å</span>
                            <span id="levelProgressText">0/0</span>
                        </div>
                        <div class="bar"><div id="levelProgressBar"></div></div>
                        <div class="hint" data-lang-text="dash_tip">–°–æ–≤–µ—Ç: –ø—Ä–æ—Ö–æ–¥–∏—Ç–µ —É—Ä–æ–∫–∏ ‚Äî —Ç–∞–∫ –±—ã—Å—Ç—Ä–µ–µ —Ä–∞—Å—Ç—ë—Ç —É—Ä–æ–≤–µ–Ω—å.</div>
                    </div>
                </div>
            </div>

            <div class="app">
                <aside class="card sidebar">
                    <h2 data-lang-text="menu_title">–†–∞–∑–¥–µ–ª—ã</h2>
                    <div class="menu">
                        <button class="menu-btn active" data-panel="games"><span data-lang-text="menu_games">üéÆ –ò–≥—Ä—ã</span><span class="menu-badge" id="gamesDailyBadge">0/5</span></button>
                        <button class="menu-btn" data-panel="lessons"><span data-lang-text="menu_lessons">üìö –£—Ä–æ–∫–∏</span><span class="menu-badge" id="lessonsBadge">0</span></button>
                        <button class="menu-btn" data-panel="quests"><span data-lang-text="menu_quests">üß© –û–Ω–ª–∞–π–Ω‚Äë–∫–≤–µ—Å—Ç—ã</span><span class="menu-badge" id="questsBadge">0</span></button>
                        <button class="menu-btn" data-panel="rating"><span data-lang-text="menu_rating">üèÜ –†–µ–π—Ç–∏–Ω–≥</span><span class="menu-badge">Top 10</span></button>
                        <button class="menu-btn" data-panel="badges"><span data-lang-text="menu_badges">üèÖ –ó–Ω–∞—á–∫–∏</span><span class="menu-badge" id="badgesBadge">0</span></button>
                        <button class="menu-btn" data-panel="bot"><span data-lang-text="menu_bot">ü§ñ AI‚Äë–±–æ—Ç</span><span class="menu-badge" data-lang-text="menu_bot_badge">–ü–æ–º–æ—â—å</span></button>
                    </div>
                </aside>

                <section class="content">
                    <div class="card panel active" id="panel-games">
                        <h2 data-lang-text="games_title">–ò–≥—Ä—ã</h2>
                        <div class="notice" id="gamesNotice"></div>
                        <div class="cards" id="gamesList"></div>
                    </div>

                    <div class="card panel" id="panel-lessons">
                        <h2 data-lang-text="lessons_title">–£—Ä–æ–∫–∏</h2>
                        <div class="notice" id="lessonsNotice"></div>
                        <div class="cards" id="lessonsList"></div>
                        <div class="quiz" id="lessonQuiz" style="display:none;"></div>
                    </div>

                    <div class="card panel" id="panel-quests">
                        <h2 data-lang-text="quests_title">–û–Ω–ª–∞–π–Ω‚Äë–∫–≤–µ—Å—Ç—ã</h2>
                        <div class="notice" id="questsNotice"></div>
                        <div class="cards" id="questsList"></div>
                    </div>

                    <div class="card panel" id="panel-rating">
                        <h2 data-lang-text="rating_title">–†–µ–π—Ç–∏–Ω–≥ Kids</h2>
                        <div class="notice" data-lang-text="rating_hint">–§–∏–ª—å—Ç—Ä—É–π—Ç–µ –ø–æ —à–∫–æ–ª–µ –∏ –∫–ª–∞—Å—Å—É (–¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ).</div>
                        <div class="mini-row" style="margin-bottom:12px;">
                            <div class="mini-actions" style="flex:1;">
                                <select class="input" id="ratingSchool">
                                    <option value="" data-lang-text="rating_all_schools">–í—Å–µ —à–∫–æ–ª—ã</option>
                                </select>
                                <select class="input" id="ratingClass">
                                    <option value="" data-lang-text="rating_all_classes">–í—Å–µ –∫–ª–∞—Å—Å—ã</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5</option>
                                    <option value="6">6</option>
                                </select>
                            </div>
                            <button class="btn btn-outline" id="resetRatingBtn" data-lang-text="rating_reset">–°–±—Ä–æ—Å–∏—Ç—å</button>
                        </div>
                        <div class="list" id="ratingList"></div>
                    </div>

                    <div class="card panel" id="panel-badges">
                        <h2 data-lang-text="badges_title">–ó–Ω–∞—á–∫–∏</h2>
                        <div class="notice" data-lang-text="badges_hint">–ó–Ω–∞—á–∫–∏ –≤—ã–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è.</div>
                        <div class="badges" id="badgesList"></div>
                    </div>

                    <div class="card panel" id="panel-bot">
                        <h2 data-lang-text="bot_title">AI‚Äë–±–æ—Ç Kids</h2>
                        <div class="notice" data-lang-text="bot_hint">–ó–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã –ø—Ä–æ —ç–∫–æ–ª–æ–≥–∏—é –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏.</div>
                        <div class="bot-topics" id="botTopics"></div>
                        <div class="chat">
                            <div class="chat-box" id="chatBox"></div>
                            <form class="chat-form" id="chatForm">
                                <input class="input" id="chatInput" type="text" autocomplete="off" data-lang-placeholder="bot_placeholder" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–æ–ø—Ä–æ—Å..." />
                                <button class="btn btn-primary" type="submit" data-lang-text="bot_send">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                            </form>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <script>
        const translations = {
            ru: {
                nav_home: '–ì–ª–∞–≤–Ω–∞—è',
                nav_switch: '–°–º–µ–Ω–∏—Ç—å –ø–ª–∞—Ç—Ñ–æ—Ä–º—É',
                logout: '–í—ã–π—Ç–∏',
                points: '–ë–∞–ª–ª—ã',
                level: '–£—Ä–æ–≤–µ–Ω—å',
                games: '–ò–≥—Ä—ã',
                lessons: '–£—Ä–æ–∫–∏',
                stats_title: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞',
                rank: '–ú–µ—Å—Ç–æ –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ',
                badges: '–ó–Ω–∞—á–∫–∏',
                age: '–í–æ–∑—Ä–∞—Å—Ç',
                badges_title: '–ó–Ω–∞—á–∫–∏',
                kids_rules: 'Kids: —Ç–æ–ª—å–∫–æ –∏–≥—Ä—ã, —É—Ä–æ–∫–∏ –∏ –æ–Ω–ª–∞–π–Ω-–∫–≤–µ—Å—Ç—ã. –†–µ–∞–ª—å–Ω—ã–µ –≥–æ—Ä–æ–¥—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã.',
                menu_title: '–†–∞–∑–¥–µ–ª—ã',
                menu_games: 'üéÆ –ò–≥—Ä—ã',
                menu_lessons: 'üìö –£—Ä–æ–∫–∏',
                menu_quests: 'üß© –û–Ω–ª–∞–π–Ω‚Äë–∫–≤–µ—Å—Ç—ã',
                menu_rating: 'üèÜ –†–µ–π—Ç–∏–Ω–≥',
                menu_badges: 'üèÖ –ó–Ω–∞—á–∫–∏',
                menu_bot: 'ü§ñ AI‚Äë–±–æ—Ç',
                menu_bot_badge: '–ü–æ–º–æ—â—å',
                games_title: '–ò–≥—Ä—ã',
                lessons_title: '–£—Ä–æ–∫–∏',
                quests_title: '–û–Ω–ª–∞–π–Ω‚Äë–∫–≤–µ—Å—Ç—ã',
                rating_title: '–†–µ–π—Ç–∏–Ω–≥ Kids',
                rating_hint: '–§–∏–ª—å—Ç—Ä—É–π—Ç–µ –ø–æ —à–∫–æ–ª–µ –∏ –∫–ª–∞—Å—Å—É (–¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ).',
                rating_all_schools: '–í—Å–µ —à–∫–æ–ª—ã',
                rating_all_classes: '–í—Å–µ –∫–ª–∞—Å—Å—ã',
                rating_reset: '–°–±—Ä–æ—Å–∏—Ç—å',
                badges_hint: '–ó–Ω–∞—á–∫–∏ –≤—ã–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è.',
                bot_title: 'AI‚Äë–±–æ—Ç Kids',
                bot_hint: '–ó–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã –ø—Ä–æ —ç–∫–æ–ª–æ–≥–∏—é –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏.',
                bot_send: '–û—Ç–ø—Ä–∞–≤–∏—Ç—å',
                bot_placeholder: '–ù–∞–ø–∏—à–∏—Ç–µ –≤–æ–ø—Ä–æ—Å...',
                school_class: '–®–∫–æ–ª–∞: {school} ‚Ä¢ –ö–ª–∞—Å—Å: {class}',
                games_notice: '–°–µ–≥–æ–¥–Ω—è –¥–æ—Å—Ç—É–ø–Ω–æ –∏–≥—Ä: {left} –∏–∑ 5. –ö–∞–∂–¥–∞—è –∏–≥—Ä–∞ –¥–ª–∏—Ç—Å—è 3 –º–∏–Ω—É—Ç—ã.',
                lessons_notice: '–ü—Ä–æ—Ö–æ–¥–∏—Ç–µ —É—Ä–æ–∫–∏ –∏ –ø–æ–ª—É—á–∞–π—Ç–µ +10‚Äì20 –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –±–∞–ª–ª–æ–≤.',
                quests_notice: '–û–Ω–ª–∞–π–Ω‚Äë–∫–≤–µ—Å—Ç—ã –±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –≥–æ—Ä–æ–¥—Å–∫–∏—Ö –∑–∞–¥–∞–Ω–∏–π. –í—ã–ø–æ–ª–Ω–∏–ª–∏ ‚Äî –ø–æ–ª—É—á–∏–ª–∏ –±–∞–ª–ª—ã.',
                start: '–ù–∞—á–∞—Ç—å',
                complete: '–ó–∞–≤–µ—Ä—à–∏—Ç—å',
                open: '–û—Ç–∫—Ä—ã—Ç—å',
                done: '–í—ã–ø–æ–ª–Ω–µ–Ω–æ',
                daily_limit: '–õ–∏–º–∏—Ç –∏–≥—Ä –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –∏—Å—á–µ—Ä–ø–∞–Ω (5/5). –í–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ—Å—å –∑–∞–≤—Ç—Ä–∞!',
                timer_title: '–ò–≥—Ä–∞ –∏–¥—ë—Ç...',
                timer_left: '–û—Å—Ç–∞–ª–æ—Å—å: {time}',
                timer_finish: '–ó–∞–≤–µ—Ä—à–∏—Ç—å –∏ –ø–æ–ª—É—á–∏—Ç—å –±–∞–ª–ª—ã',
                game_reward: '–ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! +{points} –±–∞–ª–ª–æ–≤ (—Å—á—ë—Ç: {score})',
                lesson_reward: '–£—Ä–æ–∫ –ø—Ä–æ–π–¥–µ–Ω! +{points} –±–∞–ª–ª–æ–≤',
                quest_reward: '–ö–≤–µ—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω! +{points} –±–∞–ª–ª–æ–≤',
                game_score: '–°—á—ë—Ç: {score}',
                g_trash_sort_title: '–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –º—É—Å–æ—Ä–∞',
                g_save_forest_title: '–°–ø–∞—Å–∏ –ª–µ—Å',
                g_find_recycle_title: '–ù–∞–π–¥–∏ –ø–µ—Ä–µ—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º–æ–µ',
                g_eco_quiz_title: '–≠–∫–æ-–≤–∏–∫—Ç–æ—Ä–∏–Ω–∞',
                g_clean_river_title: '–ß–∏—Å—Ç–∞—è —Ä–µ–∫–∞',
                trash_sort_instruction: '–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –±–∞–∫—ñ: —Å–∏–Ω–∏–π ‚Äî –ø–µ—Ä–µ—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º–æ–µ, –∑–µ–ª—ë–Ω—ã–π ‚Äî –æ—Ä–≥–∞–Ω–∏–∫–∞, —Å–µ—Ä—ã–π ‚Äî –æ–±—â–∏–π –º—É—Å–æ—Ä.',
                save_forest_instruction: '–ö–ª–∏–∫–∞–π—Ç–µ –ø–æ —É–≥—Ä–æ–∑–∞–º (–æ–≥–æ–Ω—å, –¥—ã–º, –Ω–∞—Å–µ–∫–æ–º—ã–µ), —á—Ç–æ–±—ã —Å–ø–∞—Å—Ç–∏ –ª–µ—Å. –ù–µ –¥–∞–≤–∞–π—Ç–µ –∏–º –Ω–∞–≤—Ä–µ–¥–∏—Ç—å –¥–µ—Ä–µ–≤—å—è–º!',
                find_recycle_instruction: '–ù–∞–∂–∏–º–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞—Ç—å. –ó–∞ –æ—à–∏–±–∫—É —Å–Ω–∏–º–∞—é—Ç—Å—è –æ—á–∫–∏!',
                bin_recycle: '–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞',
                bin_organic: '–û—Ä–≥–∞–Ω–∏–∫–∞',
                bin_general: '–û–±—â–∏–π',
                game_placeholder: '–≠—Ç–∞ –∏–≥—Ä–∞ –ø–æ–∫–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥—É—é!',
                quiz_title: '–ú–∏–Ω–∏‚Äë—Ç–µ—Å—Ç',
                quiz_submit: '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å',
                quiz_pass: '–û—Ç–ª–∏—á–Ω–æ! –í—ã –ø—Ä–æ—à–ª–∏ —Ç–µ—Å—Ç.',
                quiz_fail: '–ü–æ—á—Ç–∏! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.',
                lesson_video_soon: 'üé• –í–∏–¥–µ–æ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–∑–∂–µ.',
                quiz_need_answer: '–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞.',
                quiz_correct: '–ü—Ä–∞–≤–∏–ª—å–Ω–æ!',
                quiz_wrong: '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ.',
                quiz_result: '–†–µ–∑—É–ª—å—Ç–∞—Ç: {score}/{total}. –ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º {min} –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö.',
                badge_first_lesson: 'üèÖ –ü–µ—Ä–≤—ã–π —É—Ä–æ–∫',
                badge_10_games: 'üéÆ 10 –∏–≥—Ä',
                badge_100_points: 'üíé 100 –±–∞–ª–ª–æ–≤',
                badge_best_class: 'üèÜ –õ—É—á—à–∏–π –≤ –∫–ª–∞—Å—Å–µ',
                rating_me: '–≠—Ç–æ –≤—ã',
                bot_greet: '–ü—Ä–∏–≤–µ—Ç! –Ø —ç–∫–æ‚Äë–ø–æ–º–æ—â–Ω–∏–∫ EcoBala. –°–ø—Ä–æ—Å–∏ –º–µ–Ω—è –ø—Ä–æ —ç–∫–æ–ª–æ–≥–∏—é!',
                bot_unknown: '–Ø –æ–±—ä—è—Å–Ω—é –ø—Ä–æ—â–µ: –ø–æ–ø—Ä–æ–±—É–π —Å–ø—Ä–æ—Å–∏—Ç—å –ø—Ä–æ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫—É, –≤–æ–¥—É, –ª–µ—Å –∏–ª–∏ –º—É—Å–æ—Ä.',
                bot_topic_khromtau: 'üåø –ü—Ä–∏—Ä–æ–¥–∞ –•—Ä–æ–º—Ç–∞—É',
                bot_topic_better: '‚ú® –ö–∞–∫ —É–ª—É—á—à–∏—Ç—å –ø—Ä–∏—Ä–æ–¥—É',
                bot_topic_kids_teen: 'üßí Kids –∏ Teen',
                bot_topic_recycle: '‚ôªÔ∏è –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞'
                ,dash_quick: '–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è'
                ,dash_games: '–ò–≥—Ä—ã'
                ,dash_games_desc: '–°—ã–≥—Ä–∞–π—Ç–µ 3 –º–∏–Ω—É—Ç—ã –∏ –ø–æ–ª—É—á–∏—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –±–∞–ª–ª—ã.'
                ,dash_lessons: '–£—Ä–æ–∫–∏'
                ,dash_lessons_desc: '–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ –∫–æ–Ω—Å–ø–µ–∫—Ç –∏ –ø—Ä–æ–π–¥–∏—Ç–µ –º–∏–Ω–∏‚Äë—Ç–µ—Å—Ç.'
                ,dash_quests: '–û–Ω–ª–∞–π–Ω‚Äë–∫–≤–µ—Å—Ç—ã'
                ,dash_quests_desc: '–ú–∏–Ω–∏‚Äë–∫–≤–µ—Å—Ç—ã –ø—Ä–æ —ç–∫–æ–ª–æ–≥–∏—é: —à–∞–≥–∏ –∏ –≤—ã–±–æ—Ä.'
                ,dash_open: '–û—Ç–∫—Ä—ã—Ç—å'
                ,dash_progress: '–ü—Ä–æ–≥—Ä–µ—Å—Å'
                ,dash_level: '–£—Ä–æ–≤–µ–Ω—å'
                ,dash_tip: '–°–æ–≤–µ—Ç: –ø—Ä–æ—Ö–æ–¥–∏—Ç–µ —É—Ä–æ–∫–∏ ‚Äî —Ç–∞–∫ –±—ã—Å—Ç—Ä–µ–µ —Ä–∞—Å—Ç—ë—Ç —É—Ä–æ–≤–µ–Ω—å.'
            },
            kz: {
                nav_home: '–ë–∞—Å—Ç—ã –±–µ—Ç',
                nav_switch: '–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞–Ω—ã –∞—É—ã—Å—Ç—ã—Ä—É',
                logout: '–®—ã“ì—É',
                points: '“∞–ø–∞–π',
                level: '–î–µ“£–≥–µ–π',
                games: '–û–π—ã–Ω',
                lessons: '–°–∞–±–∞“õ',
                stats_title: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞',
                rank: '–†–µ–π—Ç–∏–Ω–≥—Ç–µ–≥—ñ –æ—Ä–Ω—ã',
                badges: '–ë–µ–ª–≥—ñ–ª–µ—Ä',
                age: '–ñ–∞—Å—ã',
                badges_title: '–ë–µ–ª–≥—ñ–ª–µ—Ä',
                kids_rules: 'Kids: —Ç–µ–∫ –æ–π—ã–Ω–¥–∞—Ä, —Å–∞–±–∞“õ—Ç–∞—Ä –∂”ô–Ω–µ –æ–Ω–ª–∞–π–Ω‚Äë–∫–≤–µ—Å—Ç—Ç–µ—Ä. –ù–∞“õ—Ç—ã “õ–∞–ª–∞–ª—ã“õ —Ç–∞–ø—Å—ã—Ä–º–∞–ª–∞—Ä “õ–æ–ª–∂–µ—Ç—ñ–º—Å—ñ–∑.',
                menu_title: '–ë”©–ª—ñ–º–¥–µ—Ä',
                menu_games: 'üéÆ –û–π—ã–Ω–¥–∞—Ä',
                menu_lessons: 'üìö –°–∞–±–∞“õ—Ç–∞—Ä',
                menu_quests: 'üß© –û–Ω–ª–∞–π–Ω‚Äë–∫–≤–µ—Å—Ç—Ç–µ—Ä',
                menu_rating: 'üèÜ –†–µ–π—Ç–∏–Ω–≥',
                menu_badges: 'üèÖ –ë–µ–ª–≥—ñ–ª–µ—Ä',
                menu_bot: 'ü§ñ AI‚Äë–±–æ—Ç',
                menu_bot_badge: '–ö”©–º–µ–∫',
                games_title: '–û–π—ã–Ω–¥–∞—Ä',
                lessons_title: '–°–∞–±–∞“õ—Ç–∞—Ä',
                quests_title: '–û–Ω–ª–∞–π–Ω‚Äë–∫–≤–µ—Å—Ç—Ç–µ—Ä',
                rating_title: 'Kids —Ä–µ–π—Ç–∏–Ω–≥—ñ',
                rating_hint: '–ú–µ–∫—Ç–µ–ø –∂”ô–Ω–µ —Å—ã–Ω—ã–ø –±–æ–π—ã–Ω—à–∞ —Å“Ø–∑–≥—ñ–ª–µ–π –∞–ª–∞—Å—ã–∑ (–¥–µ—Ä–µ–∫—Ç–µ—Ä –æ—Å—ã “õ“±—Ä—ã–ª“ì—ã–¥–∞ —Å–∞“õ—Ç–∞–ª–∞–¥—ã).',
                rating_all_schools: '–ë–∞—Ä–ª—ã“õ –º–µ–∫—Ç–µ–ø',
                rating_all_classes: '–ë–∞—Ä–ª—ã“õ —Å—ã–Ω—ã–ø',
                rating_reset: '–¢–∞–∑–∞—Ä—Ç—É',
                badges_hint: '–ë–µ–ª–≥—ñ–ª–µ—Ä –∂–µ—Ç—ñ—Å—Ç—ñ–∫—Ç–µ—Ä “Ø—à—ñ–Ω –∞–≤—Ç–æ–º–∞—Ç—Ç—ã —Ç“Ø—Ä–¥–µ –±–µ—Ä—ñ–ª–µ–¥—ñ.',
                bot_title: 'Kids AI‚Äë–±–æ—Ç',
                bot_hint: '–≠–∫–æ–ª–æ–≥–∏—è —Ç—É—Ä–∞–ª—ã “õ–∞—Ä–∞–ø–∞–π—ã–º —Å”©–∑–¥–µ—Ä–º–µ–Ω —Å“±—Ä–∞“£—ã–∑.',
                bot_send: '–ñ—ñ–±–µ—Ä—É',
                bot_placeholder: '–°“±—Ä–∞“ì—ã“£—ã–∑–¥—ã –∂–∞–∑—ã“£—ã–∑...',
                school_class: '–ú–µ–∫—Ç–µ–ø: {school} ‚Ä¢ –°—ã–Ω—ã–ø: {class}',
                games_notice: '–ë“Ø–≥—ñ–Ω “õ–æ–ª–∂–µ—Ç—ñ–º–¥—ñ –æ–π—ã–Ω: {left} / 5. ”ò—Ä –æ–π—ã–Ω 3 –º–∏–Ω—É—Ç“õ–∞ —Å–æ–∑—ã–ª–∞–¥—ã.',
                lessons_notice: '–°–∞–±–∞“õ –æ“õ—ã–ø, +10‚Äì20 –≤–∏—Ä—Ç—É–∞–ª–¥—ã “±–ø–∞–π –∞–ª—ã“£—ã–∑.',
                quests_notice: '–û–Ω–ª–∞–π–Ω‚Äë–∫–≤–µ—Å—Ç—Ç–µ—Ä –Ω–∞“õ—Ç—ã “õ–∞–ª–∞–ª—ã“õ —Ç–∞–ø—Å—ã—Ä–º–∞–ª–∞—Ä—Å—ã–∑. –û—Ä—ã–Ω–¥–∞—Å–∞“£—ã–∑ ‚Äî “±–ø–∞–π –∞–ª–∞—Å—ã–∑.',
                start: '–ë–∞—Å—Ç–∞—É',
                complete: '–ê—è“õ—Ç–∞—É',
                open: '–ê—à—É',
                done: '–û—Ä—ã–Ω–¥–∞–ª–¥—ã',
                daily_limit: '–ë“Ø–≥—ñ–Ω–≥—ñ –æ–π—ã–Ω –ª–∏–º–∏—Ç—ñ –±—ñ—Ç—Ç—ñ (5/5). –ï—Ä—Ç–µ“£ “õ–∞–π—Ç–∞ –∫–µ–ª—ñ“£—ñ–∑!',
                timer_title: '–û–π—ã–Ω –∂“Ø—Ä—ñ–ø –∂–∞—Ç—ã—Ä...',
                timer_left: '“ö–∞–ª–¥—ã: {time}',
                timer_finish: '–ê—è“õ—Ç–∞–ø, “±–ø–∞–π –∞–ª—É',
                game_reward: '–û–π—ã–Ω –∞—è“õ—Ç–∞–ª–¥—ã! +{points} “±–ø–∞–π (—Å—á—ë—Ç: {score})',
                lesson_reward: '–°–∞–±–∞“õ –∞—è“õ—Ç–∞–ª–¥—ã! +{points} “±–ø–∞–π',
                quest_reward: '–ö–≤–µ—Å—Ç –æ—Ä—ã–Ω–¥–∞–ª–¥—ã! +{points} “±–ø–∞–π',
                game_score: '–ï—Å–µ–ø: {score}',
                g_trash_sort_title: '“ö–æ“õ—ã—Å —Å“±—Ä—ã–ø—Ç–∞—É',
                g_save_forest_title: '–û—Ä–º–∞–Ω–¥—ã “õ“±—Ç“õ–∞—Ä',
                g_find_recycle_title: '“ö–∞–π—Ç–∞ ”©“£–¥–µ–ª–µ—Ç—ñ–Ω–¥—ñ —Ç–∞–±',
                g_eco_quiz_title: '–≠–∫–æ-–≤–∏–∫—Ç–æ—Ä–∏–Ω–∞',
                g_clean_river_title: '–¢–∞–∑–∞ ”©–∑–µ–Ω',
                trash_sort_instruction: '–ó–∞—Ç—Ç–∞—Ä–¥—ã –¥“±—Ä—ã—Å –∫–æ–Ω—Ç–µ–π–ª–µ—Ä–≥–µ —Å“Ø–π—Ä–µ“£—ñ–∑: –∫”©–∫ ‚Äî “õ–∞–π—Ç–∞ ”©“£–¥–µ–ª–µ—Ç—ñ–Ω, –∂–∞—Å—ã–ª ‚Äî –æ—Ä–≥–∞–Ω–∏–∫–∞–ª—ã“õ, —Å“±—Ä ‚Äî –∂–∞–ª–ø—ã “õ–æ“õ—ã—Å.',
                save_forest_instruction: '“ö–∞—Ç–µ—Ä–ª–µ—Ä–¥—ñ (–æ—Ç, —Ç“Ø—Ç—ñ–Ω, –∂”ô–Ω–¥—ñ–∫—Ç–µ—Ä) –±–∞—Å—ã–ø, –æ—Ä–º–∞–Ω–¥—ã “õ“±—Ç“õ–∞—Ä—ã“£—ã–∑. –ê“ì–∞—à—Ç–∞—Ä“ì–∞ –∑–∏—è–Ω –∫–µ–ª—Ç—ñ—Ä–º–µ“£—ñ–∑!',
                find_recycle_instruction: '–¢–µ–∫ “õ–∞–π—Ç–∞ ”©“£–¥–µ–ª–µ—Ç—ñ–Ω –∑–∞—Ç—Ç–∞—Ä–¥—ã –±–∞—Å—ã“£—ã–∑. “ö–∞—Ç–µ “Ø—à—ñ–Ω “±–ø–∞–π –∞–ª—ã–Ω–∞–¥—ã!',
                bin_recycle: '“ö–∞–π—Ç–∞ ”©“£–¥–µ—É',
                bin_organic: '–û—Ä–≥–∞–Ω–∏–∫–∞–ª—ã“õ',
                bin_general: '–ñ–∞–ª–ø—ã',
                game_placeholder: '–ë“±–ª –æ–π—ã–Ω ”ô–∑—ñ—Ä–ª–µ–Ω—É–¥–µ. –ë–∞—Å“õ–∞—Å—ã–Ω –∫”©—Ä—ñ“£—ñ–∑!',
                quiz_title: '–ú–∏–Ω–∏‚Äë—Ç–µ—Å—Ç',
                quiz_submit: '–¢–µ–∫—Å–µ—Ä—É',
                quiz_pass: '”®—Ç–µ –∂–∞“õ—Å—ã! –¢–µ—Å—Ç—Ç–µ–Ω ”©—Ç—Ç—ñ“£—ñ–∑.',
                quiz_fail: '–ê–∑ “õ–∞–ª–¥—ã! “ö–∞–π—Ç–∞ –∫”©—Ä—ñ“£—ñ–∑.',
                lesson_video_soon: 'üé• –ë–µ–π–Ω–µ –∫–µ–π—ñ–Ω—ñ—Ä–µ–∫ “õ–æ—Å—ã–ª–∞–¥—ã.',
                quiz_need_answer: '–ñ–∞—É–∞–ø –Ω“±—Å“õ–∞—Å—ã–Ω —Ç–∞“£–¥–∞“£—ã–∑.',
                quiz_correct: '–î“±—Ä—ã—Å!',
                quiz_wrong: '–î“±—Ä—ã—Å –µ–º–µ—Å.',
                quiz_result: '–ù”ô—Ç–∏–∂–µ: {score}/{total}. –ö–µ–º—ñ–Ω–¥–µ {min} –¥“±—Ä—ã—Å –∂–∞—É–∞–ø –∫–µ—Ä–µ–∫.',
                badge_first_lesson: 'üèÖ –ê–ª“ì–∞—à“õ—ã —Å–∞–±–∞“õ',
                badge_10_games: 'üéÆ 10 –æ–π—ã–Ω',
                badge_100_points: 'üíé 100 “±–ø–∞–π',
                badge_best_class: 'üèÜ –°—ã–Ω—ã–ø—Ç–∞“ì—ã “Ø–∑–¥—ñ–∫',
                rating_me: '–ë“±–ª —Å—ñ–∑',
                bot_greet: '–°”ô–ª–µ–º! –ú–µ–Ω EcoBala —ç–∫–æ‚Äë–∫”©–º–µ–∫—à—ñ—Å—ñ–º—ñ–Ω. –≠–∫–æ–ª–æ–≥–∏—è —Ç—É—Ä–∞–ª—ã —Å“±—Ä–∞“£—ã–∑!',
                bot_unknown: '“ö–∞—Ä–∞–ø–∞–π—ã–º –∞–π—Ç–∞–π—ã–Ω: “õ–∞–π—Ç–∞ ”©“£–¥–µ—É, —Å—É, –æ—Ä–º–∞–Ω –Ω–µ–º–µ—Å–µ “õ–æ“õ—ã—Å —Ç—É—Ä–∞–ª—ã —Å“±—Ä–∞–ø –∫”©—Ä—ñ“£—ñ–∑.',
                bot_topic_khromtau: 'üåø –•—Ä–æ–º—Ç–∞—É —Ç–∞–±–∏“ì–∞—Ç—ã',
                bot_topic_better: '‚ú® –¢–∞–±–∏“ì–∞—Ç—Ç—ã –∂–∞“õ—Å–∞—Ä—Ç—É',
                bot_topic_kids_teen: 'üßí Kids –∂”ô–Ω–µ Teen',
                bot_topic_recycle: '‚ôªÔ∏è “ö–∞–π—Ç–∞ ”©“£–¥–µ—É'
                ,dash_quick: '–ñ—ã–ª–¥–∞–º ”ô—Ä–µ–∫–µ—Ç—Ç–µ—Ä'
                ,dash_games: '–û–π—ã–Ω–¥–∞—Ä'
                ,dash_games_desc: '3 –º–∏–Ω—É—Ç –æ–π–Ω–∞–ø, –≤–∏—Ä—Ç—É–∞–ª–¥—ã “±–ø–∞–π –∞–ª—ã“£—ã–∑.'
                ,dash_lessons: '–°–∞–±–∞“õ—Ç–∞—Ä'
                ,dash_lessons_desc: '–ö–æ–Ω—Å–ø–µ–∫—Ç –æ“õ—ã–ø, –º–∏–Ω–∏‚Äë—Ç–µ—Å—Ç—Ç–µ–Ω ”©—Ç—ñ“£—ñ–∑.'
                ,dash_quests: '–û–Ω–ª–∞–π–Ω‚Äë–∫–≤–µ—Å—Ç—Ç–µ—Ä'
                ,dash_quests_desc: '–≠–∫–æ–ª–æ–≥–∏—è —Ç—É—Ä–∞–ª—ã –º–∏–Ω–∏‚Äë–∫–≤–µ—Å—Ç—Ç–µ—Ä: “õ–∞–¥–∞–º–¥–∞—Ä –∂”ô–Ω–µ —Ç–∞“£–¥–∞—É.'
                ,dash_open: '–ê—à—É'
                ,dash_progress: '–ü—Ä–æ–≥—Ä–µ—Å—Å'
                ,dash_level: '–î–µ“£–≥–µ–π'
                ,dash_tip: '–ö–µ“£–µ—Å: —Å–∞–±–∞“õ –æ“õ—ã—Å–∞“£—ã–∑ ‚Äî –¥–µ“£–≥–µ–π —Ç–µ–∑ ”©—Å–µ–¥—ñ.'
            }
        };

        const schoolNameById = {
            '2': { ru: '‚Ññ2 –•—Ä–æ–º—Ç–∞—É—Å–∫–∞—è –≥–∏–º–Ω–∞–∑–∏—è', kz: '‚Ññ2 –•—Ä–æ–º—Ç–∞—É –≥–∏–º–Ω–∞–∑–∏—è—Å—ã' },
            '5': { ru: '‚Ññ5 –•—Ä–æ–º—Ç–∞—É—Å–∫–∞—è –≥–∏–º–Ω–∞–∑–∏—è', kz: '‚Ññ5 –•—Ä–æ–º—Ç–∞—É –≥–∏–º–Ω–∞–∑–∏—è—Å—ã' },
            '6': { ru: '‚Ññ6 –•—Ä–æ–º—Ç–∞—É—Å–∫–∞—è –≥–∏–º–Ω–∞–∑–∏—è', kz: '‚Ññ6 –•—Ä–æ–º—Ç–∞—É –≥–∏–º–Ω–∞–∑–∏—è—Å—ã' },
            '1': { ru: '‚Ññ1 –°—Ä–µ–¥–Ω—è—è —à–∫–æ–ª–∞', kz: '‚Ññ1 –û—Ä—Ç–∞ –º–µ–∫—Ç–µ–ø' },
            '3': { ru: '‚Ññ3 –°—Ä–µ–¥–Ω—è—è —à–∫–æ–ª–∞', kz: '‚Ññ3 –û—Ä—Ç–∞ –º–µ–∫—Ç–µ–ø' },
            '4': { ru: '‚Ññ4 –°—Ä–µ–¥–Ω—è—è —à–∫–æ–ª–∞', kz: '‚Ññ4 –û—Ä—Ç–∞ –º–µ–∫—Ç–µ–ø' },
            '7': { ru: '‚Ññ7 –°—Ä–µ–¥–Ω—è—è —à–∫–æ–ª–∞', kz: '‚Ññ7 –û—Ä—Ç–∞ –º–µ–∫—Ç–µ–ø' }
        };

        function applyLangToUI(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('data-lang') === lang);
            });
            document.querySelectorAll('.lang-indicator').forEach(ind => {
                ind.classList.toggle('kazakh', lang === 'kz');
            });
        }

        function t(lang, key, vars) {
            let s = (translations[lang] && translations[lang][key]) || '';
            if (vars) {
                Object.keys(vars).forEach(k => {
                    s = s.replaceAll(`{${k}}`, String(vars[k]));
                });
            }
            return s;
        }

        function updateLanguage(lang) {
            document.querySelectorAll('[data-lang-text]').forEach(el => {
                const key = el.getAttribute('data-lang-text');
                const val = translations[lang] && translations[lang][key];
                if (val) el.textContent = val;
            });

            document.querySelectorAll('[data-lang-placeholder]').forEach(el => {
                const key = el.getAttribute('data-lang-placeholder');
                const val = translations[lang] && translations[lang][key];
                if (val) el.setAttribute('placeholder', val);
            });

            const user = getUser();
            if (!user) return;

            const schoolObj = schoolNameById[String(user.school)] || null;
            const schoolName = schoolObj ? schoolObj[lang] : (user.school || '‚Äî');
            document.getElementById('schoolClass').textContent = t(lang, 'school_class', { school: schoolName, class: user.class || '‚Äî' });

            renderGames(lang);
            renderLessons(lang);
            renderQuests(lang);
            renderBadges(user, lang);
            renderRating(lang);
            ensureBotGreeting(lang);
            renderBotTopics(lang);
        }

        function setLanguage(lang) {
            localStorage.setItem('selectedLanguage', lang);
            applyLangToUI(lang);
            updateLanguage(lang);
        }

        function getUser() {
            try {
                const raw = localStorage.getItem('ecobalaUser');
                if (!raw) return null;
                return JSON.parse(raw);
            } catch {
                return null;
            }
        }

        function normalizeKidsUser(user) {
            const u = { ...user };
            if (u.role !== 'kids') return u;
            u.points = Number(u.points ?? 0);
            u.level = Number(u.level ?? 1);
            u.tasks_completed = Number(u.tasks_completed ?? 0);
            u.kids_games_total = Number(u.kids_games_total ?? 0);
            u.kids_lessons_done = Array.isArray(u.kids_lessons_done) ? u.kids_lessons_done : [];
            u.kids_quests_done = Array.isArray(u.kids_quests_done) ? u.kids_quests_done : [];
            u.kids_points_history = Array.isArray(u.kids_points_history) ? u.kids_points_history : [];
            return u;
        }

        function saveUser(user) {
            localStorage.setItem('ecobalaUser', JSON.stringify(user));
        }

        function todayKey() {
            const d = new Date();
            const yyyy = d.getFullYear();
            const mm = String(d.getMonth() + 1).padStart(2, '0');
            const dd = String(d.getDate()).padStart(2, '0');
            return `${yyyy}-${mm}-${dd}`;
        }

        function getDailyGameState() {
            const key = `ecobalaKidsGamesDaily:${todayKey()}`;
            try {
                const raw = localStorage.getItem(key);
                if (!raw) return { key, count: 0 };
                const obj = JSON.parse(raw);
                return { key, count: Number(obj.count ?? 0) };
            } catch {
                return { key, count: 0 };
            }
        }

        function setDailyGameCount(key, count) {
            localStorage.setItem(key, JSON.stringify({ count }));
        }

        function addPoints(user, points, reason) {
            const p = Number(points);
            user.points = Number(user.points ?? 0) + p;
            user.level = Math.max(1, Math.floor(user.points / 100) + 1);
            user.kids_points_history = user.kids_points_history || [];
            user.kids_points_history.unshift({ date: todayKey(), points: p, reason });
            saveUser(user);
            updateHeaderStats(user);
            updateLeaderboard(user);
        }

        function updateHeaderStats(user) {
            document.getElementById('points').textContent = String(user.points ?? 0);
            document.getElementById('level').textContent = String(user.level ?? 1);
            document.getElementById('gamesTotal').textContent = String(user.kids_games_total ?? 0);
            document.getElementById('lessonsTotal').textContent = String((user.kids_lessons_done || []).length);

            const lvl = Number(user.level ?? 1);
            const pts = Number(user.points ?? 0);
            const base = (lvl - 1) * 100;
            const next = lvl * 100;
            const cur = Math.max(0, pts - base);
            const need = Math.max(1, next - base);
            const pct = Math.max(0, Math.min(100, Math.round((cur / need) * 100)));
            const bar = document.getElementById('levelProgressBar');
            const text = document.getElementById('levelProgressText');
            if (bar) bar.style.width = `${pct}%`;
            if (text) text.textContent = `${cur}/${need}`;

            document.getElementById('badgesCount').textContent = String(getEarnedBadges(user).length);
            document.getElementById('badgesBadge').textContent = String(getEarnedBadges(user).length);
            document.getElementById('age').textContent = String(user.age ?? '‚Äî');
        }

        const kidsGames = [
            { id: 'trash_sort', icon: 'üóëÔ∏è', titleKey: 'g1_t', descKey: 'g1_d' },
            { id: 'save_forest', icon: 'üå≤', titleKey: 'g2_t', descKey: 'g2_d' },
            { id: 'eco_quiz', icon: '‚ùì', titleKey: 'g3_t', descKey: 'g3_d' },
            { id: 'find_recycle', icon: '‚ôªÔ∏è', titleKey: 'g4_t', descKey: 'g4_d' },
            { id: 'clean_river', icon: 'üåä', titleKey: 'g5_t', descKey: 'g5_d' }
        ];

        const kidsLessons = [
            { id: 'eco_intro', icon: 'üåç', titleKey: 'l1_t', descKey: 'l1_d' },
            { id: 'sorting', icon: '‚ôªÔ∏è', titleKey: 'l2_t', descKey: 'l2_d' },
            { id: 'water', icon: 'üíß', titleKey: 'l3_t', descKey: 'l3_d' },
            { id: 'forest', icon: 'üå≥', titleKey: 'l4_t', descKey: 'l4_d' },
            { id: 'recycling', icon: 'üè≠', titleKey: 'l5_t', descKey: 'l5_d' },
            { id: 'red_book_kz', icon: 'üìï', titleKey: 'l6_t', descKey: 'l6_d' },
            { id: 'animals_kz', icon: 'ü¶å', titleKey: 'l7_t', descKey: 'l7_d' },
            { id: 'city_litter_birds', icon: 'üê¶', titleKey: 'l8_t', descKey: 'l8_d' }
        ];

        const kidsQuests = [
            { id: 'save_animal', icon: 'ü¶ä', titleKey: 'q1_t', descKey: 'q1_d' },
            { id: 'plant_tree', icon: 'üå±', titleKey: 'q2_t', descKey: 'q2_d' },
            { id: 'eco_rescue', icon: 'üß©', titleKey: 'q3_t', descKey: 'q3_d' }
        ];

        function extendTranslations() {
            Object.assign(translations.ru, {
                g1_t: '–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –º—É—Å–æ—Ä–∞', g1_d: '–†–∞–∑–ª–æ–∂–∏ –æ—Ç—Ö–æ–¥—ã –ø–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º (3 –º–∏–Ω—É—Ç—ã).',
                g2_t: '–°–ø–∞—Å–∏ –ª–µ—Å', g2_d: '–ü–æ–º–æ–≥–∏ –ª–µ—Å—É: –≤—ã–±–∏—Ä–∞–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (3 –º–∏–Ω—É—Ç—ã).',
                g3_t: '–≠–∫–æ‚Äë–≤–∏–∫—Ç–æ—Ä–∏–Ω–∞', g3_d: '–ë—ã—Å—Ç—Ä—ã–µ –≤–æ–ø—Ä–æ—Å—ã –ø—Ä–æ –ø—Ä–∏—Ä–æ–¥—É –∏ —ç–∫–æ–ª–æ–≥–∏—é (3 –º–∏–Ω—É—Ç—ã).',
                g4_t: '–ù–∞–π–¥–∏ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫—É', g4_d: '–ù–∞–π–¥–∏, —á—Ç–æ –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞—Ç—å, –∞ —á—Ç–æ –Ω–µ—Ç (3 –º–∏–Ω—É—Ç—ã).',
                g5_t: '–û—á–∏—Å—Ç–∏ —Ä–µ–∫—É', g5_d: '–£–±–µ—Ä–∏ –º—É—Å–æ—Ä –∏–∑ –≤–æ–¥—ã –∏ —Å–ø–∞—Å–∏ –∂–∏–≤–æ—Ç–Ω—ã—Ö (3 –º–∏–Ω—É—Ç—ã).',
                l1_t: '–ß—Ç–æ —Ç–∞–∫–æ–µ —ç–∫–æ–ª–æ–≥–∏—è', l1_d: '–£–∑–Ω–∞–π –æ—Å–Ω–æ–≤—ã —ç–∫–æ–ª–æ–≥–∏–∏ –∏ –ø–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ.',
                l2_t: '–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –º—É—Å–æ—Ä–∞', l2_d: '–ö–∞–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—Ö–æ–¥—ã –∏ –∑–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ.',
                l3_t: '–í–æ–¥–∞ –∏ –ø—Ä–∏—Ä–æ–¥–∞', l3_d: '–ö–∞–∫ –±–µ—Ä–µ—á—å –≤–æ–¥—É –∏ –∑–∞—â–∏—â–∞—Ç—å –ø—Ä–∏—Ä–æ–¥—É.',
                l4_t: '–õ–µ—Å –∏ –¥–µ—Ä–µ–≤—å—è', l4_d: '–ü–æ—á–µ–º—É –ª–µ—Å –≤–∞–∂–µ–Ω –∏ –∫–∞–∫ –µ–≥–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å.',
                l5_t: '–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞', l5_d: '–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å –º—É—Å–æ—Ä–æ–º –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏.',
                l6_t: '–ö—Ä–∞—Å–Ω–∞—è –∫–Ω–∏–≥–∞ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞', l6_d: '–ü–æ—á–µ–º—É —Ä–µ–¥–∫–∏—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö –Ω—É–∂–Ω–æ –±–µ—Ä–µ—á—å –∏ –∫–∞–∫ —ç—Ç–æ –¥–µ–ª–∞—Ç—å.',
                l7_t: '–ñ–∏–≤–æ—Ç–Ω—ã–µ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞', l7_d: '–ü–æ–∑–Ω–∞–∫–æ–º—å—Å—è —Å –∂–∏–≤–æ—Ç–Ω—ã–º–∏ –Ω–∞—à–µ–π —Å—Ç—Ä–∞–Ω—ã –∏ –∏—Ö —Å—Ä–µ–¥–æ–π –æ–±–∏—Ç–∞–Ω–∏—è.',
                l8_t: '–ú—É—Å–æ—Ä –≤ –≥–æ—Ä–æ–¥–µ –∏ –ø—Ç–∏—Ü—ã', l8_d: '–ö–∞–∫ –º—É—Å–æ—Ä –Ω–∞ —É–ª–∏—Ü–∞—Ö –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ç–∏—Ü, –¥–≤–æ—Ä—ã –∏ –¥–æ–º–∞.',
                q1_t: '–°–ø–∞—Å–∏ –∂–∏–≤–æ—Ç–Ω–æ–µ', q1_d: '–û–Ω–ª–∞–π–Ω‚Äë–∫–≤–µ—Å—Ç: –ø–æ–º–æ–≥–∏ –∂–∏–≤–æ—Ç–Ω–æ–º—É –≤—ã–±—Ä–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (5 —à–∞–≥–æ–≤).',
                q2_t: '–ü–æ—Å–∞–¥–∏ –¥–µ—Ä–µ–≤–æ', q2_d: '–û–Ω–ª–∞–π–Ω‚Äë–∫–≤–µ—Å—Ç: –≤—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —à–∞–≥–∏ –ø–æ—Å–∞–¥–∫–∏ –∏ —É—Ö–æ–¥–∞ (5 —à–∞–≥–æ–≤).',
                q3_t: '–≠–∫–æ‚Äë—Å–ø–∞—Å–µ–Ω–∏–µ', q3_d: '–ú–∏–Ω–∏‚Äë–∫–≤–µ—Å—Ç: —Ä–µ—à–∏ —Å–∏—Ç—É–∞—Ü–∏—é –∏ —Å–æ—Ö—Ä–∞–Ω–∏ –ø—Ä–∏—Ä–æ–¥—É (5 —à–∞–≥–æ–≤).',
                quest_step: '–®–∞–≥ {n} –∏–∑ {total}',
                quest_choose: '–í—ã–±–µ—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç:',
                quest_next: '–î–∞–ª—å—à–µ',
                quest_finish: '–ó–∞–≤–µ—Ä—à–∏—Ç—å –∫–≤–µ—Å—Ç',
                quest_already_done: '–ö–≤–µ—Å—Ç —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω. –ú–æ–ª–æ–¥–µ—Ü!',
                quest_need_choice: '–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞.',
                quest_result_pass: '–û—Ç–ª–∏—á–Ω–æ! –ö–≤–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω.',
                quest_result_fail: '–ü–æ—á—Ç–∏! –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑.'
            });

            Object.assign(translations.kz, {
                g1_t: '“ö–æ“õ—ã—Å—Ç—ã —Å“±—Ä—ã–ø—Ç–∞—É', g1_d: '“ö–∞–ª–¥—ã“õ—Ç–∞—Ä–¥—ã –¥“±—Ä—ã—Å –∂”ô—à—ñ–∫—Ç–µ—Ä–≥–µ –±”©–ª—ñ–ø —Å–∞–ª (3 –º–∏–Ω—É—Ç).',
                g2_t: '–û—Ä–º–∞–Ω–¥—ã “õ“±—Ç“õ–∞—Ä', g2_d: '–û—Ä–º–∞–Ω“ì–∞ –∫”©–º–µ–∫—Ç–µ—Å: –¥“±—Ä—ã—Å ”ô—Ä–µ–∫–µ—Ç—Ç—ñ —Ç–∞“£–¥–∞ (3 –º–∏–Ω—É—Ç).',
                g3_t: '–≠–∫–æ‚Äë–≤–∏–∫—Ç–æ—Ä–∏–Ω–∞', g3_d: '–¢–∞–±–∏“ì–∞—Ç –ø–µ–Ω —ç–∫–æ–ª–æ–≥–∏—è —Ç—É—Ä–∞–ª—ã –∂—ã–ª–¥–∞–º —Å“±—Ä–∞“õ—Ç–∞—Ä (3 –º–∏–Ω—É—Ç).',
                g4_t: '“ö–∞–π—Ç–∞ ”©“£–¥–µ—É–¥—ñ —Ç–∞–ø', g4_d: '–ù–µ–Ω—ñ “õ–∞–π—Ç–∞ ”©“£–¥–µ—É–≥–µ –±–æ–ª–∞–¥—ã, –Ω–µ–Ω—ñ –±–æ–ª–º–∞–π–¥—ã –∞–Ω—ã“õ—Ç–∞ (3 –º–∏–Ω—É—Ç).',
                g5_t: '”®–∑–µ–Ω–¥—ñ —Ç–∞–∑–∞–ª–∞', g5_d: '–°—É–¥–∞–Ω “õ–æ“õ—ã—Å—Ç—ã –∞–ª—ã–ø, –∂–∞–Ω—É–∞—Ä–ª–∞—Ä–¥—ã “õ“±—Ç“õ–∞—Ä (3 –º–∏–Ω—É—Ç).',
                l1_t: '–≠–∫–æ–ª–æ–≥–∏—è –¥–µ–≥–µ–Ω –Ω–µ', l1_d: '–≠–∫–æ–ª–æ–≥–∏—è–Ω—ã“£ –Ω–µ–≥—ñ–∑—ñ–Ω –∂”ô–Ω–µ –º–∞“£—ã–∑—ã–Ω –±—ñ–ª.',
                l2_t: '“ö–æ“õ—ã—Å—Ç—ã —Å“±—Ä—ã–ø—Ç–∞—É', l2_d: '“ö–∞–ª–¥—ã“õ—Ç–∞—Ä–¥—ã “õ–∞–ª–∞–π —Å“±—Ä—ã–ø—Ç–∞—É“ì–∞ –±–æ–ª–∞–¥—ã –∂”ô–Ω–µ –Ω–µ “Ø—à—ñ–Ω.',
                l3_t: '–°—É –∂”ô–Ω–µ —Ç–∞–±–∏“ì–∞—Ç', l3_d: '–°—É–¥—ã “Ø–Ω–µ–º–¥–µ—É –∂”ô–Ω–µ —Ç–∞–±–∏“ì–∞—Ç—Ç—ã “õ–æ—Ä“ì–∞—É.',
                l4_t: '–û—Ä–º–∞–Ω –∂”ô–Ω–µ –∞“ì–∞—à—Ç–∞—Ä', l4_d: '–û—Ä–º–∞–Ω –Ω–µ–≥–µ –º–∞“£—ã–∑–¥—ã –∂”ô–Ω–µ “õ–∞–ª–∞–π —Å–∞“õ—Ç–∞–π–º—ã–∑.',
                l5_t: '“ö–∞–π—Ç–∞ ”©“£–¥–µ—É', l5_d: '“ö–æ“õ—ã—Å “õ–∞–π—Ç–∞ ”©“£–¥–µ–ª–≥–µ–Ω —Å–æ“£ –Ω–µ –±–æ–ª–∞–¥—ã.',
                l6_t: '“ö–∞–∑–∞“õ—Å—Ç–∞–Ω–Ω—ã“£ “ö—ã–∑—ã–ª –∫—ñ—Ç–∞–±—ã', l6_d: '–°–∏—Ä–µ–∫ –∂–∞–Ω—É–∞—Ä–ª–∞—Ä–¥—ã –Ω–µ–≥–µ “õ–æ—Ä“ì–∞—É –∫–µ—Ä–µ–∫ –∂”ô–Ω–µ “õ–∞–ª–∞–π “õ–æ—Ä“ì–∞–π–º—ã–∑.',
                l7_t: '“ö–∞–∑–∞“õ—Å—Ç–∞–Ω –∂–∞–Ω—É–∞—Ä–ª–∞—Ä—ã', l7_d: '–ï–ª—ñ–º—ñ–∑–¥–µ–≥—ñ –∂–∞–Ω—É–∞—Ä–ª–∞—Ä–º–µ–Ω –∂”ô–Ω–µ –º–µ–∫–µ–Ω—ñ–º–µ–Ω —Ç–∞–Ω—ã—Å.',
                l8_t: '“ö–∞–ª–∞–¥–∞“ì—ã “õ–æ“õ—ã—Å –∂”ô–Ω–µ “õ“±—Å—Ç–∞—Ä', l8_d: '–ö”©—à–µ–¥–µ–≥—ñ “õ–æ“õ—ã—Å “õ“±—Å—Ç–∞—Ä“ì–∞, –∞—É–ª–∞ –º–µ–Ω “Ø–π–ª–µ—Ä–≥–µ “õ–∞–ª–∞–π ”ô—Å–µ—Ä –µ—Ç–µ–¥—ñ.',
                q1_t: '–ñ–∞–Ω—É–∞—Ä–¥—ã “õ“±—Ç“õ–∞—Ä', q1_d: '–û–Ω–ª–∞–π–Ω‚Äë–∫–≤–µ—Å—Ç: –∂–∞–Ω—É–∞—Ä“ì–∞ –¥“±—Ä—ã—Å ”ô—Ä–µ–∫–µ—Ç—Ç—ñ —Ç–∞“£–¥–∞—É“ì–∞ –∫”©–º–µ–∫—Ç–µ—Å (5 “õ–∞–¥–∞–º).',
                q2_t: '–ê“ì–∞—à –æ—Ç—ã—Ä“ì—ã–∑', q2_d: '–û–Ω–ª–∞–π–Ω‚Äë–∫–≤–µ—Å—Ç: –æ—Ç—ã—Ä“ì—ã–∑—É –∂”ô–Ω–µ –∫“Ø—Ç—ñ–º “õ–∞–¥–∞–º–¥–∞—Ä—ã–Ω –¥“±—Ä—ã—Å —Ç–∞“£–¥–∞ (5 “õ–∞–¥–∞–º).',
                q3_t: '–≠–∫–æ‚Äë“õ“±—Ç“õ–∞—Ä—É', q3_d: '–ú–∏–Ω–∏‚Äë–∫–≤–µ—Å—Ç: –∂–∞“ì–¥–∞–π–¥—ã —à–µ—à—ñ–ø, —Ç–∞–±–∏“ì–∞—Ç—Ç—ã —Å–∞“õ—Ç–∞ (5 “õ–∞–¥–∞–º).',
                quest_step: '{n} / {total} “õ–∞–¥–∞–º',
                quest_choose: '–ù“±—Å“õ–∞–Ω—ã —Ç–∞“£–¥–∞:',
                quest_next: '–ö–µ–ª–µ—Å—ñ',
                quest_finish: '–ö–≤–µ—Å—Ç—Ç—ñ –∞—è“õ—Ç–∞—É',
                quest_already_done: '–ö–≤–µ—Å—Ç –æ—Ä—ã–Ω–¥–∞–ª“ì–∞–Ω. –ñ–∞—Ä–∞–π—Å—ã“£!',
                quest_need_choice: '–ñ–∞—É–∞–ø –Ω“±—Å“õ–∞—Å—ã–Ω —Ç–∞“£–¥–∞“£—ã–∑.',
                quest_result_pass: '”®—Ç–µ –∂–∞“õ—Å—ã! –ö–≤–µ—Å—Ç—Ç–µ–Ω ”©—Ç—Ç—ñ“£—ñ–∑.',
                quest_result_fail: '–ê–∑ “õ–∞–ª–¥—ã! “ö–∞–π—Ç–∞ –∫”©—Ä—ñ“£—ñ–∑.'
            });
        }

        function renderGames(lang) {
            const user = normalizeKidsUser(getUser());
            saveUser(user);

            const daily = getDailyGameState();
            const left = Math.max(0, 5 - daily.count);
            document.getElementById('gamesNotice').textContent = t(lang, 'games_notice', { left });
            document.getElementById('gamesDailyBadge').textContent = `${daily.count}/5`;

            const list = document.getElementById('gamesList');
            list.innerHTML = '';

            kidsGames.forEach(g => {
                const card = document.createElement('div');
                card.className = 'mini-card';

                const h3 = document.createElement('h3');
                h3.textContent = `${g.icon} ${t(lang, g.titleKey)}`;

                const p = document.createElement('p');
                p.textContent = t(lang, g.descKey);

                const row = document.createElement('div');
                row.className = 'mini-row';

                const hint = document.createElement('div');
                hint.className = 'hint';
                hint.textContent = `${daily.count}/5`;

                const actions = document.createElement('div');
                actions.className = 'mini-actions';

                const btn = document.createElement('button');
                btn.className = 'btn btn-primary';
                btn.textContent = t(lang, 'start');
                const feedback = document.createElement('div');
                feedback.className = 'feedback';
                btn.addEventListener('click', () => startGame(lang, g.id, feedback));

                actions.appendChild(btn);
                row.appendChild(hint);
                row.appendChild(actions);

                card.appendChild(h3);
                card.appendChild(p);
                card.appendChild(row);
                card.appendChild(feedback);
                list.appendChild(card);
            });
        }

        let gameTimer = null;
        function startGame(lang, gameId, feedbackEl) {
            const daily = getDailyGameState();
            if (daily.count >= 5) {
                showFeedback(feedbackEl, 'error', t(lang, 'daily_limit'));
                return;
            }

            const user = normalizeKidsUser(getUser());

            let seconds = 300; // 5 –º–∏–Ω—É—Ç
            let score = 0;
            let gameActive = true;

            const overlay = document.createElement('div');
            overlay.style.position = 'fixed';
            overlay.style.inset = '0';
            overlay.style.background = 'rgba(0,0,0,0.45)';
            overlay.style.display = 'flex';
            overlay.style.alignItems = 'center';
            overlay.style.justifyContent = 'center';
            overlay.style.padding = '16px';
            overlay.style.zIndex = '9999';

            const modal = document.createElement('div');
            modal.className = 'card';
            modal.style.maxWidth = 'min(900px, 95vw)';
            modal.style.width = '100%';
            modal.style.maxHeight = '90vh';
            modal.style.overflowY = 'auto';
            modal.style.padding = '20px';
            modal.style.borderRadius = '22px';
            modal.style.background = 'rgba(255,255,255,0.96)';
            modal.style.backdropFilter = 'blur(14px)';
            modal.style.boxShadow = '0 20px 60px rgba(0,0,0,0.3)';

            // Header —Å —Ç–∞–π–º–µ—Ä–æ–º, —Å—á—ë—Ç–æ–º –∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–º —è–∑—ã–∫–∞
            const header = document.createElement('div');
            header.style.display = 'flex';
            header.style.justifyContent = 'space-between';
            header.style.alignItems = 'center';
            header.style.marginBottom = '16px';
            header.style.flexWrap = 'wrap';
            header.style.gap = '10px';

            const h2 = document.createElement('h2');
            h2.textContent = t(lang, 'g_' + gameId + '_title');
            h2.style.color = 'var(--kids-dark)';
            h2.style.margin = '0';
            h2.style.fontSize = 'clamp(1.2rem, 4vw, 1.6rem)';

            const info = document.createElement('div');
            info.style.display = 'flex';
            info.style.alignItems = 'center';
            info.style.gap = '12px';
            info.style.flexWrap = 'wrap';

            const timeEl = document.createElement('div');
            timeEl.className = 'notice';
            timeEl.style.margin = '0';
            timeEl.style.fontWeight = '600';

            const scoreEl = document.createElement('div');
            scoreEl.className = 'notice';
            scoreEl.style.background = 'linear-gradient(135deg, #4ade80, #22c55e)';
            scoreEl.style.color = '#fff';
            scoreEl.style.margin = '0';
            scoreEl.style.fontWeight = '600';

            // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞
            const langSwitch = document.createElement('div');
            langSwitch.style.display = 'flex';
            langSwitch.style.background = '#e5e7eb';
            langSwitch.style.borderRadius = '20px';
            langSwitch.style.padding = '2px';
            langSwitch.style.gap = '2px';

            const btnRU = document.createElement('button');
            btnRU.textContent = 'RU';
            btnRU.style.padding = '6px 12px';
            btnRU.style.border = 'none';
            btnRU.style.borderRadius = '18px';
            btnRU.style.background = lang === 'ru' ? '#fff' : 'transparent';
            btnRU.style.cursor = 'pointer';
            btnRU.style.fontWeight = '600';
            btnRU.style.transition = 'all 0.2s';

            const btnKZ = document.createElement('button');
            btnKZ.textContent = 'KZ';
            btnKZ.style.padding = '6px 12px';
            btnKZ.style.border = 'none';
            btnKZ.style.borderRadius = '18px';
            btnKZ.style.background = lang === 'kz' ? '#fff' : 'transparent';
            btnKZ.style.cursor = 'pointer';
            btnKZ.style.fontWeight = '600';
            btnKZ.style.transition = 'all 0.2s';

            langSwitch.appendChild(btnRU);
            langSwitch.appendChild(btnKZ);

            info.appendChild(timeEl);
            info.appendChild(scoreEl);
            info.appendChild(langSwitch);

            header.appendChild(h2);
            header.appendChild(info);

            // –ò–≥—Ä–æ–≤–∞—è –æ–±–ª–∞—Å—Ç—å
            const gameArea = document.createElement('div');
            gameArea.style.marginBottom = '16px';
            gameArea.style.minHeight = '280px';

            // –ö–Ω–æ–ø–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
            const finishBtn = document.createElement('button');
            finishBtn.className = 'btn btn-primary';
            finishBtn.style.width = '100%';
            finishBtn.textContent = t(lang, 'timer_finish');

            function renderTime() {
                const m = String(Math.floor(seconds / 60)).padStart(2, '0');
                const s = String(seconds % 60).padStart(2, '0');
                timeEl.textContent = t(lang, 'timer_left', { time: `${m}:${s}` });
            }

            function updateScore(delta) {
                score += delta;
                scoreEl.textContent = t(lang, 'game_score', { score });
                // –ê–Ω–∏–º–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—á—ë—Ç–∞
                scoreEl.style.transform = 'scale(1.2)';
                setTimeout(() => { scoreEl.style.transform = 'scale(1)'; }, 200);
            }

            function finish() {
                gameActive = false;
                if (gameTimer) {
                    clearInterval(gameTimer);
                    gameTimer = null;
                }
                overlay.remove();

                const reward = 10 + Math.floor(Math.random() * 11);
                user.kids_games_total = Number(user.kids_games_total ?? 0) + 1;
                user.tasks_completed = Number(user.tasks_completed ?? 0) + 1;
                saveUser(user);

                setDailyGameCount(daily.key, daily.count + 1);
                addPoints(user, reward, `game:${gameId}`);

                showFeedback(feedbackEl, 'success', t(lang, 'game_reward', { points: reward, score }));
                updateLanguage(lang);
            }

            // –ò–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–π –∏–≥—Ä—ã
            function initGame() {
                gameArea.innerHTML = '';
                if (gameId === 'trash_sort') {
                    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –º—É—Å–æ—Ä–∞
                    const instruction = document.createElement('p');
                    instruction.textContent = t(lang, 'trash_sort_instruction');
                    instruction.style.marginBottom = '12px';
                    instruction.style.fontWeight = '600';
                    gameArea.appendChild(instruction);

                    const containers = document.createElement('div');
                    containers.style.display = 'flex';
                    containers.style.justifyContent = 'space-around';
                    containers.style.marginBottom = '20px';
                    containers.style.flexWrap = 'wrap';
                    containers.style.gap = '10px';

                    const bins = [
                        { id: 'recycle', label: t(lang, 'bin_recycle'), color: '#3b82f6' },
                        { id: 'organic', label: t(lang, 'bin_organic'), color: '#22c55e' },
                        { id: 'general', label: t(lang, 'bin_general'), color: '#6b7280' }
                    ];

                    bins.forEach(bin => {
                        const binEl = document.createElement('div');
                        binEl.className = 'trash-bin';
                        binEl.dataset.type = bin.id;
                        binEl.textContent = bin.label;
                        binEl.style.padding = '12px 16px';
                        binEl.style.borderRadius = '12px';
                        binEl.style.background = bin.color;
                        binEl.style.color = '#fff';
                        binEl.style.fontWeight = '600';
                        binEl.style.textAlign = 'center';
                        binEl.style.minWidth = '100px';
                        binEl.style.transition = 'transform 0.2s, box-shadow 0.2s';
                        binEl.style.cursor = 'pointer';
                        binEl.style.boxShadow = '0 2px 8px rgba(0,0,0,0.15)';
                        binEl.addEventListener('mouseenter', () => {
                            binEl.style.transform = 'scale(1.05)';
                            binEl.style.boxShadow = '0 4px 16px rgba(0,0,0,0.25)';
                        });
                        binEl.addEventListener('mouseleave', () => {
                            binEl.style.transform = 'scale(1)';
                            binEl.style.boxShadow = '0 2px 8px rgba(0,0,0,0.15)';
                        });
                        containers.appendChild(binEl);
                    });

                    gameArea.appendChild(containers);

                    const itemsArea = document.createElement('div');
                    itemsArea.style.display = 'flex';
                    itemsArea.style.flexWrap = 'wrap';
                    itemsArea.style.gap = '12px';
                    itemsArea.style.justifyContent = 'center';

                    const items = [
                        { id: 'plastic', type: 'recycle', emoji: 'üç∂' },
                        { id: 'apple', type: 'organic', emoji: 'üçé' },
                        { id: 'paper', type: 'recycle', emoji: 'üìÑ' },
                        { id: 'banana', type: 'organic', emoji: 'üçå' },
                        { id: 'glass', type: 'recycle', emoji: 'üçæ' },
                        { id: 'wrapper', type: 'general', emoji: 'üì¶' },
                        { id: 'orange', type: 'organic', emoji: 'üçä' },
                        { id: 'can', type: 'recycle', emoji: 'ü•´' }
                    ];

                    items.forEach(item => {
                        const itemEl = document.createElement('div');
                        itemEl.className = 'trash-item';
                        itemEl.draggable = true;
                        itemEl.dataset.type = item.type;
                        itemEl.textContent = item.emoji;
                        itemEl.style.fontSize = '2.5rem';
                        itemEl.style.padding = '8px';
                        itemEl.style.background = '#f3f4f6';
                        itemEl.style.borderRadius = '12px';
                        itemEl.style.cursor = 'grab';
                        itemEl.style.transition = 'transform 0.2s';
                        itemEl.style.userSelect = 'none';
                        itemEl.addEventListener('dragstart', e => {
                            e.dataTransfer.setData('type', item.type);
                            itemEl.style.opacity = '0.5';
                        });
                        itemEl.addEventListener('dragend', () => {
                            itemEl.style.opacity = '1';
                        });
                        itemEl.addEventListener('mouseenter', () => {
                            itemEl.style.transform = 'scale(1.15)';
                        });
                        itemEl.addEventListener('mouseleave', () => {
                            itemEl.style.transform = 'scale(1)';
                        });
                        itemsArea.appendChild(itemEl);
                    });

                    gameArea.appendChild(itemsArea);

                    // Drag-and-drop –ª–æ–≥–∏–∫–∞
                    document.querySelectorAll('.trash-bin').forEach(bin => {
                        bin.addEventListener('dragover', e => e.preventDefault());
                        bin.addEventListener('drop', e => {
                            e.preventDefault();
                            const type = e.dataTransfer.getData('type');
                            if (type === bin.dataset.type) {
                                updateScore(10);
                                bin.style.background = '#10b981';
                                setTimeout(() => {
                                    bin.style.background = bins.find(b => b.id === bin.dataset.type).color;
                                }, 400);
                                // –£–¥–∞–ª—è–µ–º –ø–µ—Ä–≤—ã–π –ø—Ä–µ–¥–º–µ—Ç —Ç–∞–∫–æ–≥–æ —Ç–∏–ø–∞
                                const item = document.querySelector(`.trash-item[data-type="${type}"]`);
                                if (item) {
                                    item.style.transform = 'scale(0)';
                                    item.style.opacity = '0';
                                    setTimeout(() => item.remove(), 300);
                                }
                            } else {
                                updateScore(-5);
                                bin.style.background = '#ef4444';
                                setTimeout(() => {
                                    bin.style.background = bins.find(b => b.id === bin.dataset.type).color;
                                }, 400);
                            }
                        });
                    });

                } else if (gameId === 'save_forest') {
                    // –°–ø–∞—Å–∏ –ª–µ—Å
                    const instruction = document.createElement('p');
                    instruction.textContent = t(lang, 'save_forest_instruction');
                    instruction.style.marginBottom = '12px';
                    instruction.style.fontWeight = '600';
                    gameArea.appendChild(instruction);

                    const forest = document.createElement('div');
                    forest.style.position = 'relative';
                    forest.style.width = '100%';
                    forest.style.height = '300px';
                    forest.style.background = 'linear-gradient(to bottom, #87ceeb, #98fb98)';
                    forest.style.borderRadius = '16px';
                    forest.style.overflow = 'hidden';
                    forest.style.cursor = 'crosshair';

                    // –î–æ–±–∞–≤–∏–º –¥–µ—Ä–µ–≤—å—è
                    for (let i = 0; i < 6; i++) {
                        const tree = document.createElement('div');
                        tree.textContent = 'üå≥';
                        tree.style.position = 'absolute';
                        tree.style.fontSize = '3rem';
                        tree.style.left = Math.random() * 80 + 10 + '%';
                        tree.style.top = Math.random() * 60 + 20 + '%';
                        forest.appendChild(tree);
                    }

                    gameArea.appendChild(forest);

                    let spawnInterval;
                    function spawnThreat() {
                        if (!gameActive) return;
                        const threats = ['üî•', 'üí®', 'ü¶ü', 'üö¨'];
                        const threat = document.createElement('div');
                        threat.textContent = threats[Math.floor(Math.random() * threats.length)];
                        threat.style.position = 'absolute';
                        threat.style.fontSize = '2rem';
                        threat.style.left = Math.random() * 90 + '%';
                        threat.style.top = Math.random() * 80 + '%';
                        threat.style.cursor = 'pointer';
                        threat.style.transition = 'transform 0.2s';
                        threat.style.animation = 'pulse 1s infinite';
                        threat.addEventListener('click', () => {
                            updateScore(5);
                            threat.style.transform = 'scale(1.5) rotate(20deg)';
                            threat.style.opacity = '0';
                            setTimeout(() => threat.remove(), 200);
                        });
                        threat.addEventListener('mouseenter', () => {
                            threat.style.transform = 'scale(1.2)';
                        });
                        threat.addEventListener('mouseleave', () => {
                            threat.style.transform = 'scale(1)';
                        });
                        forest.appendChild(threat);
                        // –£–¥–∞–ª—è–µ–º —É–≥—Ä–æ–∑—É —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã, –µ—Å–ª–∏ –Ω–µ –∫–ª–∏–∫–Ω—É–ª–∏
                        setTimeout(() => {
                            if (threat.parentNode) {
                                threat.style.opacity = '0';
                                setTimeout(() => threat.remove(), 300);
                            }
                        }, 3000);
                    }
                    spawnThreat();
                    spawnInterval = setInterval(spawnThreat, 1500);

                    // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
                    const originalFinish = finish;
                    finish = () => {
                        clearInterval(spawnInterval);
                        originalFinish();
                    };

                } else if (gameId === 'find_recycle') {
                    // –ù–∞–π–¥–∏ –ø–µ—Ä–µ—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º–æ–µ
                    const instruction = document.createElement('p');
                    instruction.textContent = t(lang, 'find_recycle_instruction');
                    instruction.style.marginBottom = '12px';
                    instruction.style.fontWeight = '600';
                    gameArea.appendChild(instruction);

                    const field = document.createElement('div');
                    field.style.display = 'grid';
                    field.style.gridTemplateColumns = 'repeat(auto-fit, minmax(80px, 1fr))';
                    field.style.gap = '12px';
                    field.style.maxWidth = '500px';
                    field.style.margin = '0 auto';

                    const allItems = [
                        { emoji: 'üì∞', recyclable: true },
                        { emoji: 'üçå', recyclable: false },
                        { emoji: 'ü•§', recyclable: true },
                        { emoji: 'üçé', recyclable: false },
                        { emoji: 'üì¶', recyclable: false },
                        { emoji: 'üç∂', recyclable: true },
                        { emoji: 'üçä', recyclable: false },
                        { emoji: 'ü•´', recyclable: true },
                        { emoji: 'üçû', recyclable: false },
                        { emoji: 'üìÑ', recyclable: true },
                        { emoji: 'ü•ö', recyclable: false },
                        { emoji: 'üçæ', recyclable: true }
                    ];

                    allItems.forEach((item, idx) => {
                        const cell = document.createElement('div');
                        cell.textContent = item.emoji;
                        cell.style.fontSize = '2.5rem';
                        cell.style.padding = '12px';
                        cell.style.background = '#f3f4f6';
                        cell.style.borderRadius = '12px';
                        cell.style.cursor = 'pointer';
                        cell.style.textAlign = 'center';
                        cell.style.transition = 'transform 0.2s, background 0.3s';
                        cell.dataset.recyclable = item.recyclable;
                        cell.dataset.idx = idx;
                        cell.addEventListener('click', () => {
                            if (cell.dataset.clicked === '1') return;
                            cell.dataset.clicked = '1';
                            if (item.recyclable) {
                                updateScore(8);
                                cell.style.background = '#86efac';
                                cell.style.transform = 'scale(1.1)';
                            } else {
                                updateScore(-3);
                                cell.style.background = '#fca5a5';
                                cell.style.transform = 'scale(0.9)';
                            }
                        });
                        cell.addEventListener('mouseenter', () => {
                            if (cell.dataset.clicked !== '1') {
                                cell.style.transform = 'scale(1.15)';
                                cell.style.background = '#e5e7eb';
                            }
                        });
                        cell.addEventListener('mouseleave', () => {
                            if (cell.dataset.clicked !== '1') {
                                cell.style.transform = 'scale(1)';
                                cell.style.background = '#f3f4f6';
                            }
                        });
                        field.appendChild(cell);
                    });

                    gameArea.appendChild(field);

                } else {
                    // –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∏–≥—Ä
                    const placeholder = document.createElement('p');
                    placeholder.textContent = t(lang, 'game_placeholder');
                    placeholder.style.textAlign = 'center';
                    placeholder.style.color = '#6b7280';
                    gameArea.appendChild(placeholder);
                }
            }

            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —è–∑—ã–∫–∞
            function switchLang(newLang) {
                lang = newLang;
                h2.textContent = t(lang, 'g_' + gameId + '_title');
                renderTime();
                updateScore(0);
                btnRU.style.background = lang === 'ru' ? '#fff' : 'transparent';
                btnKZ.style.background = lang === 'kz' ? '#fff' : 'transparent';
                initGame();
            }
            btnRU.addEventListener('click', () => switchLang('ru'));
            btnKZ.addEventListener('click', () => switchLang('kz'));

            finishBtn.addEventListener('click', finish);

            modal.appendChild(header);
            modal.appendChild(gameArea);
            modal.appendChild(finishBtn);
            overlay.appendChild(modal);
            document.body.appendChild(overlay);

            renderTime();
            updateScore(0);
            initGame();

            gameTimer = setInterval(() => {
                seconds -= 1;
                renderTime();
                if (seconds <= 0) finish();
            }, 1000);
        }

        function renderLessons(lang) {
            const user = normalizeKidsUser(getUser());
            const done = new Set(user.kids_lessons_done || []);

            document.getElementById('lessonsNotice').textContent = t(lang, 'lessons_notice');
            document.getElementById('lessonsBadge').textContent = String(done.size);

            const list = document.getElementById('lessonsList');
            list.innerHTML = '';
            document.getElementById('lessonQuiz').style.display = 'none';
            document.getElementById('lessonQuiz').innerHTML = '';

            kidsLessons.forEach(l => {
                const card = document.createElement('div');
                card.className = 'mini-card';

                const h3 = document.createElement('h3');
                h3.textContent = `${l.icon} ${t(lang, l.titleKey)}`;

                const p = document.createElement('p');
                p.textContent = t(lang, l.descKey);

                const row = document.createElement('div');
                row.className = 'mini-row';

                const hint = document.createElement('div');
                hint.className = 'hint';
                hint.textContent = done.has(l.id) ? t(lang, 'done') : '';

                const actions = document.createElement('div');
                actions.className = 'mini-actions';

                const btn = document.createElement('button');
                btn.className = done.has(l.id) ? 'btn btn-outline' : 'btn btn-primary';
                btn.textContent = done.has(l.id) ? t(lang, 'open') : t(lang, 'start');
                btn.addEventListener('click', () => openLesson(lang, l.id));

                actions.appendChild(btn);
                row.appendChild(hint);
                row.appendChild(actions);

                card.appendChild(h3);
                card.appendChild(p);
                card.appendChild(row);
                list.appendChild(card);
            });
        }

        function openLesson(lang, lessonId) {
            const quiz = document.getElementById('lessonQuiz');
            quiz.style.display = 'grid';
            quiz.innerHTML = '';

            const lesson = getLessonData(lang, lessonId);

            const note = document.createElement('div');
            note.className = 'lesson-note';
            const h3 = document.createElement('h3');
            h3.textContent = lesson.noteTitle;
            const p = document.createElement('p');
            p.textContent = lesson.noteText;
            note.appendChild(h3);
            note.appendChild(p);

            const videoSoon = document.createElement('p');
            videoSoon.style.marginTop = '10px';
            videoSoon.textContent = t(lang, 'lesson_video_soon');
            note.appendChild(videoSoon);
            quiz.appendChild(note);

            const title = document.createElement('div');
            title.className = 'notice';
            title.textContent = t(lang, 'quiz_title');
            quiz.appendChild(title);

            const questions = lesson.questions;

            questions.forEach((q, idx) => {
                const wrap = document.createElement('div');
                wrap.className = 'q';

                const strong = document.createElement('strong');
                strong.textContent = `${idx + 1}. ${q.text}`;
                wrap.appendChild(strong);

                q.options.forEach((opt, i) => {
                    const label = document.createElement('label');
                    const input = document.createElement('input');
                    input.type = 'radio';
                    input.name = q.id;
                    input.value = String(i);
                    input.style.marginRight = '8px';
                    label.appendChild(input);
                    label.appendChild(document.createTextNode(opt));
                    wrap.appendChild(label);
                });

                const qfb = document.createElement('div');
                qfb.className = 'q-feedback';
                qfb.setAttribute('data-qfb', q.id);
                wrap.appendChild(qfb);

                quiz.appendChild(wrap);
            });

            const submit = document.createElement('button');
            submit.className = 'btn btn-primary';
            submit.textContent = t(lang, 'quiz_submit');
            submit.addEventListener('click', () => submitLessonQuiz(lang, lessonId, lesson));
            quiz.appendChild(submit);

            const overall = document.createElement('div');
            overall.className = 'feedback';
            overall.id = 'lessonOverallFeedback';
            quiz.appendChild(overall);

            quiz.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function submitLessonQuiz(lang, lessonId, lesson) {
            const user = normalizeKidsUser(getUser());
            const done = new Set(user.kids_lessons_done || []);
            if (done.has(lessonId)) {
                const overall = document.getElementById('lessonOverallFeedback');
                showFeedback(overall, 'success', t(lang, 'quiz_pass'));
                return;
            }

            const total = lesson.questions.length;
            const minScore = lesson.minScore;
            let score = 0;
            let missing = false;

            lesson.questions.forEach(q => {
                const checked = document.querySelector(`input[name="${q.id}"]:checked`)?.value;
                const fb = document.querySelector(`[data-qfb="${q.id}"]`);
                if (checked == null) {
                    missing = true;
                    if (fb) showFeedback(fb, 'error', t(lang, 'quiz_need_answer'));
                    return;
                }

                const ok = String(q.correct) === String(checked);
                if (ok) score += 1;
                if (fb) showFeedback(fb, ok ? 'success' : 'error', ok ? t(lang, 'quiz_correct') : t(lang, 'quiz_wrong'));
            });

            const overall = document.getElementById('lessonOverallFeedback');
            if (missing) {
                showFeedback(overall, 'error', t(lang, 'quiz_need_answer'));
                return;
            }

            const resultText = t(lang, 'quiz_result', { score, total, min: minScore });
            showFeedback(overall, score >= minScore ? 'success' : 'error', resultText);

            if (score >= minScore) {
                done.add(lessonId);
                user.kids_lessons_done = Array.from(done);
                user.tasks_completed = Number(user.tasks_completed ?? 0) + 1;
                saveUser(user);

                const reward = 10 + Math.floor(Math.random() * 11);
                addPoints(user, reward, `lesson:${lessonId}`);
                showFeedback(overall, 'success', `${t(lang, 'quiz_pass')} ${t(lang, 'lesson_reward', { points: reward })}`);
                updateLanguage(lang);
            }
        }

        function renderQuests(lang) {
            const user = normalizeKidsUser(getUser());
            const done = new Set(user.kids_quests_done || []);

            document.getElementById('questsNotice').textContent = t(lang, 'quests_notice');
            document.getElementById('questsBadge').textContent = String(done.size);

            const list = document.getElementById('questsList');
            list.innerHTML = '';

            kidsQuests.forEach(q => {
                const card = document.createElement('div');
                card.className = 'mini-card';

                const h3 = document.createElement('h3');
                h3.textContent = `${q.icon} ${t(lang, q.titleKey)}`;

                const p = document.createElement('p');
                p.textContent = t(lang, q.descKey);

                const row = document.createElement('div');
                row.className = 'mini-row';

                const hint = document.createElement('div');
                hint.className = 'hint';
                hint.textContent = done.has(q.id) ? t(lang, 'done') : '';

                const actions = document.createElement('div');
                actions.className = 'mini-actions';

                const btn = document.createElement('button');
                btn.className = done.has(q.id) ? 'btn btn-outline' : 'btn btn-primary';
                btn.textContent = done.has(q.id) ? t(lang, 'open') : t(lang, 'start');
                const feedback = document.createElement('div');
                feedback.className = 'feedback';
                btn.addEventListener('click', () => startQuestMiniGame(lang, q.id, feedback));

                actions.appendChild(btn);
                row.appendChild(hint);
                row.appendChild(actions);

                card.appendChild(h3);
                card.appendChild(p);
                card.appendChild(row);
                card.appendChild(feedback);
                list.appendChild(card);
            });
        }

        function getQuestGame(lang, questId) {
            const ru = {
                save_animal: {
                    title: 'ü¶ä –°–ø–∞—Å–∏ –∂–∏–≤–æ—Ç–Ω–æ–µ',
                    steps: [
                        { q: '–õ–∏—Å–∞ –∑–∞–ø—É—Ç–∞–ª–∞—Å—å –≤ –ø–∞–∫–µ—Ç–µ. –ß—Ç–æ –¥–µ–ª–∞—Ç—å?', a: ['–°–º–µ—è—Ç—å—Å—è', '–ê–∫–∫—É—Ä–∞—Ç–Ω–æ —Å–Ω—è—Ç—å –ø–∞–∫–µ—Ç –∏ –≤—ã–±—Ä–æ—Å–∏—Ç—å –≤ —É—Ä–Ω—É', '–û—Å—Ç–∞–≤–∏—Ç—å —Ç–∞–∫'], c: 1 },
                        { q: '–ì–¥–µ –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ –¥–ª—è –∂–∏–≤–æ—Ç–Ω—ã—Ö?', a: ['–í –ª–µ—Å—É –±–µ–∑ –º—É—Å–æ—Ä–∞', '–ù–∞ —Å–≤–∞–ª–∫–µ', '–í –≥—Ä—è–∑–Ω–æ–π —Ä–µ–∫–µ'], c: 0 },
                        { q: '–ï—Å–ª–∏ –≤–∏–¥–∏—à—å –º—É—Å–æ—Ä –≤ –ø–∞—Ä–∫–µ, —Ç—ã‚Ä¶', a: ['–ü—Ä–æ—Ö–æ–¥–∏—à—å –º–∏–º–æ', '–°–æ–±–∏—Ä–∞–µ—à—å –∏ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—à—å', '–†–∞–∑–±—Ä–∞—Å—ã–≤–∞–µ—à—å'], c: 1 },
                        { q: '–ß—Ç–æ –Ω–µ–ª—å–∑—è –±—Ä–æ—Å–∞—Ç—å –≤ –ø—Ä–∏—Ä–æ–¥—É?', a: ['–õ–∏—Å—Ç—å—è', '–ü–ª–∞—Å—Ç–∏–∫ –∏ —Å—Ç–µ–∫–ª–æ', '–°–µ–º–µ—á–∫–∏'], c: 1 },
                        { q: '–ö–∞–∫ –ø–æ–º–æ—á—å –∂–∏–≤–æ—Ç–Ω—ã–º –∑–∏–º–æ–π?', a: ['–õ–æ–º–∞—Ç—å –∏—Ö –¥–æ–º–∏–∫–∏', '–ù–µ —à—É–º–µ—Ç—å –∏ –Ω–µ –º—É—Å–æ—Ä–∏—Ç—å', '–ë—Ä–æ—Å–∞—Ç—å –ø–∞–∫–µ—Ç—ã'], c: 1 }
                    ]
                },
                plant_tree: {
                    title: 'üå± –ü–æ—Å–∞–¥–∏ –¥–µ—Ä–µ–≤–æ',
                    steps: [
                        { q: '–° —á–µ–≥–æ –Ω–∞—á–∞—Ç—å –ø–æ—Å–∞–¥–∫—É?', a: ['–í—ã–±—Ä–∞—Ç—å –º–µ—Å—Ç–æ –∏ –ª—É–Ω–∫—É', '–°—Ä–∞–∑—É —É–µ—Ö–∞—Ç—å', '–ë—Ä–æ—Å–∏—Ç—å —Å–µ–º–µ–Ω–∞ –Ω–∞ –∞—Å—Ñ–∞–ª—å—Ç'], c: 0 },
                        { q: '–ß—Ç–æ –Ω—É–∂–Ω–æ –¥–µ—Ä–µ–≤—É –ø–æ—Å–ª–µ –ø–æ—Å–∞–¥–∫–∏?', a: ['–í–æ–¥–∞', '–ú—É—Å–æ—Ä', '–ù–∏—á–µ–≥–æ'], c: 0 },
                        { q: '–ö–∞–∫ –ª—É—á—à–µ –ø–æ–ª–∏–≤–∞—Ç—å?', a: ['–ù–µ–º–Ω–æ–≥–æ –∏ —Ä–µ–≥—É–ª—è—Ä–Ω–æ', '–û–¥–∏–Ω —Ä–∞–∑ –≤ –≥–æ–¥', '–¢–æ–ª—å–∫–æ –≥–∞–∑–∏—Ä–æ–≤–∫–æ–π'], c: 0 },
                        { q: '–ß–µ–º –º–æ–∂–Ω–æ –∑–∞—â–∏—Ç–∏—Ç—å —Å–∞–∂–µ–Ω–µ—Ü?', a: ['–û–≥–æ—Ä–æ–¥–∏—Ç—å –∏ –Ω–µ –ª–æ–º–∞—Ç—å', '–¢—è–Ω—É—Ç—å –≤–µ—Ç–∫–∏', '–°–∂–µ—á—å —Ç—Ä–∞–≤—É —Ä—è–¥–æ–º'], c: 0 },
                        { q: '–ß—Ç–æ –ø–æ–ª–µ–∑–Ω–æ –≤–æ–∫—Ä—É–≥ –¥–µ—Ä–µ–≤–∞?', a: ['–ß–∏—Å—Ç–æ—Ç–∞ –∏ –º—É–ª—å—á–∞', '–ü–ª–∞—Å—Ç–∏–∫ –∏ –±—É—Ç—ã–ª–∫–∏', '–ö–æ—Å—Ç—ë—Ä'], c: 0 }
                    ]
                },
                eco_rescue: {
                    title: 'üß© –≠–∫–æ‚Äë—Å–ø–∞—Å–µ–Ω–∏–µ',
                    steps: [
                        { q: '–í –∫–ª–∞—Å—Å–µ –º–Ω–æ–≥–æ –±—É–º–∞–≥–∏. –ß—Ç–æ –ª—É—á—à–µ?', a: ['–°–∂–µ—á—å', '–°–¥–∞—Ç—å –Ω–∞ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫—É', '–í—ã–±—Ä–æ—Å–∏—Ç—å –Ω–∞ —É–ª–∏—Ü—É'], c: 1 },
                        { q: '–ë–∞—Ç–∞—Ä–µ–π–∫–∞ ‚Äî –∫—É–¥–∞?', a: ['–í –æ–±—ã—á–Ω—ã–π –º—É—Å–æ—Ä', '–í —Å–ø–µ—Ü. –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä', '–í —Ä–µ–∫—É'], c: 1 },
                        { q: '–ö–∞–∫ —É–º–µ–Ω—å—à–∏—Ç—å –ø–ª–∞—Å—Ç–∏–∫?', a: ['–û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ —Å—Ç–∞–∫–∞–Ω—ã', '–ú–Ω–æ–≥–æ—Ä–∞–∑–æ–≤–∞—è –±—É—Ç—ã–ª–∫–∞', '–ü–∞–∫–µ—Ç—ã –∫–∞–∂–¥—ã–π –¥–µ–Ω—å'], c: 1 },
                        { q: '–ß—Ç–æ –¥–µ–ª–∞—Ç—å —Å –±—É—Ç—ã–ª–∫–æ–π?', a: ['–°–º—è—Ç—å –∏ –≤ –ø–ª–∞—Å—Ç–∏–∫', '–í—ã–±—Ä–æ—Å–∏—Ç—å –≤ –ª–µ—Å—É', '–°–ø—Ä—è—Ç–∞—Ç—å'], c: 0 },
                        { q: '–ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å –≤–æ–∑–¥—É—Ö —á–∏—â–µ?', a: ['–°–∞–∂–∞—Ç—å –¥–µ—Ä–µ–≤—å—è', '–ñ–µ—á—å –º—É—Å–æ—Ä', '–ë–æ–ª—å—à–µ –º–∞—à–∏–Ω'], c: 0 }
                    ]
                }
            };

            const kz = {
                save_animal: {
                    title: 'ü¶ä –ñ–∞–Ω—É–∞—Ä–¥—ã “õ“±—Ç“õ–∞—Ä',
                    steps: [
                        { q: '–¢“Ø–ª–∫—ñ –ø–∞–∫–µ—Ç–∫–µ –æ—Ä–∞–ª—ã–ø “õ–∞–ª–¥—ã. –ù–µ —ñ—Å—Ç–µ–π—Å—ñ“£?', a: ['–ö“Ø–ª—É', '–ü–∞–∫–µ—Ç—Ç—ñ –∞–±–∞–π–ª–∞–ø —à–µ—à—ñ–ø, “õ–æ“õ—ã—Å“õ–∞ —Ç–∞—Å—Ç–∞—É', '–û–ª–∞–π “õ–∞–ª–¥—ã—Ä—É'], c: 1 },
                        { q: '–ñ–∞–Ω—É–∞—Ä–ª–∞—Ä“ì–∞ “õ–∞–π –∂–µ—Ä “õ–∞—É—ñ–ø—Å—ñ–∑?', a: ['“ö–æ“õ—ã—Å—Å—ã–∑ –æ—Ä–º–∞–Ω', '“ö–æ“õ—ã—Å –ø–æ–ª–∏–≥–æ–Ω—ã', '–õ–∞—Å ”©–∑–µ–Ω'], c: 0 },
                        { q: '–°–∞—è–±–∞“õ—Ç–∞ “õ–æ“õ—ã—Å –∫”©—Ä—Å–µ“£‚Ä¶', a: ['–ö–µ—Ç–µ –±–µ—Ä–µ—Å—ñ“£', '–ñ–∏–Ω–∞–ø, “õ–æ“õ—ã—Å“õ–∞ —Ç–∞—Å—Ç–∞–π—Å—ã“£', '–®–∞—à–∞—Å—ã“£'], c: 1 },
                        { q: '–¢–∞–±–∏“ì–∞—Ç“õ–∞ –Ω–µ–Ω—ñ —Ç–∞—Å—Ç–∞—É“ì–∞ –±–æ–ª–º–∞–π–¥—ã?', a: ['–ñ–∞–ø—ã—Ä–∞“õ', '–ü–ª–∞—Å—Ç–∏–∫ –ø–µ–Ω ”ô–π–Ω–µ–∫', '–î”ô–Ω'], c: 1 },
                        { q: '“ö—ã—Å—Ç–∞ –∂–∞–Ω—É–∞—Ä–ª–∞—Ä“ì–∞ “õ–∞–ª–∞–π –∫”©–º–µ–∫—Ç–µ—Å–µ–º—ñ–∑?', a: ['“Æ–π—ñ–Ω –±“±–∑—É', '–®—É–ª—ã –±–æ–ª–º–∞—É, “õ–æ“õ—ã—Å —Ç–∞—Å—Ç–∞–º–∞—É', '–ü–∞–∫–µ—Ç —Ç–∞—Å—Ç–∞—É'], c: 1 }
                    ]
                },
                plant_tree: {
                    title: 'üå± –ê“ì–∞—à –æ—Ç—ã—Ä“ì—ã–∑',
                    steps: [
                        { q: '–û—Ç—ã—Ä“ì—ã–∑—É–¥—ã –Ω–µ–¥–µ–Ω –±–∞—Å—Ç–∞–π–º—ã–∑?', a: ['–û—Ä—ã–Ω —Ç–∞“£–¥–∞–ø, —à“±“£“õ—ã—Ä “õ–∞–∑—É', '–ë—ñ—Ä–¥–µ–Ω –∫–µ—Ç—É', '–ê—Å—Ñ–∞–ª—å—Ç“õ–∞ –¥”ô–Ω —Ç–∞—Å—Ç–∞—É'], c: 0 },
                        { q: '–û—Ç—ã—Ä“ì—ã–∑“ì–∞–Ω–Ω–∞–Ω –∫–µ–π—ñ–Ω –∞“ì–∞—à“õ–∞ –Ω–µ –∫–µ—Ä–µ–∫?', a: ['–°—É', '“ö–æ“õ—ã—Å', '–ï—à—Ç–µ“£–µ'], c: 0 },
                        { q: '“ö–∞–ª–∞–π —Å—É–∞—Ä“ì–∞–Ω –¥“±—Ä—ã—Å?', a: ['–ê–∑–¥–∞–ø, –±—ñ—Ä–∞“õ –∂–∏—ñ', '–ñ—ã–ª—ã–Ω–∞ –±—ñ—Ä —Ä–µ—Ç', '–¢–µ–∫ –≥–∞–∑–¥–∞–ª“ì–∞–Ω —Å—É—Å—ã–Ω–º–µ–Ω'], c: 0 },
                        { q: '–ö”©—à–µ—Ç—Ç—ñ “õ–∞–ª–∞–π “õ–æ—Ä“ì–∞–π–º—ã–∑?', a: ['“ö–æ—Ä—à–∞–ø, —Å—ã–Ω–¥—ã—Ä–º–∞—É', '–ë“±—Ç–∞“ì—ã–Ω —Ç–∞—Ä—Ç—É', '–ñ–∞–Ω—ã–Ω–¥–∞ —à”©–ø –∂–∞“ì—É'], c: 0 },
                        { q: '–ê“ì–∞—à—Ç—ã“£ –∞–π–Ω–∞–ª–∞—Å—ã–Ω–¥–∞ –Ω–µ –ø–∞–π–¥–∞–ª—ã?', a: ['–¢–∞–∑–∞–ª—ã“õ –∂”ô–Ω–µ –º—É–ª—å—á–∞', '–ë”©—Ç–µ–ª–∫–µ –º–µ–Ω –ø–ª–∞—Å—Ç–∏–∫', '–û—Ç –∂–∞“ì—É'], c: 0 }
                    ]
                },
                eco_rescue: {
                    title: 'üß© –≠–∫–æ‚Äë“õ“±—Ç“õ–∞—Ä—É',
                    steps: [
                        { q: '–°—ã–Ω—ã–ø—Ç–∞ –∫”©–ø “õ–∞“ì–∞–∑ –±–∞—Ä. “ö–∞–π—Å—ã—Å—ã –¥“±—Ä—ã—Å?', a: ['”®—Ä—Ç–µ–ø –∂—ñ–±–µ—Ä—É', '“ö–∞–π—Ç–∞ ”©“£–¥–µ—É–≥–µ —Ç–∞–ø—Å—ã—Ä—É', '–ö”©—à–µ–≥–µ —Ç–∞—Å—Ç–∞—É'], c: 1 },
                        { q: '–ë–∞—Ç–∞—Ä–µ–π–∫–∞–Ω—ã “õ–∞–π–¥–∞ —Ç–∞—Å—Ç–∞–π–º—ã–∑?', a: ['–ñ–∞–ª–ø—ã “õ–æ“õ—ã—Å“õ–∞', '–ê—Ä–Ω–∞–π—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–≥–µ', '”®–∑–µ–Ω–≥–µ'], c: 1 },
                        { q: '–ü–ª–∞—Å—Ç–∏–∫—Ç—ñ “õ–∞–ª–∞–π –∞–∑–∞–π—Ç–∞–º—ã–∑?', a: ['–ë—ñ—Ä —Ä–µ—Ç—Ç—ñ–∫ —Å—Ç–∞“õ–∞–Ω', '–ö”©–ø —Ä–µ—Ç “õ–æ–ª–¥–∞–Ω—ã–ª–∞—Ç—ã–Ω –±”©—Ç–µ–ª–∫–µ', '–ö“Ø–Ω–¥–µ –ø–∞–∫–µ—Ç'], c: 1 },
                        { q: '–ë”©—Ç–µ–ª–∫–µ–Ω—ñ –Ω–µ —ñ—Å—Ç–µ–π–º—ñ–∑?', a: ['–ú—ã–∂—ã–ø, –ø–ª–∞—Å—Ç–∏–∫–∫–µ —Ç–∞—Å—Ç–∞—É', '–û—Ä–º–∞–Ω“ì–∞ —Ç–∞—Å—Ç–∞—É', '–ñ–∞—Å—ã—Ä—É'], c: 0 },
                        { q: '–ê—É–∞–Ω—ã “õ–∞–ª–∞–π —Ç–∞–∑–∞—Ä—Ç–∞ –∞–ª–∞–º—ã–∑?', a: ['–ê“ì–∞—à –æ—Ç—ã—Ä“ì—ã–∑—É', '“ö–æ“õ—ã—Å –∂–∞“ì—É', '–ö”©–ª—ñ–∫ –∫”©–±–µ–π—Ç—É'], c: 0 }
                    ]
                }
            };

            const bank = lang === 'kz' ? kz : ru;
            return bank[questId] || bank.eco_rescue;
        }

        function startQuestMiniGame(lang, questId, feedbackEl) {
            const user = normalizeKidsUser(getUser());
            const done = new Set(user.kids_quests_done || []);
            if (done.has(questId)) {
                showFeedback(feedbackEl, 'success', t(lang, 'quest_already_done'));
                return;
            }

            const data = getQuestGame(lang, questId);
            const total = data.steps.length;
            let step = 0;
            let score = 0;

            const overlay = document.createElement('div');
            overlay.style.position = 'fixed';
            overlay.style.inset = '0';
            overlay.style.background = 'rgba(15,30,50,0.45)';
            overlay.style.backdropFilter = 'blur(10px)';
            overlay.style.display = 'flex';
            overlay.style.alignItems = 'center';
            overlay.style.justifyContent = 'center';
            overlay.style.padding = '16px';
            overlay.style.zIndex = '9999';

            const modal = document.createElement('div');
            modal.className = 'card';
            modal.style.maxWidth = '560px';
            modal.style.width = '100%';
            modal.style.padding = '18px';
            modal.style.borderRadius = '22px';
            modal.style.background = 'rgba(255,255,255,0.88)';
            modal.style.backdropFilter = 'blur(14px)';

            const h2 = document.createElement('h2');
            h2.textContent = data.title;
            h2.style.color = 'var(--kids-dark)';
            h2.style.marginBottom = '10px';

            const stepBadge = document.createElement('div');
            stepBadge.className = 'notice';
            stepBadge.style.marginBottom = '10px';

            const qWrap = document.createElement('div');
            qWrap.className = 'q';

            const qText = document.createElement('strong');
            qWrap.appendChild(qText);

            const answersWrap = document.createElement('div');
            answersWrap.style.display = 'grid';
            answersWrap.style.gap = '8px';
            qWrap.appendChild(answersWrap);

            const qFb = document.createElement('div');
            qFb.className = 'q-feedback';
            qWrap.appendChild(qFb);

            const overall = document.createElement('div');
            overall.className = 'feedback';
            overall.style.marginTop = '12px';

            const nextBtn = document.createElement('button');
            nextBtn.className = 'btn btn-primary';
            nextBtn.style.width = '100%';

            function renderStep() {
                const current = data.steps[step];
                stepBadge.textContent = t(lang, 'quest_step', { n: step + 1, total });
                qText.textContent = current.q;
                answersWrap.innerHTML = '';
                qFb.style.display = 'none';
                qFb.classList.remove('success', 'error');
                overall.style.display = 'none';
                overall.classList.remove('success', 'error');

                current.a.forEach((ans, idx) => {
                    const label = document.createElement('label');
                    const input = document.createElement('input');
                    input.type = 'radio';
                    input.name = 'quest_step';
                    input.value = String(idx);
                    label.appendChild(input);
                    label.appendChild(document.createTextNode(ans));
                    answersWrap.appendChild(label);
                });

                nextBtn.textContent = step === total - 1 ? t(lang, 'quest_finish') : t(lang, 'quest_next');
            }

            nextBtn.addEventListener('click', () => {
                const selected = modal.querySelector('input[name="quest_step"]:checked')?.value;
                if (selected == null) {
                    showFeedback(qFb, 'error', t(lang, 'quest_need_choice'));
                    return;
                }

                const current = data.steps[step];
                const ok = String(current.c) === String(selected);
                if (ok) {
                    score += 1;
                    showFeedback(qFb, 'success', t(lang, 'quiz_correct'));
                } else {
                    showFeedback(qFb, 'error', t(lang, 'quiz_wrong'));
                }

                if (step < total - 1) {
                    step += 1;
                    setTimeout(renderStep, 220);
                    return;
                }

                const pass = score >= 4;
                showFeedback(overall, pass ? 'success' : 'error', pass ? t(lang, 'quest_result_pass') : t(lang, 'quest_result_fail'));

                if (pass) {
                    done.add(questId);
                    user.kids_quests_done = Array.from(done);
                    user.tasks_completed = Number(user.tasks_completed ?? 0) + 1;
                    saveUser(user);

                    const reward = 15;
                    addPoints(user, reward, `quest:${questId}`);
                    showFeedback(feedbackEl, 'success', t(lang, 'quest_reward', { points: reward }));
                    updateLanguage(lang);

                    setTimeout(() => overlay.remove(), 650);
                }
            });

            modal.appendChild(h2);
            modal.appendChild(stepBadge);
            modal.appendChild(qWrap);
            modal.appendChild(nextBtn);
            modal.appendChild(overall);
            overlay.appendChild(modal);
            document.body.appendChild(overlay);

            renderStep();
        }

        function showFeedback(el, type, text) {
            if (!el) return;
            el.classList.remove('success', 'error');
            el.classList.add(type);
            el.textContent = text;
            el.style.display = 'block';
        }

        function getLessonData(lang, lessonId) {
            const bank = {
                eco_intro: {
                    noteTitle: { ru: '–ö–æ–Ω—Å–ø–µ–∫—Ç: —ç–∫–æ–ª–æ–≥–∏—è', kz: '–ö–æ–Ω—Å–ø–µ–∫—Ç: —ç–∫–æ–ª–æ–≥–∏—è' },
                    noteText: {
                        ru: '–≠–∫–æ–ª–æ–≥–∏—è ‚Äî —ç—Ç–æ –Ω–∞—É–∫–∞ –æ –ø—Ä–∏—Ä–æ–¥–µ –∏ –æ —Ç–æ–º, –∫–∞–∫ –∂–∏–≤—ã–µ —Å—É—â–µ—Å—Ç–≤–∞ —Å–≤—è–∑–∞–Ω—ã –º–µ–∂–¥—É —Å–æ–±–æ–π. –ï—Å–ª–∏ –º—ã –Ω–µ –º—É—Å–æ—Ä–∏–º, –±–µ—Ä–µ–∂—ë–º –≤–æ–¥—É –∏ —Å–æ—Ä—Ç–∏—Ä—É–µ–º –æ—Ç—Ö–æ–¥—ã ‚Äî –ø—Ä–∏—Ä–æ–¥–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ª–µ–≥—á–µ.',
                        kz: '–≠–∫–æ–ª–æ–≥–∏—è ‚Äî —Ç–∞–±–∏“ì–∞—Ç—Ç—ã –∂”ô–Ω–µ —Ç—ñ—Ä—ñ –∞“ì–∑–∞–ª–∞—Ä–¥—ã“£ –±—ñ—Ä-–±—ñ—Ä—ñ–º–µ–Ω –±–∞–π–ª–∞–Ω—ã—Å—ã–Ω –∑–µ—Ä—Ç—Ç–µ–π—Ç—ñ–Ω “ì—ã–ª—ã–º. “ö–æ“õ—ã—Å —Ç–∞—Å—Ç–∞–º–∞—Å–∞“õ, —Å—É–¥—ã “Ø–Ω–µ–º–¥–µ—Å–µ–∫ –∂”ô–Ω–µ “õ–∞–ª–¥—ã“õ—Ç—ã —Å“±—Ä—ã–ø—Ç–∞—Å–∞“õ ‚Äî —Ç–∞–±–∏“ì–∞—Ç“õ–∞ –∫”©–º–µ–∫—Ç–µ—Å–µ–º—ñ–∑.'
                    }
                },
                sorting: {
                    noteTitle: { ru: '–ö–æ–Ω—Å–ø–µ–∫—Ç: —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞', kz: '–ö–æ–Ω—Å–ø–µ–∫—Ç: —Å“±—Ä—ã–ø—Ç–∞—É' },
                    noteText: {
                        ru: '–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ –º—ã –∫–ª–∞–¥—ë–º –±—É–º–∞–≥—É, –ø–ª–∞—Å—Ç–∏–∫, —Å—Ç–µ–∫–ª–æ –∏ –º–µ—Ç–∞–ª–ª –æ—Ç–¥–µ–ª—å–Ω–æ. –¢–∞–∫ –æ—Ç—Ö–æ–¥—ã –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞—Ç—å –∏ —Å–¥–µ–ª–∞—Ç—å –Ω–æ–≤—ã–µ –≤–µ—â–∏.',
                        kz: '–°“±—Ä—ã–ø—Ç–∞—É ‚Äî “õ–∞“ì–∞–∑–¥—ã, –ø–ª–∞—Å—Ç–∏–∫—Ç—ñ, ”ô–π–Ω–µ–∫—Ç—ñ –∂”ô–Ω–µ –º–µ—Ç–∞–ª–¥—ã –±”©–ª–µ–∫ –∂–∏–Ω–∞—É. –°–æ–Ω–¥–∞ “õ–∞–ª–¥—ã“õ—Ç—ã “õ–∞–π—Ç–∞ ”©“£–¥–µ–ø, –∂–∞“£–∞ –∑–∞—Ç –∂–∞—Å–∞—É“ì–∞ –±–æ–ª–∞–¥—ã.'
                    }
                },
                water: {
                    noteTitle: { ru: '–ö–æ–Ω—Å–ø–µ–∫—Ç: –≤–æ–¥–∞', kz: '–ö–æ–Ω—Å–ø–µ–∫—Ç: —Å—É' },
                    noteText: {
                        ru: '–ß–∏—Å—Ç–∞—è –≤–æ–¥–∞ –Ω—É–∂–Ω–∞ –ª—é–¥—è–º, –∂–∏–≤–æ—Ç–Ω—ã–º –∏ —Ä–∞—Å—Ç–µ–Ω–∏—è–º. –ó–∞–∫—Ä—ã–≤–∞–π—Ç–µ –∫—Ä–∞–Ω, –∫–æ–≥–¥–∞ —á–∏—Å—Ç–∏—Ç–µ –∑—É–±—ã, –∏ –Ω–µ –∑–∞–≥—Ä—è–∑–Ω—è–π—Ç–µ —Ä–µ–∫–∏ –∏ –æ–∑—ë—Ä–∞.',
                        kz: '–¢–∞–∑–∞ —Å—É –∞–¥–∞–º–¥–∞—Ä“ì–∞, –∂–∞–Ω—É–∞—Ä–ª–∞—Ä“ì–∞ –∂”ô–Ω–µ ”©—Å—ñ–º–¥—ñ–∫—Ç–µ—Ä–≥–µ –∫–µ—Ä–µ–∫. –¢—ñ—Å –∂—É“ì–∞–Ω–¥–∞ –∫—Ä–∞–Ω–¥—ã –∂–∞—É—ã–ø, ”©–∑–µ–Ω-–∫”©–ª–¥—ñ –ª–∞—Å—Ç–∞–º–∞“£—ã–∑.'
                    }
                },
                forest: {
                    noteTitle: { ru: '–ö–æ–Ω—Å–ø–µ–∫—Ç: –ª–µ—Å', kz: '–ö–æ–Ω—Å–ø–µ–∫—Ç: –æ—Ä–º–∞–Ω' },
                    noteText: {
                        ru: '–õ–µ—Å –¥–∞—ë—Ç –∫–∏—Å–ª–æ—Ä–æ–¥ –∏ –∑–∞—â–∏—â–∞–µ—Ç –ø–æ—á–≤—É. –ë–µ—Ä–µ–≥–∏—Ç–µ –¥–µ—Ä–µ–≤—å—è, –Ω–µ –ª–æ–º–∞–π—Ç–µ –≤–µ—Ç–∫–∏ –∏ —É–±–∏—Ä–∞–π—Ç–µ –º—É—Å–æ—Ä –ø–æ—Å–ª–µ –ø—Ä–æ–≥—É–ª–∫–∏.',
                        kz: '–û—Ä–º–∞–Ω –æ—Ç—Ç–µ–≥—ñ –±–µ—Ä–µ–¥—ñ –∂”ô–Ω–µ —Ç–æ–ø—ã—Ä–∞“õ—Ç—ã “õ–æ—Ä“ì–∞–π–¥—ã. –ê“ì–∞—à—Ç–∞—Ä–¥—ã –∞—è–ª–∞–ø, –±“±—Ç–∞“õ —Å—ã–Ω–¥—ã—Ä–º–∞–π, —Å–µ—Ä—É–µ–Ω–Ω–µ–Ω –∫–µ–π—ñ–Ω “õ–æ“õ—ã—Å—Ç—ã –∂–∏–Ω–∞“£—ã–∑.'
                    }
                },
                recycling: {
                    noteTitle: { ru: '–ö–æ–Ω—Å–ø–µ–∫—Ç: –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞', kz: '–ö–æ–Ω—Å–ø–µ–∫—Ç: “õ–∞–π—Ç–∞ ”©“£–¥–µ—É' },
                    noteText: {
                        ru: '–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–º–æ–≥–∞–µ—Ç —É–º–µ–Ω—å—à–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º—É—Å–æ—Ä–∞. –ò–∑ –ø–ª–∞—Å—Ç–∏–∫–∞ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –Ω–æ–≤—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã, –∞ –∏–∑ –±—É–º–∞–≥–∏ ‚Äî –Ω–æ–≤—É—é –±—É–º–∞–≥—É.',
                        kz: '“ö–∞–π—Ç–∞ ”©“£–¥–µ—É “õ–æ“õ—ã—Å—Ç—ã –∞–∑–∞–π—Ç–∞–¥—ã. –ü–ª–∞—Å—Ç–∏–∫—Ç–µ–Ω –∂–∞“£–∞ –∑–∞—Ç, “õ–∞“ì–∞–∑–¥–∞–Ω –∂–∞“£–∞ “õ–∞“ì–∞–∑ –∂–∞—Å–∞—É“ì–∞ –±–æ–ª–∞–¥—ã.'
                    }
                },
                red_book_kz: {
                    noteTitle: { ru: '–ö–æ–Ω—Å–ø–µ–∫—Ç: –ö—Ä–∞—Å–Ω–∞—è –∫–Ω–∏–≥–∞ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞', kz: '–ö–æ–Ω—Å–ø–µ–∫—Ç: “ö–∞–∑–∞“õ—Å—Ç–∞–Ω–Ω—ã“£ “ö—ã–∑—ã–ª –∫—ñ—Ç–∞–±—ã' },
                    noteText: {
                        ru: '–ö—Ä–∞—Å–Ω–∞—è –∫–Ω–∏–≥–∞ ‚Äî —ç—Ç–æ —Å–ø–∏—Å–æ–∫ —Ä–µ–¥–∫–∏—Ö —Ä–∞—Å—Ç–µ–Ω–∏–π –∏ –∂–∏–≤–æ—Ç–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–º –Ω—É–∂–Ω–∞ –∑–∞—â–∏—Ç–∞. –ï—Å–ª–∏ –∏—Å—á–µ–∑–∞–µ—Ç –æ–¥–∏–Ω –≤–∏–¥, –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è –≤—Å—è –ø—Ä–∏—Ä–æ–¥–∞. –ü–æ–º–æ–≥–∞—é—Ç: –Ω–µ –º—É—Å–æ—Ä–∏—Ç—å, –Ω–µ —Ä–∞–∑—Ä—É—à–∞—Ç—å –º–µ—Å—Ç–∞ –æ–±–∏—Ç–∞–Ω–∏—è, –±–µ—Ä–µ—á—å –≤–æ–¥—É –∏ –ª–µ—Å.',
                        kz: '“ö—ã–∑—ã–ª –∫—ñ—Ç–∞–ø ‚Äî “õ–æ—Ä“ì–∞—É–¥—ã “õ–∞–∂–µ—Ç –µ—Ç–µ—Ç—ñ–Ω —Å–∏—Ä–µ–∫ ”©—Å—ñ–º–¥—ñ–∫—Ç–µ—Ä –º–µ–Ω –∂–∞–Ω—É–∞—Ä–ª–∞—Ä–¥—ã“£ —Ç—ñ–∑—ñ–º—ñ. –ë—ñ—Ä —Ç“Ø—Ä –∂–æ“ì–∞–ª—Å–∞, —Ç–∞–±–∏“ì–∞—Ç—Ç—ã“£ —Ç–µ–ø–µ-—Ç–µ“£–¥—ñ–≥—ñ –±“±–∑—ã–ª—É—ã –º“Ø–º–∫—ñ–Ω. –ö”©–º–µ–∫: “õ–æ“õ—ã—Å —Ç–∞—Å—Ç–∞–º–∞—É, –º–µ–∫–µ–Ω—ñ–Ω –±“±–∑–±–∞—É, —Å—É –º–µ–Ω –æ—Ä–º–∞–Ω–¥—ã “õ–æ—Ä“ì–∞—É.'
                    }
                },
                animals_kz: {
                    noteTitle: { ru: '–ö–æ–Ω—Å–ø–µ–∫—Ç: –∂–∏–≤–æ—Ç–Ω—ã–µ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞', kz: '–ö–æ–Ω—Å–ø–µ–∫—Ç: “ö–∞–∑–∞“õ—Å—Ç–∞–Ω –∂–∞–Ω—É–∞—Ä–ª–∞—Ä—ã' },
                    noteText: {
                        ru: '–í –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ –∂–∏–≤—É—Ç —Å–∞–π–≥–∞–∫–∏, —Å–Ω–µ–∂–Ω—ã–µ –±–∞—Ä—Å—ã, —Å—Ç–µ–ø–Ω—ã–µ –æ—Ä–ª—ã –∏ –º–Ω–æ–≥–∏–µ –¥—Ä—É–≥–∏–µ –∂–∏–≤–æ—Ç–Ω—ã–µ. –ò–º –Ω—É–∂–Ω—ã —á–∏—Å—Ç—ã–µ —Å—Ç–µ–ø–∏, –≥–æ—Ä—ã –∏ –≤–æ–¥–æ—ë–º—ã. –ö–æ–≥–¥–∞ –º—ã –æ—Å—Ç–∞–≤–ª—è–µ–º –º—É—Å–æ—Ä –∏ –∑–∞–≥—Ä—è–∑–Ω—è–µ–º –≤–æ–¥—É, –∂–∏–≤–æ—Ç–Ω—ã–º —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Ç—Ä—É–¥–Ω–æ –∂–∏—Ç—å.',
                        kz: '“ö–∞–∑–∞“õ—Å—Ç–∞–Ω–¥–∞ –∫–∏—ñ–∫, “õ–∞—Ä –±–∞—Ä—ã—Å—ã, –¥–∞–ª–∞ –±“Ø—Ä–∫—ñ—Ç—ñ —Å–∏—è“õ—Ç—ã –∫”©–ø—Ç–µ–≥–µ–Ω –∂–∞–Ω—É–∞—Ä–ª–∞—Ä –±–∞—Ä. –û–ª–∞—Ä“ì–∞ —Ç–∞–∑–∞ –¥–∞–ª–∞, —Ç–∞—É–ª–∞—Ä –º–µ–Ω —Å—É –∫”©–∑–¥–µ—Ä—ñ –∫–µ—Ä–µ–∫. “ö–æ“õ—ã—Å –ø–µ–Ω –ª–∞—Å —Å—É –∂–∞–Ω—É–∞—Ä–ª–∞—Ä“ì–∞ –∑–∏—è–Ω –∫–µ–ª—Ç—ñ—Ä–µ–¥—ñ.'
                    }
                },
                city_litter_birds: {
                    noteTitle: { ru: '–ö–æ–Ω—Å–ø–µ–∫—Ç: –º—É—Å–æ—Ä –∏ –ø—Ç–∏—Ü—ã', kz: '–ö–æ–Ω—Å–ø–µ–∫—Ç: “õ–æ“õ—ã—Å –∂”ô–Ω–µ “õ“±—Å—Ç–∞—Ä' },
                    noteText: {
                        ru: '–ú—É—Å–æ—Ä –Ω–∞ —É–ª–∏—Ü–∞—Ö –æ–ø–∞—Å–µ–Ω: –ø—Ç–∏—Ü—ã –º–æ–≥—É—Ç –∑–∞–ø—É—Ç–∞—Ç—å—Å—è –≤ –ø–∞–∫–µ—Ç–∞—Ö, –ø—Ä–æ–≥–ª–æ—Ç–∏—Ç—å –ø–ª–∞—Å—Ç–∏–∫, –ø–æ—Ä–∞–Ω–∏—Ç—å—Å—è —Å—Ç–µ–∫–ª–æ–º. –í–æ –¥–≤–æ—Ä–∞—Ö –º—É—Å–æ—Ä –ø—Ä–∏–≤–ª–µ–∫–∞–µ—Ç –∫—Ä—ã—Å –∏ —Å–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∞—Ö. –†–µ—à–µ–Ω–∏–µ: —É—Ä–Ω—ã, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞, —É–±–æ—Ä–∫–∞ –∏ –º–Ω–æ–≥–æ—Ä–∞–∑–æ–≤—ã–µ –≤–µ—â–∏.',
                        kz: '–ö”©—à–µ–¥–µ–≥—ñ “õ–æ“õ—ã—Å “õ–∞—É—ñ–ø—Ç—ñ: “õ“±—Å—Ç–∞—Ä –ø–∞–∫–µ—Ç–∫–µ —à—ã—Ä–º–∞–ª—ã–ø, –ø–ª–∞—Å—Ç–∏–∫ –∂“±—Ç—ã–ø, ”ô–π–Ω–µ–∫–∫–µ –∂–∞—Ä–∞“õ–∞—Ç –∞–ª—É—ã –º“Ø–º–∫—ñ–Ω. –ê—É–ª–∞–¥–∞“ì—ã “õ–æ“õ—ã—Å –µ–≥–µ—É“õ“±–π—Ä—ã“õ—Ç—ã —Ç–∞—Ä—Ç—ã–ø, –∂–∞“ì—ã–º—Å—ã–∑ –∏—ñ—Å —à—ã“ì–∞—Ä–∞–¥—ã. –®–µ—à—ñ–º: “õ–æ“õ—ã—Å –∂”ô—à—ñ–≥—ñ, —Å“±—Ä—ã–ø—Ç–∞—É, —Ç–∞–∑–∞–ª—ã“õ, –∫”©–ø —Ä–µ—Ç “õ–æ–ª–¥–∞–Ω—ã–ª–∞—Ç—ã–Ω –∑–∞—Ç—Ç–∞—Ä.'
                    }
                }
            };

            const base = bank[lessonId] || bank.eco_intro;
            const questions = getLessonQuestions(lang, lessonId);
            const minScore = Math.max(6, Math.floor(questions.length * 0.7));
            return {
                noteTitle: base.noteTitle[lang],
                noteText: base.noteText[lang],
                questions,
                minScore
            };
        }

        function getLessonQuestions(lang, lessonId) {
            const ru = [
                { id: 'q1', text: '–ß—Ç–æ –ª—É—á—à–µ –≤—Å–µ–≥–æ –ø–æ–º–æ–≥–∞–µ—Ç –ø—Ä–∏—Ä–æ–¥–µ?', options: ['–ë—Ä–æ—Å–∞—Ç—å –º—É—Å–æ—Ä', '–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—Ö–æ–¥—ã', '–õ–æ–º–∞—Ç—å –¥–µ—Ä–µ–≤—å—è'], correct: 1 },
                { id: 'q2', text: '–ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ —ç–∫–æ–Ω–æ–º–∏—Ç—å –≤–æ–¥—É?', options: ['–í–æ–¥–∞ –±–µ—Å–∫–æ–Ω–µ—á–Ω–∞', '–ß–∏—Å—Ç–∞—è –≤–æ–¥–∞ –Ω—É–∂–Ω–∞ –≤—Å–µ–º', '–ß—Ç–æ–±—ã –±—ã–ª–æ –±–æ–ª—å—à–µ –º—É—Å–æ—Ä–∞'], correct: 1 },
                { id: 'q3', text: '–ß—Ç–æ —Ç–∞–∫–æ–µ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞?', options: ['–°–∂–µ—á—å –≤—Å—ë', '–°–¥–µ–ª–∞—Ç—å –∏–∑ –æ—Ç—Ö–æ–¥–æ–≤ –Ω–æ–≤—ã–µ –≤–µ—â–∏', '–°–ø—Ä—è—Ç–∞—Ç—å –º—É—Å–æ—Ä'], correct: 1 },
                { id: 'q4', text: '–ö—É–¥–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã–±—Ä–æ—Å–∏—Ç—å –±—É–º–∞–≥—É?', options: ['–í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –±—É–º–∞–≥–∏', '–í —Ä–µ–∫—É', '–ù–∞ –∑–µ–º–ª—é'], correct: 0 },
                { id: 'q5', text: '–ß—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å, —á—Ç–æ–±—ã –≤–æ–∑–¥—É—Ö –±—ã–ª —á–∏—â–µ?', options: ['–°–∞–∂–∞—Ç—å –¥–µ—Ä–µ–≤—å—è', '–ñ–µ—á—å –º—É—Å–æ—Ä', '–ë–æ–ª—å—à–µ –µ–∑–¥–∏—Ç—å –Ω–∞ –º–∞—à–∏–Ω–µ'], correct: 0 },
                { id: 'q6', text: '–ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø–æ—Å–ª–µ –ø–∏–∫–Ω–∏–∫–∞ –≤ –ø–∞—Ä–∫–µ?', options: ['–û—Å—Ç–∞–≤–∏—Ç—å –º—É—Å–æ—Ä', '–°–æ–±—Ä–∞—Ç—å –º—É—Å–æ—Ä —Å —Å–æ–±–æ–π', '–ó–∞–∫–æ–ø–∞—Ç—å –ø–ª–∞—Å—Ç–∏–∫'], correct: 1 },
                { id: 'q7', text: '–ß—Ç–æ –ª—É—á—à–µ –≤—ã–±—Ä–∞—Ç—å –≤ –º–∞–≥–∞–∑–∏–Ω–µ?', options: ['–ú–Ω–æ–≥–æ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã—Ö –ø–∞–∫–µ—Ç–æ–≤', '–ú–Ω–æ–≥–æ—Ä–∞–∑–æ–≤—É—é —Å—É–º–∫—É', '–ë—É—Ç—ã–ª–∫–∏ –∏ –º—É—Å–æ—Ä'], correct: 1 },
                { id: 'q8', text: '–ü–æ—á–µ–º—É –Ω–µ–ª—å–∑—è –±—Ä–æ—Å–∞—Ç—å –±–∞—Ç–∞—Ä–µ–π–∫–∏ –≤ –æ–±—â–∏–π –º—É—Å–æ—Ä?', options: ['–û–Ω–∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã', '–û–Ω–∏ –∑–∞–≥—Ä—è–∑–Ω—è—é—Ç –ø–æ—á–≤—É –∏ –≤–æ–¥—É', '–ü–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω–∏ —Ç—è–∂—ë–ª—ã–µ'], correct: 1 },
                { id: 'q9', text: '–ß—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –∂–∏–≤–æ—Ç–Ω—ã–º –∑–∏–º–æ–π?', options: ['–ü—É–≥–∞—Ç—å –∏—Ö', '–ù–µ –ª–æ–º–∞—Ç—å –∏—Ö –¥–æ–º', '–ë—Ä–æ—Å–∞—Ç—å –ø–ª–∞—Å—Ç–∏–∫'], correct: 1 },
                { id: 'q10', text: '–ö–∞–∫ –º–æ–∂–Ω–æ —ç–∫–æ–Ω–æ–º–∏—Ç—å —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ?', options: ['–í—ã–∫–ª—é—á–∞—Ç—å —Å–≤–µ—Ç, –∫–æ–≥–¥–∞ –Ω–µ –Ω—É–∂–µ–Ω', '–î–µ—Ä–∂–∞—Ç—å –≤—Å—ë –≤–∫–ª—é—á—ë–Ω–Ω—ã–º', '–õ–æ–º–∞—Ç—å –ª–∞–º–ø—ã'], correct: 0 },
                { id: 'q11', text: '–ß—Ç–æ —Ç–∞–∫–æ–µ "—á–∏—Å—Ç—ã–π –¥–≤–æ—Ä"?', options: ['–ì–¥–µ –º–Ω–æ–≥–æ –º—É—Å–æ—Ä–∞', '–ì–¥–µ –Ω–µ—Ç –º—É—Å–æ—Ä–∞ –∏ –≤—Å—ë —É–±—Ä–∞–Ω–æ', '–ì–¥–µ –ª–æ–º–∞—é—Ç –¥–µ—Ä–µ–≤—å—è'], correct: 1 },
                { id: 'q12', text: '–ß—Ç–æ –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞—Ç—å?', options: ['–ü–ª–∞—Å—Ç–∏–∫ –∏ –±—É–º–∞–≥—É', '–ó–µ–º–ª—é', '–î—ã–º'], correct: 0 },
                { id: 'q13', text: '–ü–æ—á–µ–º—É –¥–µ—Ä–µ–≤—å—è –≤–∞–∂–Ω—ã?', options: ['–û–Ω–∏ –º–µ—à–∞—é—Ç', '–û–Ω–∏ –¥–∞—é—Ç –∫–∏—Å–ª–æ—Ä–æ–¥', '–û–Ω–∏ –¥–µ–ª–∞—é—Ç –º—É—Å–æ—Ä'], correct: 1 },
                { id: 'q14', text: '–ß—Ç–æ –ª—É—á—à–µ –¥–ª—è –≤–æ–¥—ã?', options: ['–õ–∏—Ç—å –º–∞—Å–ª–æ –≤ —Ä–∞–∫–æ–≤–∏–Ω—É', '–ù–µ –≤—ã–ª–∏–≤–∞—Ç—å –≤—Ä–µ–¥–Ω–æ–µ –≤ –≤–æ–¥—É', '–ë—Ä–æ—Å–∞—Ç—å –º—É—Å–æ—Ä –≤ —Ä–µ–∫—É'], correct: 1 },
                { id: 'q15', text: '–ö–∞–∫ –º–æ–∂–Ω–æ –ø–æ–º–æ—á—å –≥–æ—Ä–æ–¥—É —Å—Ç–∞—Ç—å —á–∏—â–µ?', options: ['–£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —É–±–æ—Ä–∫–µ', '–†–∞–∑–±—Ä–∞—Å—ã–≤–∞—Ç—å –º—É—Å–æ—Ä', '–†–≤–∞—Ç—å —Ü–≤–µ—Ç—ã'], correct: 0 }
            ];

            const kz = [
                { id: 'q1', text: '–¢–∞–±–∏“ì–∞—Ç“õ–∞ –µ“£ –∂–∞“õ—Å—ã –∫”©–º–µ–∫—Ç–µ—Å–µ—Ç—ñ–Ω –Ω–µ?', options: ['“ö–æ“õ—ã—Å —Ç–∞—Å—Ç–∞—É', '“ö–∞–ª–¥—ã“õ—Ç—ã —Å“±—Ä—ã–ø—Ç–∞—É', '–ê“ì–∞—à —Å—ã–Ω–¥—ã—Ä—É'], correct: 1 },
                { id: 'q2', text: '–°—É–¥—ã “Ø–Ω–µ–º–¥–µ—É –Ω–µ “Ø—à—ñ–Ω –º–∞“£—ã–∑–¥—ã?', options: ['–°—É —à–µ–∫—Å—ñ–∑', '–¢–∞–∑–∞ —Å—É –±”ô—Ä—ñ–Ω–µ –∫–µ—Ä–µ–∫', '“ö–æ“õ—ã—Å –∫”©–ø –±–æ–ª—É “Ø—à—ñ–Ω'], correct: 1 },
                { id: 'q3', text: '“ö–∞–π—Ç–∞ ”©“£–¥–µ—É –¥–µ–≥–µ–Ω –Ω–µ?', options: ['–ë”ô—Ä—ñ–Ω –∂–∞“ì—É', '“ö–∞–ª–¥—ã“õ—Ç–∞–Ω –∂–∞“£–∞ –∑–∞—Ç –∂–∞—Å–∞—É', '“ö–æ“õ—ã—Å—Ç—ã –∂–∞—Å—ã—Ä—É'], correct: 1 },
                { id: 'q4', text: '“ö–∞“ì–∞–∑–¥—ã “õ–∞–π–¥–∞ —Ç–∞—Å—Ç–∞—É –¥“±—Ä—ã—Å?', options: ['“ö–∞“ì–∞–∑“ì–∞ –∞—Ä–Ω–∞–ª“ì–∞–Ω –∂”ô—à—ñ–∫–∫–µ', '”®–∑–µ–Ω–≥–µ', '–ñ–µ—Ä–≥–µ'], correct: 0 },
                { id: 'q5', text: '–ê—É–∞–Ω—ã “õ–∞–ª–∞–π —Ç–∞–∑–∞—Ä—Ç–∞ –∞–ª–∞–º—ã–∑?', options: ['–ê“ì–∞—à –æ—Ç—ã—Ä“ì—ã–∑—É', '“ö–æ“õ—ã—Å –∂–∞“ì—É', '–ö”©–ª—ñ–∫–ø–µ–Ω –∫”©–ø –∂“Ø—Ä—É'], correct: 0 },
                { id: 'q6', text: '–°–∞—è–±–∞“õ—Ç–∞ –ø–∏–∫–Ω–∏–∫—Ç–µ–Ω –∫–µ–π—ñ–Ω –Ω–µ —ñ—Å—Ç–µ–π–º—ñ–∑?', options: ['“ö–æ“õ—ã—Å—Ç—ã —Ç–∞—Å—Ç–∞–ø –∫–µ—Ç—É', '“ö–æ“õ—ã—Å—Ç—ã –∂–∏–Ω–∞–ø –∞–ª—ã–ø –∫–µ—Ç—É', '–ü–ª–∞—Å—Ç–∏–∫—Ç—ñ –∫”©–º—É'], correct: 1 },
                { id: 'q7', text: '–î“Ø–∫–µ–Ω–¥–µ –Ω–µ–Ω—ñ —Ç–∞“£–¥–∞“ì–∞–Ω –¥“±—Ä—ã—Å?', options: ['–ë—ñ—Ä —Ä–µ—Ç—Ç—ñ–∫ –ø–∞–∫–µ—Ç –∫”©–ø –∞–ª—É', '–ö”©–ø —Ä–µ—Ç “õ–æ–ª–¥–∞–Ω—ã–ª–∞—Ç—ã–Ω —Å”©–º–∫–µ', '–ë”©—Ç–µ–ª–∫–µ –º–µ–Ω “õ–æ“õ—ã—Å'], correct: 1 },
                { id: 'q8', text: '–ù–µ–≥–µ –±–∞—Ç–∞—Ä–µ–π–∫–∞–Ω—ã –∂–∞–ª–ø—ã “õ–æ“õ—ã—Å“õ–∞ —Ç–∞—Å—Ç–∞—É“ì–∞ –±–æ–ª–º–∞–π–¥—ã?', options: ['–û–ª “õ–∞—É—ñ–ø—Å—ñ–∑', '–¢–æ–ø—ã—Ä–∞“õ –ø–µ–Ω —Å—É–¥—ã –ª–∞—Å—Ç–∞–π–¥—ã', '”®–π—Ç–∫–µ–Ω—ñ –∞—É—ã—Ä'], correct: 1 },
                { id: 'q9', text: '“ö—ã—Å—Ç–∞ –∂–∞–Ω—É–∞—Ä–ª–∞—Ä“ì–∞ –Ω–µ –∫”©–º–µ–∫—Ç–µ—Å–µ–¥—ñ?', options: ['“ö–æ—Ä“õ—ã—Ç—É', '“Æ–π—ñ–Ω –±“±–∑–±–∞—É', '–ü–ª–∞—Å—Ç–∏–∫ —Ç–∞—Å—Ç–∞—É'], correct: 1 },
                { id: 'q10', text: '–≠–ª–µ–∫—Ç—Ä–¥—ñ “õ–∞–ª–∞–π “Ø–Ω–µ–º–¥–µ–π–º—ñ–∑?', options: ['“ö–∞–∂–µ—Ç –µ–º–µ—Å –∫–µ–∑–¥–µ –∂–∞—Ä—ã“õ—Ç—ã ”©—à—ñ—Ä—É', '–ë”ô—Ä—ñ–Ω “õ–æ—Å—É–ª—ã “±—Å—Ç–∞—É', '–®–∞–º–¥—ã —Å—ã–Ω–¥—ã—Ä—É'], correct: 0 },
                { id: 'q11', text: '"–¢–∞–∑–∞ –∞—É–ª–∞" –¥–µ–≥–µ–Ω –Ω–µ?', options: ['“ö–æ“õ—ã—Å –∫”©–ø –∂–µ—Ä', '“ö–æ“õ—ã—Å –∂–æ“õ, –∂–∏–Ω–∞“õ—ã –∂–µ—Ä', '–ê“ì–∞—à —Å—ã–Ω–¥—ã—Ä–∞—Ç—ã–Ω –∂–µ—Ä'], correct: 1 },
                { id: 'q12', text: '–ù–µ–Ω—ñ “õ–∞–π—Ç–∞ ”©“£–¥–µ—É–≥–µ –±–æ–ª–∞–¥—ã?', options: ['–ü–ª–∞—Å—Ç–∏–∫ –ø–µ–Ω “õ–∞“ì–∞–∑', '–ñ–µ—Ä', '–¢“Ø—Ç—ñ–Ω'], correct: 0 },
                { id: 'q13', text: '–ê“ì–∞—à –Ω–µ–≥–µ –º–∞“£—ã–∑–¥—ã?', options: ['–ö–µ–¥–µ—Ä–≥—ñ', '–û—Ç—Ç–µ–≥—ñ –±–µ—Ä–µ–¥—ñ', '“ö–æ“õ—ã—Å –∂–∞—Å–∞–π–¥—ã'], correct: 1 },
                { id: 'q14', text: '–°—É“ì–∞ “õ–∞–π—Å—ã—Å—ã –¥“±—Ä—ã—Å?', options: ['–ú–∞–π–¥—ã —Ä–∞–∫–æ–≤–∏–Ω–∞“ì–∞ “õ“±—é', '–ó–∏—è–Ω–¥—ã–Ω—ã —Å—É“ì–∞ —Ç”©–∫–ø–µ—É', '”®–∑–µ–Ω–≥–µ “õ–æ“õ—ã—Å —Ç–∞—Å—Ç–∞—É'], correct: 1 },
                { id: 'q15', text: '“ö–∞–ª–∞–Ω—ã —Ç–∞–∑–∞ –µ—Ç—É–≥–µ “õ–∞–ª–∞–π –∫”©–º–µ–∫—Ç–µ—Å–µ–º—ñ–∑?', options: ['–¢–∞–∑–∞–ª—ã“õ“õ–∞ “õ–∞—Ç—ã—Å—É', '“ö–æ“õ—ã—Å —à–∞—à—É', '–ì“Ø–ª –∂“±–ª—É'], correct: 0 }
            ];

            const redBookRu = [
                { id: 'rb1', text: '–ß—Ç–æ —Ç–∞–∫–æ–µ –ö—Ä–∞—Å–Ω–∞—è –∫–Ω–∏–≥–∞?', options: ['–°–±–æ—Ä–Ω–∏–∫ —Å–∫–∞–∑–æ–∫', '–°–ø–∏—Å–æ–∫ —Ä–µ–¥–∫–∏—Ö –≤–∏–¥–æ–≤, –∫–æ—Ç–æ—Ä—ã–º –Ω—É–∂–Ω–∞ –∑–∞—â–∏—Ç–∞', '–£—á–µ–±–Ω–∏–∫ –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ'], correct: 1 },
                { id: 'rb2', text: '–ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ –±–µ—Ä–µ—á—å —Ä–µ–¥–∫–∏—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö?', options: ['–ß—Ç–æ–±—ã –Ω–∞—Ä—É—à–∏—Ç—å –ø—Ä–∏—Ä–æ–¥—É', '–ß—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å –≤ –ø—Ä–∏—Ä–æ–¥–µ', '–ü–æ—Ç–æ–º—É —á—Ç–æ —Ç–∞–∫ —Å–∫—É—á–Ω–µ–µ'], correct: 1 },
                { id: 'rb3', text: '–ß—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –∂–∏–≤–æ—Ç–Ω—ã–º –∂–∏—Ç—å?', options: ['–ß–∏—Å—Ç–∞—è –≤–æ–¥–∞ –∏ –¥–æ–º', '–ü–ª–∞—Å—Ç–∏–∫ –∏ –¥—ã–º', '–†–∞–∑—Ä—É—à–µ–Ω–∏–µ –ª–µ—Å–∞'], correct: 0 },
                { id: 'rb4', text: '–ß—Ç–æ –Ω–µ–ª—å–∑—è –¥–µ–ª–∞—Ç—å –≤ –ø—Ä–∏—Ä–æ–¥–µ?', options: ['–£–±–∏—Ä–∞—Ç—å –º—É—Å–æ—Ä', '–†–∞–∑—Ä—É—à–∞—Ç—å –≥–Ω—ë–∑–¥–∞ –∏ –Ω–æ—Ä—ã', '–°–∞–∂–∞—Ç—å –¥–µ—Ä–µ–≤—å—è'], correct: 1 },
                { id: 'rb5', text: '–ö–∞–∫ —Ç—ã –º–æ–∂–µ—à—å –ø–æ–º–æ—á—å?', options: ['–ú—É—Å–æ—Ä–∏—Ç—å', '–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –±–µ—Ä–µ—á—å –ø—Ä–∏—Ä–æ–¥—É', '–õ–æ–º–∞—Ç—å –≤–µ—Ç–∫–∏'], correct: 1 },
                { id: 'rb6', text: '–ï—Å–ª–∏ —É–≤–∏–¥–µ–ª –º—É—Å–æ—Ä –≤ –ª–µ—Å—É, —Ç—ã‚Ä¶', options: ['–°–æ–±–µ—Ä—É –∏ –≤—ã–±—Ä–æ—à—É', '–°–ø—Ä—è—á—É –ø–æ–¥ –∫—É—Å—Ç', '–î–æ–±–∞–≤–ª—é –µ—â—ë'], correct: 0 },
                { id: 'rb7', text: '–ß—Ç–æ –ª—É—á—à–µ –¥–ª—è –∂–∏–≤–æ—Ç–Ω—ã—Ö?', options: ['–ì—Ä–æ–º–∫–∞—è –º—É–∑—ã–∫–∞ –≤ –ª–µ—Å—É', '–¢–∏—Ö–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∏ —á–∏—Å—Ç–æ—Ç–∞', '–ü–∞–∫–µ—Ç—ã –Ω–∞ –≤–µ—Ç–∫–∞—Ö'], correct: 1 },
                { id: 'rb8', text: '–ü–æ—á–µ–º—É –Ω–µ–ª—å–∑—è –∂–µ—á—å –º—É—Å–æ—Ä?', options: ['–î—ã–º –∑–∞–≥—Ä—è–∑–Ω—è–µ—Ç –≤–æ–∑–¥—É—Ö', '–¢–∞–∫ –≤–µ—Å–µ–ª–µ–µ', '–≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –ø—Ç–∏—Ü–∞–º'], correct: 0 },
                { id: 'rb9', text: '–ß—Ç–æ –Ω—É–∂–Ω–æ –ª–µ—Å—É?', options: ['–û–≥–æ–Ω—å –∏ –º—É—Å–æ—Ä', '–ó–∞—â–∏—Ç–∞ –∏ –∑–∞–±–æ—Ç–∞', '–†–∞–∑—Ä—É—à–µ–Ω–∏–µ'], correct: 1 },
                { id: 'rb10', text: '–†–µ–¥–∫–∏–µ –∂–∏–≤–æ—Ç–Ω—ã–µ ‚Äî —ç—Ç–æ‚Ä¶', options: ['–¢–µ, –∫–æ–≥–æ –º–∞–ª–æ –∏ –Ω—É–∂–Ω–æ –±–µ—Ä–µ—á—å', '–¢–µ, –∫–æ–≥–æ –æ—á–µ–Ω—å –º–Ω–æ–≥–æ', '–ò–≥—Ä—É—à–∫–∏'], correct: 0 }
            ];

            const redBookKz = [
                { id: 'rb1', text: '“ö—ã–∑—ã–ª –∫—ñ—Ç–∞–ø –¥–µ–≥–µ–Ω –Ω–µ?', options: ['–ï—Ä—Ç–µ–≥—ñ –∂–∏–Ω–∞“ì—ã', '“ö–æ—Ä“ì–∞—É–¥—ã “õ–∞–∂–µ—Ç –µ—Ç–µ—Ç—ñ–Ω —Å–∏—Ä–µ–∫ —Ç“Ø—Ä–ª–µ—Ä —Ç—ñ–∑—ñ–º—ñ', '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –æ“õ—É–ª—ã“ì—ã'], correct: 1 },
                { id: 'rb2', text: '–°–∏—Ä–µ–∫ –∂–∞–Ω—É–∞—Ä–ª–∞—Ä–¥—ã –Ω–µ–≥–µ “õ–æ—Ä“ì–∞—É –∫–µ—Ä–µ–∫?', options: ['–¢–∞–±–∏“ì–∞—Ç—Ç—ã –±“±–∑—É “Ø—à—ñ–Ω', '–¢–∞–±–∏“ì–∏ —Ç–µ–ø–µ-—Ç–µ“£–¥—ñ–∫—Ç—ñ —Å–∞“õ—Ç–∞—É “Ø—à—ñ–Ω', '”®–π—Ç–∫–µ–Ω—ñ “õ—ã–∑—ã“õ –µ–º–µ—Å'], correct: 1 },
                { id: 'rb3', text: '–ñ–∞–Ω—É–∞—Ä–ª–∞—Ä“ì–∞ –Ω–µ –∫–µ—Ä–µ–∫?', options: ['–¢–∞–∑–∞ —Å—É –∂”ô–Ω–µ –º–µ–∫–µ–Ω', '–ü–ª–∞—Å—Ç–∏–∫ –ø–µ–Ω —Ç“Ø—Ç—ñ–Ω', '–û—Ä–º–∞–Ω–¥—ã –∫–µ—Å—É'], correct: 0 },
                { id: 'rb4', text: '–¢–∞–±–∏“ì–∞—Ç—Ç–∞ –Ω–µ–Ω—ñ –∂–∞—Å–∞—É“ì–∞ –±–æ–ª–º–∞–π–¥—ã?', options: ['“ö–æ“õ—ã—Å –∂–∏–Ω–∞—É', '“∞—è –º–µ–Ω —ñ–Ω–¥—ñ –±“±–∑—É', '–ê“ì–∞—à –æ—Ç—ã—Ä“ì—ã–∑—É'], correct: 1 },
                { id: 'rb5', text: '“ö–∞–ª–∞–π –∫”©–º–µ–∫—Ç–µ—Å–µ –∞–ª–∞—Å—ã“£?', options: ['“ö–æ“õ—ã—Å —à–∞—à—É', '–°“±—Ä—ã–ø—Ç–∞—É –∂”ô–Ω–µ —Ç–∞–±–∏“ì–∞—Ç—Ç—ã “õ–æ—Ä“ì–∞—É', '–ë“±—Ç–∞“õ —Å—ã–Ω–¥—ã—Ä—É'], correct: 1 },
                { id: 'rb6', text: '–û—Ä–º–∞–Ω–¥–∞ “õ–æ“õ—ã—Å –∫”©—Ä—Å–µ“£‚Ä¶', options: ['–ñ–∏–Ω–∞–ø, “õ–æ“õ—ã—Å“õ–∞ —Ç–∞—Å—Ç–∞–π–º—ã–Ω', '–ë“±—Ç–∞–Ω—ã“£ –∞—Å—Ç—ã–Ω–∞ —Ç—ã“ì–∞–º—ã–Ω', '–¢–∞“ì—ã “õ–æ—Å–∞–º—ã–Ω'], correct: 0 },
                { id: 'rb7', text: '–ñ–∞–Ω—É–∞—Ä–ª–∞—Ä“ì–∞ “õ–∞–π—Å—ã—Å—ã –∂–∞“õ—Å—ã?', options: ['–û—Ä–º–∞–Ω–¥–∞ “õ–∞—Ç—Ç—ã –º—É–∑—ã–∫–∞', '–¢—ã–Ω—ã—à—Ç—ã“õ –∂”ô–Ω–µ —Ç–∞–∑–∞–ª—ã“õ', '–ë“±—Ç–∞“õ—Ç–∞“ì—ã –ø–∞–∫–µ—Ç'], correct: 1 },
                { id: 'rb8', text: '–ù–µ–≥–µ “õ–æ“õ—ã—Å –∂–∞“ì—É“ì–∞ –±–æ–ª–º–∞–π–¥—ã?', options: ['–¢“Ø—Ç—ñ–Ω –∞—É–∞–Ω—ã –ª–∞—Å—Ç–∞–π–¥—ã', '–ë“±–ª “õ—ã–∑—ã“õ', '“ö“±—Å—Ç–∞—Ä“ì–∞ –∫”©–º–µ–∫—Ç–µ—Å–µ–¥—ñ'], correct: 0 },
                { id: 'rb9', text: '–û—Ä–º–∞–Ω“ì–∞ –Ω–µ –∫–µ—Ä–µ–∫?', options: ['–û—Ç –ø–µ–Ω “õ–æ“õ—ã—Å', '“ö–æ—Ä“ì–∞—É –∂”ô–Ω–µ –∫“Ø—Ç—ñ–º', '–ë“±–∑—É'], correct: 1 },
                { id: 'rb10', text: '–°–∏—Ä–µ–∫ –∂–∞–Ω—É–∞—Ä–ª–∞—Ä ‚Äî –±“±–ª‚Ä¶', options: ['–°–∞–Ω—ã –∞–∑, “õ–æ—Ä“ì–∞—É –∫–µ—Ä–µ–∫', '–°–∞–Ω—ã ”©—Ç–µ –∫”©–ø', '–û–π—ã–Ω—à—ã“õ'], correct: 0 }
            ];

            const animalsRu = [
                { id: 'ak1', text: '–ö—Ç–æ –∂–∏–≤—ë—Ç –≤ —Å—Ç–µ–ø—è—Ö –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞?', options: ['–ö–∏—ñ–∫ (—Å–∞–π–≥–∞–∫)', '–ü–∏–Ω–≥–≤–∏–Ω', '–¢—é–ª–µ–Ω—å'], correct: 0 },
                { id: 'ak2', text: '–ö—Ç–æ –∂–∏–≤—ë—Ç –≤ –≥–æ—Ä–∞—Ö?', options: ['–°–Ω–µ–∂–Ω—ã–π –±–∞—Ä—Å', '–ö—Ä–æ–∫–æ–¥–∏–ª', '–ê–∫—É–ª–∞'], correct: 0 },
                { id: 'ak3', text: '–ü–æ—á–µ–º—É –∂–∏–≤–æ—Ç–Ω—ã–º –Ω—É–∂–Ω–∞ —á–∏—Å—Ç–∞—è –≤–æ–¥–∞?', options: ['–ß—Ç–æ–±—ã –ø–∏—Ç—å –∏ –∂–∏—Ç—å', '–ß—Ç–æ–±—ã –º—É—Å–æ—Ä–∏—Ç—å', '–ß—Ç–æ–±—ã –ª–æ–º–∞—Ç—å –¥–µ—Ä–µ–≤—å—è'], correct: 0 },
                { id: 'ak4', text: '–ß—Ç–æ –æ–ø–∞—Å–Ω–æ –¥–ª—è –∂–∏–≤–æ—Ç–Ω—ã—Ö?', options: ['–ü–ª–∞—Å—Ç–∏–∫ –∏ —Å—Ç–µ–∫–ª–æ', '–ß–∏—Å—Ç—ã–π –ª–µ—Å', '–£–±–æ—Ä–∫–∞'], correct: 0 },
                { id: 'ak5', text: '–ö–∞–∫ –ø–æ–º–æ—á—å –∂–∏–≤–æ—Ç–Ω—ã–º?', options: ['–û—Å—Ç–∞–≤–ª—è—Ç—å –º—É—Å–æ—Ä', '–ë–µ—Ä–µ—á—å –ø—Ä–∏—Ä–æ–¥—É', '–†–∞–∑—Ä—É—à–∞—Ç—å –≥–Ω—ë–∑–¥–∞'], correct: 1 },
                { id: 'ak6', text: '–ü—Ç–∏—Ü–∞–º –≤ –≥–æ—Ä–æ–¥–µ –≤—Ä–µ–¥–Ω–æ, –∫–æ–≥–¥–∞‚Ä¶', options: ['–ï—Å—Ç—å –∫–æ—Ä–º—É—à–∫–∏', '–ï—Å—Ç—å –ø–∞–∫–µ—Ç—ã –∏ –º—É—Å–æ—Ä', '–ï—Å—Ç—å –¥–µ—Ä–µ–≤—å—è'], correct: 1 },
                { id: 'ak7', text: '–ß—Ç–æ —Ç–∞–∫–æ–µ —Å—Ä–µ–¥–∞ –æ–±–∏—Ç–∞–Ω–∏—è?', options: ['–î–æ–º –∏ –º–µ—Å—Ç–æ, –≥–¥–µ –∂–∏–≤—ë—Ç –∂–∏–≤–æ—Ç–Ω–æ–µ', '–ò–≥—Ä—É—à–∫–∞', '–ü–∞–∫–µ—Ç'], correct: 0 },
                { id: 'ak8', text: '–ö–æ–≥–æ –ª—É—á—à–µ –Ω–∞–±–ª—é–¥–∞—Ç—å, –Ω–µ –ø—É–≥–∞—è?', options: ['–ñ–∏–≤–æ—Ç–Ω—ã—Ö –∏ –ø—Ç–∏—Ü', '–ú—É—Å–æ—Ä', '–î—ã–º'], correct: 0 },
                { id: 'ak9', text: '–ß—Ç–æ –≤–∞–∂–Ω–æ –≤ —Å—Ç–µ–ø–∏?', options: ['–ß–∏—Å—Ç–æ—Ç–∞ –∏ —Ç—Ä–∞–≤–∞', '–ü–ª–∞—Å—Ç–∏–∫', '–û–≥–æ–Ω—å'], correct: 0 },
                { id: 'ak10', text: '–ï—Å–ª–∏ –≤–∏–¥–∏—à—å —Ä–∞–Ω–µ–Ω—É—é –ø—Ç–∏—Ü—É, –ª—É—á—à–µ‚Ä¶', options: ['–ü—É–≥–∞—Ç—å', '–ü–æ–∑–≤–∞—Ç—å –≤–∑—Ä–æ—Å–ª–æ–≥–æ/—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤', '–ë—Ä–æ—Å–∏—Ç—å –º—É—Å–æ—Ä —Ä—è–¥–æ–º'], correct: 1 }
            ];

            const animalsKz = [
                { id: 'ak1', text: '“ö–∞–∑–∞“õ—Å—Ç–∞–Ω –¥–∞–ª–∞—Å—ã–Ω–¥–∞ –∫—ñ–º–¥–µ—Ä –º–µ–∫–µ–Ω–¥–µ–π–¥—ñ?', options: ['–ö–∏—ñ–∫', '–ü–∏–Ω–≥–≤–∏–Ω', '–ò—Ç–±–∞–ª—ã“õ'], correct: 0 },
                { id: 'ak2', text: '–¢–∞—É–¥–∞ “õ–∞–Ω–¥–∞–π –∂–∞–Ω—É–∞—Ä –±–∞—Ä?', options: ['“ö–∞—Ä –±–∞—Ä—ã—Å—ã', '–ö—Ä–æ–∫–æ–¥–∏–ª', '–ê–∫—É–ª–∞'], correct: 0 },
                { id: 'ak3', text: '–ñ–∞–Ω—É–∞—Ä–ª–∞—Ä“ì–∞ —Ç–∞–∑–∞ —Å—É –Ω–µ “Ø—à—ñ–Ω –∫–µ—Ä–µ–∫?', options: ['–Ü—à—É –∂”ô–Ω–µ ”©–º—ñ—Ä —Å“Ø—Ä—É “Ø—à—ñ–Ω', '“ö–æ“õ—ã—Å —à–∞—à—É “Ø—à—ñ–Ω', '–ê“ì–∞—à —Å—ã–Ω–¥—ã—Ä—É “Ø—à—ñ–Ω'], correct: 0 },
                { id: 'ak4', text: '–ñ–∞–Ω—É–∞—Ä–ª–∞—Ä“ì–∞ –Ω–µ “õ–∞—É—ñ–ø—Ç—ñ?', options: ['–ü–ª–∞—Å—Ç–∏–∫ –ø–µ–Ω ”ô–π–Ω–µ–∫', '–¢–∞–∑–∞ –æ—Ä–º–∞–Ω', '–¢–∞–∑–∞–ª—ã“õ'], correct: 0 },
                { id: 'ak5', text: '–ñ–∞–Ω—É–∞—Ä–ª–∞—Ä“ì–∞ “õ–∞–ª–∞–π –∫”©–º–µ–∫—Ç–µ—Å–µ–º—ñ–∑?', options: ['“ö–æ“õ—ã—Å —Ç–∞—Å—Ç–∞—É', '–¢–∞–±–∏“ì–∞—Ç—Ç—ã “õ–æ—Ä“ì–∞—É', '“∞—è–Ω—ã –±“±–∑—É'], correct: 1 },
                { id: 'ak6', text: '“ö–∞–ª–∞–¥–∞ “õ“±—Å—Ç–∞—Ä“ì–∞ –∑–∏—è–Ω, –µ–≥–µ—Ä‚Ä¶', options: ['–ê—Å—Ç–∞—É–ª–∞—Ä –±–∞—Ä', '–ü–∞–∫–µ—Ç –ø–µ–Ω “õ–æ“õ—ã—Å –∫”©–ø', '–ê“ì–∞—à –±–∞—Ä'], correct: 1 },
                { id: 'ak7', text: '–ú–µ–∫–µ–Ω (–æ—Ä—Ç–∞) –¥–µ–≥–µ–Ω –Ω–µ?', options: ['–ñ–∞–Ω—É–∞—Ä —Ç“±—Ä–∞—Ç—ã–Ω –æ—Ä—ã–Ω', '–û–π—ã–Ω—à—ã“õ', '–ü–∞–∫–µ—Ç'], correct: 0 },
                { id: 'ak8', text: '–ù–µ–Ω—ñ “õ–æ—Ä“õ—ã—Ç–ø–∞–π –±–∞“õ—ã–ª–∞“ì–∞–Ω –¥“±—Ä—ã—Å?', options: ['–ñ–∞–Ω—É–∞—Ä–ª–∞—Ä –º–µ–Ω “õ“±—Å—Ç–∞—Ä–¥—ã', '“ö–æ“õ—ã—Å—Ç—ã', '–¢“Ø—Ç—ñ–Ω–¥—ñ'], correct: 0 },
                { id: 'ak9', text: '–î–∞–ª–∞–¥–∞ –Ω–µ –º–∞“£—ã–∑–¥—ã?', options: ['–¢–∞–∑–∞–ª—ã“õ –∂”ô–Ω–µ —à”©–ø', '–ü–ª–∞—Å—Ç–∏–∫', '–û—Ç'], correct: 0 },
                { id: 'ak10', text: '–ñ–∞—Ä–∞–ª–∞–Ω“ì–∞–Ω “õ“±—Å –∫”©—Ä—Å–µ“£, –¥“±—Ä—ã—Å ”ô—Ä–µ–∫–µ—Ç‚Ä¶', options: ['“ö–æ—Ä“õ—ã—Ç—É', '–ï—Ä–µ—Å–µ–∫ –∞–¥–∞–º–¥—ã/–º–∞–º–∞–Ω–¥—ã —à–∞“õ—ã—Ä—É', '–ñ–∞–Ω—ã–Ω–∞ “õ–æ“õ—ã—Å —Ç–∞—Å—Ç–∞—É'], correct: 1 }
            ];

            const cityRu = [
                { id: 'cl1', text: '–ß–µ–º –æ–ø–∞—Å–µ–Ω –ø–∞–∫–µ—Ç –¥–ª—è –ø—Ç–∏—Ü—ã?', options: ['–ü—Ç–∏—Ü–∞ –º–æ–∂–µ—Ç –∑–∞–ø—É—Ç–∞—Ç—å—Å—è', '–ü–∞–∫–µ—Ç –ø–æ–ª–µ–∑–µ–Ω', '–ü—Ç–∏—Ü–∞ —Å—Ç–∞–Ω–µ—Ç —Å–∏–ª—å–Ω–µ–µ'], correct: 0 },
                { id: 'cl2', text: '–ß—Ç–æ –º–æ–∂–µ—Ç —Å–ª—É—á–∏—Ç—å—Å—è, –µ—Å–ª–∏ –ø—Ç–∏—Ü–∞ –ø—Ä–æ–≥–ª–æ—Ç–∏—Ç –ø–ª–∞—Å—Ç–∏–∫?', options: ['–ù–∏—á–µ–≥–æ', '–û–Ω–∞ –º–æ–∂–µ—Ç –∑–∞–±–æ–ª–µ—Ç—å', '–û–Ω–∞ —Å—Ç–∞–Ω–µ—Ç —É–º–Ω–µ–µ'], correct: 1 },
                { id: 'cl3', text: '–ü–æ—á–µ–º—É —Å—Ç–µ–∫–ª–æ –æ–ø–∞—Å–Ω–æ –≤–æ –¥–≤–æ—Ä–µ?', options: ['–ú–æ–∂–Ω–æ –ø–æ—Ä–∞–Ω–∏—Ç—å—Å—è', '–û–Ω–æ –ª–µ—á–∏—Ç', '–û–Ω–æ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –¥–µ—Ä–µ–≤–æ'], correct: 0 },
                { id: 'cl4', text: '–ß—Ç–æ –ø—Ä–∏–≤–ª–µ–∫–∞–µ—Ç –º—É—Å–æ—Ä –≤–æ –¥–≤–æ—Ä–µ?', options: ['–ö—Ä—ã—Å –∏ –Ω–∞—Å–µ–∫–æ–º—ã—Ö', '–†–∞–¥—É–≥—É', '–°–Ω–µ–∂–Ω–æ–≥–æ –±–∞—Ä—Å–∞'], correct: 0 },
                { id: 'cl5', text: '–ß—Ç–æ –ª—É—á—à–µ –¥–µ–ª–∞—Ç—å —Å –º—É—Å–æ—Ä–æ–º?', options: ['–í—ã–∫–∏–Ω—É—Ç—å –≤ —É—Ä–Ω—É', '–û—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ –ª–∞–≤–æ—á–∫–µ', '–ë—Ä–æ—Å–∏—Ç—å –≤ –∫—É—Å—Ç—ã'], correct: 0 },
                { id: 'cl6', text: '–ß—Ç–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–º–µ—Å—Ç–æ –ø–∞–∫–µ—Ç–∞?', options: ['–ú–Ω–æ–≥–æ—Ä–∞–∑–æ–≤—É—é —Å—É–º–∫—É', '–ï—â—ë –æ–¥–∏–Ω –ø–∞–∫–µ—Ç', '–°—Ç–µ–∫–ª–æ'], correct: 0 },
                { id: 'cl7', text: '–ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ —É–±–∏—Ä–∞—Ç—å –Ω–∞ —É–ª–∏—Ü–µ?', options: ['–ß—Ç–æ–±—ã –±—ã–ª–æ —á–∏—â–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ', '–ß—Ç–æ–±—ã –±—ã–ª–æ –±–æ–ª—å—à–µ –º—É—Å–æ—Ä–∞', '–ß—Ç–æ–±—ã –ª–æ–º–∞—Ç—å –¥–µ—Ä–µ–≤—å—è'], correct: 0 },
                { id: 'cl8', text: '–ï—Å–ª–∏ —É–≤–∏–¥–µ–ª –º—É—Å–æ—Ä —É –¥–æ–º–∞, —Ç—ã‚Ä¶', options: ['–°–æ–±–µ—Ä—É –∏ –≤—ã–±—Ä–æ—à—É', '–†–∞–∑–±—Ä–æ—Å–∞—é', '–°–ø—Ä—è—á—É'], correct: 0 },
                { id: 'cl9', text: '–ß—Ç–æ –¥–µ–ª–∞—Ç—å —Å –±—É—Ç—ã–ª–∫–æ–π?', options: ['–°–º—è—Ç—å –∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä', '–ë—Ä–æ—Å–∏—Ç—å –≤ —Ä–µ–∫—É', '–û—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ –¥–æ—Ä–æ–≥–µ'], correct: 0 },
                { id: 'cl10', text: '–ß–∏—Å—Ç—ã–π –¥–≤–æ—Ä ‚Äî —ç—Ç–æ‚Ä¶', options: ['–ì–¥–µ –Ω–µ—Ç –º—É—Å–æ—Ä–∞', '–ì–¥–µ –º—É—Å–æ—Ä –≤–µ–∑–¥–µ', '–ì–¥–µ –æ–ø–∞—Å–Ω–æ —Ö–æ–¥–∏—Ç—å'], correct: 0 }
            ];

            const cityKz = [
                { id: 'cl1', text: '–ü–∞–∫–µ—Ç “õ“±—Å“õ–∞ –Ω–µ—Å—ñ–º–µ–Ω “õ–∞—É—ñ–ø—Ç—ñ?', options: ['“ö“±—Å —à—ã—Ä–º–∞–ª—ã–ø “õ–∞–ª—É—ã –º“Ø–º–∫—ñ–Ω', '–ü–∞–∫–µ—Ç –ø–∞–π–¥–∞–ª—ã', '“ö“±—Å –∫“Ø—à—Ç—ñ –±–æ–ª–∞–¥—ã'], correct: 0 },
                { id: 'cl2', text: '“ö“±—Å –ø–ª–∞—Å—Ç–∏–∫ –∂“±—Ç—Å–∞ –Ω–µ –±–æ–ª–∞–¥—ã?', options: ['–ï—à—Ç–µ“£–µ', '–ê—É—ã—Ä—ã–ø “õ–∞–ª—É—ã –º“Ø–º–∫—ñ–Ω', '–ê“õ—ã–ª–¥—ã –±–æ–ª–∞–¥—ã'], correct: 1 },
                { id: 'cl3', text: '–ê—É–ª–∞–¥–∞ ”ô–π–Ω–µ–∫ –Ω–µ–≥–µ “õ–∞—É—ñ–ø—Ç—ñ?', options: ['–ñ–∞—Ä–∞“õ–∞—Ç –∞–ª—É“ì–∞ –±–æ–ª–∞–¥—ã', '–ï–º–¥–µ–π–¥—ñ', '–ê“ì–∞—à“õ–∞ –∞–π–Ω–∞–ª–∞–¥—ã'], correct: 0 },
                { id: 'cl4', text: '–ê—É–ª–∞–¥–∞“ì—ã “õ–æ“õ—ã—Å –Ω–µ–Ω—ñ —Ç–∞—Ä—Ç–∞–¥—ã?', options: ['–ï–≥–µ—É“õ“±–π—Ä—ã“õ –ø–µ–Ω –∂”ô–Ω–¥—ñ–∫', '–ö–µ–º–ø—ñ—Ä“õ–æ—Å–∞“õ', '“ö–∞—Ä –±–∞—Ä—ã—Å—ã'], correct: 0 },
                { id: 'cl5', text: '“ö–æ“õ—ã—Å—Ç—ã –Ω–µ —ñ—Å—Ç–µ–≥–µ–Ω –¥“±—Ä—ã—Å?', options: ['–ñ”ô—à—ñ–∫–∫–µ —Ç–∞—Å—Ç–∞—É', '–û—Ä—ã–Ω–¥—ã“õ—Ç–∞ “õ–∞–ª–¥—ã—Ä—É', '–ë“±—Ç–∞“ì–∞ —Ç–∞—Å—Ç–∞—É'], correct: 0 },
                { id: 'cl6', text: '–ü–∞–∫–µ—Ç—Ç—ñ“£ –æ—Ä–Ω—ã–Ω–∞ –Ω–µ “õ–æ–ª–¥–∞–Ω—É“ì–∞ –±–æ–ª–∞–¥—ã?', options: ['–ö”©–ø —Ä–µ—Ç “õ–æ–ª–¥–∞–Ω—ã–ª–∞—Ç—ã–Ω —Å”©–º–∫–µ', '–¢–∞“ì—ã –ø–∞–∫–µ—Ç', '”ò–π–Ω–µ–∫'], correct: 0 },
                { id: 'cl7', text: '–ù–µ–≥–µ –∫”©—à–µ–Ω—ñ —Ç–∞–∑–∞ “±—Å—Ç–∞—É –º–∞“£—ã–∑–¥—ã?', options: ['–¢–∞–∑–∞ –∂”ô–Ω–µ “õ–∞—É—ñ–ø—Å—ñ–∑ –±–æ–ª—É “Ø—à—ñ–Ω', '“ö–æ“õ—ã—Å –∫”©–ø –±–æ–ª—É “Ø—à—ñ–Ω', '–ê“ì–∞—à —Å—ã–Ω–¥—ã—Ä—É “Ø—à—ñ–Ω'], correct: 0 },
                { id: 'cl8', text: '“Æ–π–¥—ñ“£ –∂–∞–Ω—ã–Ω–¥–∞ “õ–æ“õ—ã—Å –∫”©—Ä—Å–µ“£‚Ä¶', options: ['–ñ–∏–Ω–∞–ø, “õ–æ“õ—ã—Å“õ–∞ —Ç–∞—Å—Ç–∞–π–º—ã–Ω', '–®–∞—à–∞–º—ã–Ω', '–ñ–∞—Å—ã—Ä–∞–º—ã–Ω'], correct: 0 },
                { id: 'cl9', text: '–ë”©—Ç–µ–ª–∫–µ–Ω—ñ –Ω–µ —ñ—Å—Ç–µ–π–º—ñ–∑?', options: ['–ú—ã–∂—ã–ø, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–≥–µ —Ç–∞—Å—Ç–∞—É', '”®–∑–µ–Ω–≥–µ —Ç–∞—Å—Ç–∞—É', '–ñ–æ–ª“ì–∞ “õ–∞–ª–¥—ã—Ä—É'], correct: 0 },
                { id: 'cl10', text: '–¢–∞–∑–∞ –∞—É–ª–∞ ‚Äî –±“±–ª‚Ä¶', options: ['“ö–æ“õ—ã—Å –∂–æ“õ –∂–µ—Ä', '“ö–æ“õ—ã—Å –∫”©–ø –∂–µ—Ä', '–ñ“Ø—Ä—É “õ–∞—É—ñ–ø—Ç—ñ –∂–µ—Ä'], correct: 0 }
            ];

            if (lessonId === 'red_book_kz') return lang === 'kz' ? redBookKz : redBookRu;
            if (lessonId === 'animals_kz') return lang === 'kz' ? animalsKz : animalsRu;
            if (lessonId === 'city_litter_birds') return lang === 'kz' ? cityKz : cityRu;

            return lang === 'kz' ? kz : ru;
        }

        function getLeaderboard() {
            try {
                const raw = localStorage.getItem('ecobalaKidsLeaderboard');
                if (!raw) return [];
                const arr = JSON.parse(raw);
                return Array.isArray(arr) ? arr : [];
            } catch {
                return [];
            }
        }

        function saveLeaderboard(arr) {
            localStorage.setItem('ecobalaKidsLeaderboard', JSON.stringify(arr));
        }

        function updateLeaderboard(user) {
            const id = String(user.email || `${user.child_name || ''}_${user.child_surname || ''}`);
            if (!id) return;
            const arr = getLeaderboard();
            const idx = arr.findIndex(x => x.id === id);
            const row = {
                id,
                role: 'kids',
                name: `${user.child_name || ''} ${user.child_surname || ''}`.trim(),
                school: String(user.school || ''),
                class: String(user.class || ''),
                points: Number(user.points ?? 0)
            };
            if (idx >= 0) arr[idx] = row;
            else arr.push(row);
            arr.sort((a, b) => (b.points || 0) - (a.points || 0));
            saveLeaderboard(arr);
        }

        function populateRatingFilters(lang) {
            const select = document.getElementById('ratingSchool');
            if (!select) return;
            const current = select.value;
            select.innerHTML = '';

            const optAll = document.createElement('option');
            optAll.value = '';
            optAll.textContent = t(lang, 'rating_all_schools');
            select.appendChild(optAll);

            Object.keys(schoolNameById).forEach(id => {
                const opt = document.createElement('option');
                opt.value = id;
                opt.textContent = schoolNameById[id][lang];
                select.appendChild(opt);
            });

            select.value = current;
        }

        function renderRating(lang) {
            populateRatingFilters(lang);

            const user = normalizeKidsUser(getUser());
            const id = String(user.email || `${user.child_name || ''}_${user.child_surname || ''}`);

            const school = document.getElementById('ratingSchool')?.value || '';
            const cls = document.getElementById('ratingClass')?.value || '';

            const arr = getLeaderboard().filter(x => x.role === 'kids');
            const filtered = arr.filter(x => {
                if (school && String(x.school) !== String(school)) return false;
                if (cls && String(x.class) !== String(cls)) return false;
                return true;
            }).slice(0, 10);

            const list = document.getElementById('ratingList');
            list.innerHTML = '';

            filtered.forEach((x, i) => {
                const item = document.createElement('div');
                item.className = 'item';

                const top = document.createElement('div');
                top.className = 'top';

                const strong = document.createElement('strong');
                const name = x.id === id ? `${x.name} (${t(lang, 'rating_me')})` : x.name;
                strong.textContent = `${i + 1}. ${name || '‚Äî'}`;

                const small = document.createElement('small');
                small.textContent = `${x.points || 0} ${t(lang, 'points')}`;

                top.appendChild(strong);
                top.appendChild(small);

                const p = document.createElement('p');
                const schoolObj = schoolNameById[String(x.school)] || null;
                const schoolName = schoolObj ? schoolObj[lang] : (x.school || '‚Äî');
                p.textContent = t(lang, 'school_class', { school: schoolName, class: x.class || '‚Äî' });

                item.appendChild(top);
                item.appendChild(p);
                list.appendChild(item);
            });

            const pos = arr.findIndex(x => x.id === id);
            document.getElementById('rank').textContent = pos >= 0 ? String(pos + 1) : '‚Äî';
        }

        function getEarnedBadges(user) {
            const badges = [];

            if ((user.kids_lessons_done || []).length >= 1) badges.push('badge_first_lesson');
            if ((user.kids_games_total || 0) >= 10) badges.push('badge_10_games');
            if ((user.points || 0) >= 100) badges.push('badge_100_points');

            const arr = getLeaderboard().filter(x => x.role === 'kids');
            const school = String(user.school || '');
            const cls = String(user.class || '');
            const filtered = arr.filter(x => String(x.school) === school && String(x.class) === cls);
            filtered.sort((a, b) => (b.points || 0) - (a.points || 0));
            if (filtered.length && filtered[0].id === String(user.email || '')) badges.push('badge_best_class');

            return badges;
        }

        function renderBadges(user, lang) {
            const list = document.getElementById('badgesList');
            list.innerHTML = '';

            const earned = getEarnedBadges(user);
            earned.forEach(k => {
                const div = document.createElement('div');
                div.className = 'badge';
                const icon = document.createElement('span');
                icon.textContent = 'üèÖ';
                const text = document.createElement('div');
                text.textContent = t(lang, k);
                div.appendChild(icon);
                div.appendChild(text);
                list.appendChild(div);
            });

            document.getElementById('badgesCount').textContent = String(earned.length);
            document.getElementById('badgesBadge').textContent = String(earned.length);
        }

        function ensureBotGreeting(lang) {
            const chat = document.getElementById('chatBox');
            if (!chat) return;
            if (chat.childElementCount > 0) return;
            pushMsg('bot', t(lang, 'bot_greet'));
        }

        function pushMsg(type, text) {
            const chat = document.getElementById('chatBox');
            const msg = document.createElement('div');
            msg.className = `msg ${type}`;
            msg.textContent = text;
            chat.appendChild(msg);
            chat.scrollTop = chat.scrollHeight;
        }

        function botAnswer(lang, text) {
            const s = String(text || '').toLowerCase();
            if (s.includes('—Ö—Ä–æ–º—Ç–∞—É') || s.includes('chromtau')) {
                return lang === 'kz'
                    ? '–•—Ä–æ–º—Ç–∞—É–¥–∞ –¥–∞–ª–∞, —à–∞“ì—ã–Ω –æ—Ä–º–∞–Ω-—Ç–æ“ì–∞–π–ª–∞—Ä –∂”ô–Ω–µ ”©–∑–µ–Ω-–∫”©–ª–¥–µ—Ä –±–∞—Ä. –ï“£ –±–∞—Å—Ç—ã—Å—ã ‚Äî “õ–æ“õ—ã—Å —Ç–∞—Å—Ç–∞–º–∞—É –∂”ô–Ω–µ —Ç–∞–±–∏“ì–∞—Ç—Ç—ã —Ç–∞–∑–∞ “±—Å—Ç–∞—É.'
                    : '–í –•—Ä–æ–º—Ç–∞—É –µ—Å—Ç—å —Å—Ç–µ–ø—å, –Ω–µ–±–æ–ª—å—à–∏–µ –ª–µ—Å–Ω—ã–µ –∑–æ–Ω—ã –∏ –≤–æ–¥–æ—ë–º—ã. –ì–ª–∞–≤–Ω–æ–µ ‚Äî –Ω–µ –º—É—Å–æ—Ä–∏—Ç—å –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—Ä–∏—Ä–æ–¥—É —á–∏—Å—Ç–æ–π.';
            }
            if (s.includes('–∫–∞–∫ —É–ª—É—á—à') || s.includes('“õ–∞–ª–∞–π –∂–∞“õ—Å') || s.includes('–∂–∞“õ—Å–∞—Ä—Ç—É')) {
                return lang === 'kz'
                    ? '3 “õ–∞–¥–∞–º: 1) “õ–æ“õ—ã—Å—Ç—ã —Å“±—Ä—ã–ø—Ç–∞ 2) —Å—É–¥—ã “Ø–Ω–µ–º–¥–µ 3) –¥–æ—Å—Ç–∞—Ä—ã“£–º–µ–Ω –±—ñ—Ä–≥–µ –∞—É–ª–∞/—Å–∞—è–±–∞“õ—Ç—ã —Ç–∞–∑–∞–ª–∞. –ö—ñ—à–∫–µ–Ω—Ç–∞–π “õ–∞–¥–∞–º –¥–∞ –º–∞“£—ã–∑–¥—ã!'
                    : '3 —à–∞–≥–∞: 1) —Å–æ—Ä—Ç–∏—Ä—É–π –æ—Ç—Ö–æ–¥—ã 2) —ç–∫–æ–Ω–æ–º—å –≤–æ–¥—É 3) —É–±–∏—Ä–∞–π –¥–≤–æ—Ä/–ø–∞—Ä–∫ —Å –¥—Ä—É–∑—å—è–º–∏. –î–∞–∂–µ –º–∞–ª–µ–Ω—å–∫–∏–µ —à–∞–≥–∏ –≤–∞–∂–Ω—ã!';
            }
            if (s.includes('kids') || s.includes('–∫–∏–¥—Å') || s.includes('teen') || s.includes('—Ç–∏–Ω')) {
                return lang === 'kz'
                    ? 'EcoKids ‚Äî 6‚Äì12 –∂–∞—Å: –æ–π—ã–Ω–¥–∞—Ä, —Å–∞–±–∞“õ—Ç–∞—Ä, –æ–Ω–ª–∞–π–Ω-–∫–≤–µ—Å—Ç—Ç–µ—Ä. EcoTeens ‚Äî 13‚Äì17 –∂–∞—Å: –Ω–∞“õ—Ç—ã –∫–≤–µ—Å—Ç—Ç–µ—Ä –∂”ô–Ω–µ –∂–æ–±–∞–ª–∞—Ä.'
                    : 'EcoKids ‚Äî 6‚Äì12 –ª–µ—Ç: –∏–≥—Ä—ã, —É—Ä–æ–∫–∏, –æ–Ω–ª–∞–π–Ω-–∫–≤–µ—Å—Ç—ã. EcoTeens ‚Äî 13‚Äì17 –ª–µ—Ç: —Ä–µ–∞–ª—å–Ω—ã–µ –∫–≤–µ—Å—Ç—ã –∏ –ø—Ä–æ–µ–∫—Ç—ã.';
            }
            if (s.includes('–±–æ—Ç') || s.includes('bot')) {
                return lang === 'kz'
                    ? '–ú–µ–Ω–µ–Ω —Å“±—Ä–∞–π –∞–ª–∞—Å—ã–∑: ‚Äú–•—Ä–æ–º—Ç–∞—É —Ç–∞–±–∏“ì–∞—Ç—ã “õ–∞–Ω–¥–∞–π?‚Äù, ‚Äú–¢–∞–±–∏“ì–∞—Ç—Ç—ã “õ–∞–ª–∞–π –∂–∞“õ—Å–∞—Ä—Ç–∞–º—ã–∑?‚Äù, ‚Äú“ö–∞–π—Ç–∞ ”©“£–¥–µ—É –¥–µ–≥–µ–Ω –Ω–µ?‚Äù'
                    : '–°–ø—Ä–æ—Å–∏ –º–µ–Ω—è: ‚Äú–ö–∞–∫–∞—è –ø—Ä–∏—Ä–æ–¥–∞ –•—Ä–æ–º—Ç–∞—É?‚Äù, ‚Äú–ö–∞–∫ —É–ª—É—á—à–∏—Ç—å –ø—Ä–∏—Ä–æ–¥—É?‚Äù, ‚Äú–ß—Ç–æ —Ç–∞–∫–æ–µ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞?‚Äù';
            }
            if (s.includes('–≤–æ–¥–∞') || s.includes('—Å—É')) {
                return lang === 'kz'
                    ? '–°—É–¥—ã “Ø–Ω–µ–º–¥–µ: –∫—Ä–∞–Ω–¥—ã –∂–∞–ø, —Ç—ñ—Å –∂—É“ì–∞–Ω–¥–∞ —Å—É–¥—ã –∞“ì—ã–∑–±–∞. –¢–∞–∑–∞ —Å—É ‚Äî –±”ô—Ä—ñ–Ω–µ –∫–µ—Ä–µ–∫!'
                    : '–≠–∫–æ–Ω–æ–º—å –≤–æ–¥—É: –∑–∞–∫—Ä—ã–≤–∞–π –∫—Ä–∞–Ω –∏ –Ω–µ –ª–µ–π –∑—Ä—è –≤–æ–¥—É. –ß–∏—Å—Ç–∞—è –≤–æ–¥–∞ –Ω—É–∂–Ω–∞ –≤—Å–µ–º!';
            }
            if (s.includes('–ª–µ—Å') || s.includes('–æ—Ä–º–∞–Ω') || s.includes('–¥–µ—Ä–µ–≤')) {
                return lang === 'kz'
                    ? '–û—Ä–º–∞–Ω –∞—É–∞ –±–µ—Ä–µ–¥—ñ –∂”ô–Ω–µ –∂–∞–Ω—É–∞—Ä–ª–∞—Ä“ì–∞ “Ø–π. –ê“ì–∞—à—Ç–∞—Ä–¥—ã —Å—ã–Ω–¥—ã—Ä–º–∞ –∂”ô–Ω–µ “õ–æ“õ—ã—Å —Ç–∞—Å—Ç–∞–º–∞.'
                    : '–õ–µ—Å –¥–∞—ë—Ç —á–∏—Å—Ç—ã–π –≤–æ–∑–¥—É—Ö –∏ –¥–æ–º –∂–∏–≤–æ—Ç–Ω—ã–º. –ù–µ –ª–æ–º–∞–π –¥–µ—Ä–µ–≤—å—è –∏ –Ω–µ –æ—Å—Ç–∞–≤–ª—è–π –º—É—Å–æ—Ä.';
            }
            if (s.includes('–º—É—Å–æ—Ä') || s.includes('“õ–æ“õ—ã—Å')) {
                return lang === 'kz'
                    ? '“ö–æ“õ—ã—Å—Ç—ã –±”©–ª–µ–∫ –∂–∏–Ω–∞: –ø–ª–∞—Å—Ç–∏–∫, “õ–∞“ì–∞–∑, ”ô–π–Ω–µ–∫. –ë“±–ª —Ç–∞–±–∏“ì–∞—Ç—Ç—ã “õ–æ—Ä“ì–∞–π–¥—ã.'
                    : '–°–æ—Ä—Ç–∏—Ä—É–π –º—É—Å–æ—Ä: –ø–ª–∞—Å—Ç–∏–∫, –±—É–º–∞–≥–∞, —Å—Ç–µ–∫–ª–æ. –≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –ø—Ä–∏—Ä–æ–¥–µ.';
            }
            return t(lang, 'bot_unknown');
        }

        function renderBotTopics(lang) {
            const wrap = document.getElementById('botTopics');
            if (!wrap) return;
            wrap.innerHTML = '';

            const topics = [
                { key: 'bot_topic_khromtau', q: lang === 'kz' ? '–•—Ä–æ–º—Ç–∞—É —Ç–∞–±–∏“ì–∞—Ç—ã “õ–∞–Ω–¥–∞–π?' : '–ö–∞–∫–∞—è –ø—Ä–∏—Ä–æ–¥–∞ –•—Ä–æ–º—Ç–∞—É?' },
                { key: 'bot_topic_better', q: lang === 'kz' ? '–¢–∞–±–∏“ì–∞—Ç—Ç—ã “õ–∞–ª–∞–π –∂–∞“õ—Å–∞—Ä—Ç–∞–º—ã–∑?' : '–ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å –ø—Ä–∏—Ä–æ–¥—É –ª—É—á—à–µ?' },
                { key: 'bot_topic_kids_teen', q: lang === 'kz' ? 'Kids –∂”ô–Ω–µ Teen –¥–µ–≥–µ–Ω –Ω–µ?' : '–ß—Ç–æ —Ç–∞–∫–æ–µ Kids –∏ —á—Ç–æ —Ç–∞–∫–æ–µ Teen?' },
                { key: 'bot_topic_recycle', q: lang === 'kz' ? '“ö–∞–π—Ç–∞ ”©“£–¥–µ—É –¥–µ–≥–µ–Ω –Ω–µ?' : '–ß—Ç–æ —Ç–∞–∫–æ–µ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞?' }
            ];

            topics.forEach(tpc => {
                const b = document.createElement('button');
                b.type = 'button';
                b.className = 'topic-btn';
                b.textContent = t(lang, tpc.key);
                b.addEventListener('click', () => {
                    const input = document.getElementById('chatInput');
                    if (!input) return;
                    input.value = tpc.q;
                    input.focus();
                });
                wrap.appendChild(b);
            });
        }

        function init() {
            const user = getUser();
            if (!user || user.role !== 'kids') {
                window.location.href = 'register.html';
                return;
            }

            extendTranslations();

            const normalized = normalizeKidsUser(user);
            saveUser(normalized);
            updateLeaderboard(normalized);

            const fullName = `${normalized.child_name || ''} ${normalized.child_surname || ''}`.trim() || '‚Äî';
            document.getElementById('fullName').textContent = fullName;
            updateHeaderStats(normalized);

            document.querySelectorAll('.menu-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.menu-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');

                    const panel = btn.getAttribute('data-panel');
                    localStorage.setItem('ecobalaKidsLastPanel', panel);
                    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
                    const el = document.getElementById(`panel-${panel}`);
                    if (el) el.classList.add('active');

                    const lang = localStorage.getItem('selectedLanguage') || 'ru';
                    if (panel === 'rating') renderRating(lang);
                    if (panel === 'bot') ensureBotGreeting(lang);
                    if (panel === 'bot') renderBotTopics(lang);
                });
            });

            document.getElementById('ratingSchool').addEventListener('change', () => {
                const lang = localStorage.getItem('selectedLanguage') || 'ru';
                renderRating(lang);
            });

            document.getElementById('ratingClass').addEventListener('change', () => {
                const lang = localStorage.getItem('selectedLanguage') || 'ru';
                renderRating(lang);
            });

            document.getElementById('resetRatingBtn').addEventListener('click', () => {
                document.getElementById('ratingSchool').value = '';
                document.getElementById('ratingClass').value = '';
                const lang = localStorage.getItem('selectedLanguage') || 'ru';
                renderRating(lang);
            });

            document.getElementById('chatForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const input = document.getElementById('chatInput');
                const text = input.value.trim();
                if (!text) return;
                const lang = localStorage.getItem('selectedLanguage') || 'ru';
                pushMsg('user', text);
                input.value = '';
                const ans = botAnswer(lang, text);
                setTimeout(() => pushMsg('bot', ans), 250);
            });

            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const selected = btn.getAttribute('data-lang');
                    setLanguage(selected);
                });
            });

            document.getElementById('logoutBtn').addEventListener('click', () => {
                localStorage.removeItem('ecobalaUser');
                window.location.href = 'index.html';
            });

            document.getElementById('qaKidsGamesBtn')?.addEventListener('click', () => {
                document.querySelector('.menu-btn[data-panel="games"]')?.click();
            });
            document.getElementById('qaKidsLessonsBtn')?.addEventListener('click', () => {
                document.querySelector('.menu-btn[data-panel="lessons"]')?.click();
            });
            document.getElementById('qaKidsQuestsBtn')?.addEventListener('click', () => {
                document.querySelector('.menu-btn[data-panel="quests"]')?.click();
            });

            const lang = localStorage.getItem('selectedLanguage') || 'ru';
            applyLangToUI(lang);
            updateLanguage(lang);
            renderBotTopics(lang);

            setLanguage(lang);

            const lastPanel = localStorage.getItem('ecobalaKidsLastPanel');
            if (lastPanel) {
                const btn = document.querySelector(`.menu-btn[data-panel="${lastPanel}"]`);
                if (btn) btn.click();
            }
        }

        init();
    </script>
</body>
</html>
